System.register(["./coordinates-converts-utils-bf8713a9.js"],(function(e){"use strict";var t,i,r,n,s,f,o,u,a,h,d,c,l,v,p,_,x,B,y,b,g,I,w,A,m,M,R,T,F,E,j,O,z,U;return{setters:[function(e){t=e.bM,i=e.e1,r=e.bL,n=e.cc,s=e.e2,f=e.e3,o=e.e4,u=e.e5,a=e.e6,h=e.l,d=e.c5,c=e.d1,l=e.F,v=e.d7,p=e.ck,_=e.aR,x=e.aQ,B=e.ae,y=e.aP,b=e.aO,g=e.aa,I=e.$,w=e.a1,A=e.A,m=e.B,M=e.v,R=e.M,T=e.I,F=e.b2,E=e.u,j=e.e7,O=e.e8,z=e.e9,U=e.ea}],execute:function(){var L,V,S;e({m:P,r:function(e,t,i,r,n,s){void 0===t&&(t=l.R32F),void 0===i&&(i=0),void 0===r&&(r=e.byteLength-i),void 0===n&&(n=0),void 0===s&&(s=[]);var f=v[t];n||(n=f.size);for(var o="get"+C(f),u=f.size/f.count,a=Math.floor(r/n),h=p.isLittleEndian,d=0;d<a;++d)for(var c=i+n*d,_=0;_<f.count;++_){var x=c+u*_;s[f.count*d+_]=e[o](x,h)}return s},w:function(e,t,i,r,n){void 0===i&&(i=l.R32F),void 0===r&&(r=0),void 0===n&&(n=0);var s=v[i];n||(n=s.size);for(var f="set"+C(s),o=s.size/s.count,u=Math.floor(t.length/s.count),a=p.isLittleEndian,h=0;h<u;++h)for(var d=r+n*h,c=0;c<s.count;++c){var _=d+o*c;e[f](_,t[s.count*h+c],a)}}}),t(i.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),r(n.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var N,k=e("B",s("cc.BufferAsset")((S=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this)._buffer=null,t}return f(t,e),t.prototype.buffer=function(){return this._buffer},o(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(d),u((V=S).prototype,"_nativeAsset",[a],Object.getOwnPropertyDescriptor(V.prototype,"_nativeAsset"),V.prototype),L=V))||L);h.BufferAsset=k;var D=((N={})[c.UNORM]="Uint",N[c.SNORM]="Int",N[c.UINT]="Uint",N[c.INT]="Int",N[c.UFLOAT]="Float",N[c.FLOAT]="Float",N.default="Uint",N);function C(e){return(D[e.type]||D.default)+e.size/e.count*8}function P(e,t,i,r,n,s,f){void 0===i&&(i=l.R32F),void 0===r&&(r=0),void 0===n&&(n=e.byteLength-r),void 0===s&&(s=0),f||(f=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var o=v[i];s||(s=o.size);for(var u="set"+C(o),a="get"+C(o),h=o.size/o.count,d=Math.floor(n/s),c=p.isLittleEndian,_=0;_<d;++_)for(var x=r+s*_,B=0;B<o.count;++B){var y=x+h*B,b=e[a](y,c);f[u](y,t(b,B,e),c)}return f}e("R",function(){function e(e,t,i,r,n){void 0===r&&(r=null),void 0===n&&(n=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=w,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=r,this._indirectBuffer=n,this._primitiveMode=i,this._iaInfo=new T(t,e,r,n),this._handle=_.alloc();var s=g.alloc();_.set(this._handle,x.FLAT_BUFFER_ARRAY,s)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,i=e.struct.primitives[this.subMeshIdx],r=_.get(this._handle,x.FLAT_BUFFER_ARRAY);i.indexView&&(t=i.indexView.count);for(var n=0;n<i.vertexBundelIndices.length;n++){var s=i.vertexBundelIndices[n],f=e.struct.vertexBundles[s],o=i.indexView?i.indexView.count:f.view.count,u=f.view.stride,a=u*o,h=new Uint8Array(e.data.buffer,f.view.offset,f.view.length),d=B.alloc(i.indexView?a:f.view.length),c=y.alloc();y.set(c,b.STRIDE,u),y.set(c,b.AMOUNT,o),y.set(c,b.BUFFER,d),g.push(r,c);var l=B.getBuffer(d),v=new Uint8Array(l);if(i.indexView){for(var p=e.readIndices(this.subMeshIdx),I=0;I<t;++I)for(var w=I*u,A=p[I]*u,m=0;m<u;++m)v[w+m]=h[A+m];this._flatBuffers.push({stride:u,count:o,buffer:v})}else v.set(e.data.subarray(f.view.offset,f.view.offset+f.view.length)),this._flatBuffers.push({stride:u,count:o,buffer:v})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}if(this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle){var i=_.get(this._handle,x.FLAT_BUFFER_ARRAY);I(i,g,y),_.free(this._handle),this._handle=w}},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,i=this.attributes.length,r=this._allocVertexIdBuffer(e);this._vertexBuffers.push(r),this._attributes.push(new A("a_vertexId",l.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:i}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,i=new Float32Array(t),r=0;r<t;++r)i[r]=r+.5;var n=e.createBuffer(new m(M.VERTEX|M.TRANSFER_DST,R.DEVICE,i.byteLength,i.BYTES_PER_ELEMENT));return n.update(i),n},o(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:F.ZERO,max:F.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:F.ZERO,max:F.ZERO}};var e=this.mesh,t=this.subMeshIdx,i=e.readAttribute(t,E.ATTR_POSITION),r=e.readIndices(t),n=new F,s=new F,f=this.attributes.find((function(e){return e.name===E.ATTR_POSITION}));if(f){var o=v[f.format].count;2===o?(n.set(i[0],i[1],0),s.set(i[0],i[1],0)):(n.set(i[0],i[1],i[2]),s.set(i[0],i[1],i[2]));for(var u=0;u<i.length;u+=o)2===o?(n.x=i[u]>n.x?i[u]:n.x,n.y=i[u+1]>n.y?i[u+1]:n.y,s.x=i[u]<s.x?i[u]:s.x,s.y=i[u+1]<s.y?i[u+1]:s.y):(n.x=i[u]>n.x?i[u]:n.x,n.y=i[u+1]>n.y?i[u+1]:n.y,n.z=i[u+2]>n.z?i[u+2]:n.z,s.x=i[u]<s.x?i[u]:s.x,s.y=i[u+1]<s.y?i[u+1]:s.y,s.z=i[u+2]<s.z?i[u+2]:s.z)}return this._geometricInfo={positions:i,indices:r,boundingBox:{max:n,min:s}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],i=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,n,s=this.mesh.struct,f=s.primitives[this.subMeshIdx];if(!s.jointMaps||void 0===f.jointMapIndex||!s.jointMaps[f.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var o=h.director.root.device,u=0;u<f.vertexBundelIndices.length;u++){var a=s.vertexBundles[f.vertexBundelIndices[u]];n=0,r=l.UNKNOWN;for(var d=0;d<a.attributes.length;d++){var c=a.attributes[d];if(c.name===E.ATTR_JOINTS){r=c.format;break}n+=v[c.format].size}r?function(){var h=new Uint8Array(e.mesh.data.buffer,a.view.offset,a.view.length),d=new DataView(h.slice().buffer),c=s.jointMaps[f.jointMapIndex];P(d,(function(e){return c.indexOf(e)}),r,n,a.view.length,a.view.stride,d);var l=o.createBuffer(new m(M.VERTEX|M.TRANSFER_DST,R.DEVICE,a.view.length,a.view.stride));l.update(d.buffer),t.push(l),i.push(u)}():t.push(this.vertexBuffers[f.vertexBundelIndices[u]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(o)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}());var Y,J,Z,X,W,G,K,Q,$,q=e("S",s("cc.SceneAsset")((W=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,j(t,"scene",Z,O(t)),j(t,"asyncLoadAssets",X,O(t)),t}return f(t,e),t}(d),Z=u((J=W).prototype,"scene",[z,U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=u(J.prototype,"asyncLoadAssets",[z,U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Y=J))||Y);h.SceneAsset=q;var H,ee,te,ie,re=e("T",s("cc.TextAsset")(($=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,j(t,"text",Q,O(t)),t}return f(t,e),t.prototype.toString=function(){return this.text},t}(d),Q=u((K=$).prototype,"text",[U,z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),G=K))||G);h.TextAsset=re;var ne=e("J",s("cc.JsonAsset")((ie=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,j(t,"json",te,O(t)),t}return f(t,e),t}(d),te=u((ee=ie).prototype,"json",[U,z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=ee))||H);h.JsonAsset=ne}}}));
