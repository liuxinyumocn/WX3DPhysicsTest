System.register(["./coordinates-converts-utils-bf8713a9.js","./index-6f89fc06.js","./factory-9595a1ce.js","./sprite-frame-30c057cb.js","./sprite-6803ade1.js","./renderable-2d-386fc016.js","./graphics-1e47dff7.js","./vertex-format-dd7257e2.js","./deprecated-ed0d00e0.js","./deprecated-a9ea7a0c.js"],(function(t){"use strict";var e,r,a,i,n,s,h,o,u,l,c,f,d,v,p,_,x,g,y,m,S,w,D,b,B,C,M,T,F,L,R,A,E,O,H,P,I,z,N,k,W,U,V,Z,q,G,X,j,K,Q,Y,J,$,tt,et,rt,at,it,nt,st,ht,ot,ut,lt;return{setters:[function(t){e=t.b2,r=t.b9,a=t.bg,i=t.be,n=t.bc,s=t.b0,h=t.eU,o=t.eM,u=t.l,l=t.t,c=t.c,f=t.f,d=t.e4,v=t.R,p=t.cb,_=t.C,x=t.P,g=t.aj,y=t.ai,m=t.ck,S=t.f8,w=t.B,D=t.v,b=t.M,B=t.a3,C=t.fU,M=t.co,T=t.d},function(t){F=t.h},function(t){L=t.d,R=t.i},function(t){A=t.d,E=t.S},function(t){O=t.h,H=t.O,P=t.e,I=t.i,z=t.H,N=t.V,k=t.j,W=t.k,U=t.c,V=t.s,Z=t.f,q=t.d,G=t.g,X=t.B,j=t.a,K=t.T},function(t){Q=t.S,Y=t.a},function(t){J=t.L,$=t.a,tt=t.P,et=t.b,rt=t.G},function(t){at=t.c,it=t.g},function(t){nt=t.L,st=t.c,ht=t.a,ot=t.e,ut=t.M,lt=t.D},function(){}],execute:function(){t("e",Ht);var ct=new e,ft=new r;function dt(t,r,i,n){var s=i.data,h=r.acquireBufferBatch(),o=h.byteOffset>>2,u=i.vertexCount,l=h.indicesOffset,c=h.vertexOffset;h.request(u,i.indicesCount)||(h=r.currBufferBatch,u=0,l=0,c=0);var f=h.vData,d=h.iData;t.getWorldMatrix(ft);for(var v=0;v<u;v++){var p=s[v];e.set(ct,p.x,p.y,0),e.transformMat4(ct,ct,ft),f[o++]=ct.x,f[o++]=ct.y,f[o++]=ct.z,f[o++]=p.u,f[o++]=p.v,a.toArray(f,n,o),o+=4}for(var _=0,x=u/4;_<x;_++){var g=c+4*_;d[l++]=g,d[l++]=g+1,d[l++]=g+2,d[l++]=g+1,d[l++]=g+3,d[l++]=g+2}}var vt=function(t,e,r){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=r};function pt(t,e,r,a,i){var n=0,s=null;if(i===function(t,e,r,a){for(var i=0,n=e,s=r-a;n<r;n+=a)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}(t,e,r,a)>0)for(n=e;n<r;n+=a)s=Et(n,t[n],t[n+1],s);else for(n=r-a;n>=e;n-=a)s=Et(n,t[n],t[n+1],s);return s&&Ft(s,s.next)&&(Ot(s),s=s.next),s}function _t(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var r=t,a=!1;do{if(a=!1,r.steiner||!Ft(r,r.next)&&0!==Tt(r.prev,r,r.next))r=r.next;else{if(Ot(r),(r=e=r.prev)===r.next)return null;a=!0}}while(a||r!==e);return e}function xt(t,e,r,a,i,n,s){if(void 0===s&&(s=0),t){!s&&n&&function(t,e,r,a){var i=t;do{null===i.z&&(i.z=bt(i.x,i.y,e,r,a)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e=0,r=null,a=null,i=null,n=null,s=0,h=0,o=0,u=1;do{for(r=t,t=null,n=null,s=0;r;){for(s++,a=r,h=0,e=0;e<u&&(h++,a=a.nextZ);e++);for(o=u;h>0||o>0&&a;)0===h?(i=a,a=a.nextZ,o--):0!==o&&a?r.z<=a.z?(i=r,r=r.nextZ,h--):(i=a,a=a.nextZ,o--):(i=r,r=r.nextZ,h--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;r=a}n.nextZ=null,u*=2}while(s>1)}(i)}(t,a,i,n);for(var h=t,o=null,u=null;t.prev!==t.next;)if(o=t.prev,u=t.next,n?yt(t,a,i,n):gt(t))e.push(o.i/r),e.push(t.i/r),e.push(u.i/r),Ot(t),t=u.next,h=u.next;else if((t=u)===h){s?1===s?xt(t=mt(t,e,r),e,r,a,i,n,2):2===s&&St(t,e,r,a,i,n):xt(_t(t),e,r,a,i,n,1);break}}}function gt(t){var e=t.prev,r=t,a=t.next;if(Tt(e,r,a)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Ct(e.x,e.y,r.x,r.y,a.x,a.y,i.x,i.y)&&Tt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yt(t,e,r,a){var i=t.prev,n=t,s=t.next;if(Tt(i,n,s)>=0)return!1;for(var h=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,o=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,u=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,l=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,c=bt(h,o,e,r,a),f=bt(u,l,e,r,a),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Ct(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Tt(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Ct(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Tt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function mt(t,e,r){var a=t;do{var i=a.prev,n=a.next.next;!Ft(i,n)&&Lt(i,a,a.next,n)&&Rt(i,n)&&Rt(n,i)&&(e.push(i.i/r),e.push(a.i/r),e.push(n.i/r),Ot(a),Ot(a.next),a=t=n),a=a.next}while(a!==t);return a}function St(t,e,r,a,i,n){var s=t;do{for(var h=s.next.next;h!==s.prev;){if(s.i!==h.i&&Mt(s,h)){var o=At(s,h);return s=_t(s,s.next),o=_t(o,o.next),xt(s,e,r,a,i,n),void xt(o,e,r,a,i,n)}h=h.next}s=s.next}while(s!==t)}function wt(t,e){return t.x-e.x}function Dt(t,e){if(e=function(t,e){var r=e,a=t.x,i=t.y,n=-1/0,s=null;do{if(i<=r.y&&i>=r.next.y){var h=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=a&&h>n){if(n=h,h===a){if(i===r.y)return r;if(i===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(a===n)return s.prev;var o,u=s,l=s.x,c=s.y,f=1/0;for(r=s.next;r!==u;)a>=r.x&&r.x>=l&&Ct(i<c?a:n,i,l,c,i<c?n:a,i,r.x,r.y)&&((o=Math.abs(i-r.y)/(a-r.x))<f||o===f&&r.x>s.x)&&Rt(r,t)&&(s=r,f=o),r=r.next;return s}(t,e)){var r=At(e,t);_t(r,r.next)}}function bt(t,e,r,a,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bt(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Ct(t,e,r,a,i,n,s,h){return(i-s)*(e-h)-(t-s)*(n-h)>=0&&(t-s)*(a-h)-(r-s)*(e-h)>=0&&(r-s)*(n-h)-(i-s)*(a-h)>=0}function Mt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Lt(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Rt(t,e)&&Rt(e,t)&&function(t,e){var r=t,a=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(a=!a),r=r.next}while(r!==t);return a}(t,e)}function Tt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ft(t,e){return t.x===e.x&&t.y===e.y}function Lt(t,e,r,a){return!!(Ft(t,e)&&Ft(r,a)||Ft(t,a)&&Ft(r,e))||Tt(t,e,r)>0!=Tt(t,e,a)>0&&Tt(r,a,t)>0!=Tt(r,a,e)>0}function Rt(t,e){return Tt(t.prev,t,t.next)<0?Tt(t,e,t.next)>=0&&Tt(t,t.prev,e)>=0:Tt(t,e,t.prev)<0||Tt(t,t.next,e)<0}function At(t,e){var r=new vt(t.i,t.x,t.y),a=new vt(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,a.next=r,r.prev=a,n.next=a,a.prev=n,a}function Et(t,e,r,a){var i=new vt(t,e,r);return a?(i.next=a.next,i.prev=a,a.next.prev=i,a.next=i):(i.prev=i,i.next=i),i}function Ot(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ht(t,e,r){r=r||3;var a=e?e.length:0,i=a?e[0]*r:t.length,n=pt(t,0,i,r,!0),s=[];if(!n)return s;var h=0,o=0,u=0,l=0,c=0,f=0,d=0;if(a&&(n=function(t,e,r,a){var i,n=[],s=0,h=null;for(s=0,i=e.length;s<i;s++)(h=pt(t,e[s]*a,s<i-1?e[s+1]*a:t.length,a,!1))&&(h===h.next&&(h.steiner=!0),n.push(Bt(h)));if(n.sort(wt),!r)return r;for(s=0;s<n.length;s++)Dt(n[s],r),r=_t(r,r.next);return r}(t,e,n,r)),t.length>80*r){h=u=t[0],o=l=t[1];for(var v=r;v<i;v+=r)(c=t[v])<h&&(h=c),(f=t[v+1])<o&&(o=f),c>u&&(u=c),f>l&&(l=f);d=Math.max(u-h,l-o)}return xt(n,s,r,h,o,d),s}for(var Pt=Math.PI,It=Math.min,zt=Math.max,Nt=Math.ceil,kt=Math.acos,Wt=Math.cos,Ut=Math.sin,Vt=Math.atan2,Zt=null,qt=null,Gt=new a,Xt=[],jt=0;jt<4;jt++)Xt.push(new e);function Kt(t,e,r){return t<e?e:t>r?r:t}var Qt={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!qt)return null;var r=qt.getRenderDataList(),a=r[qt.dataOffset];if(!a)return null;var i=a,n=i?i.vertexStart+e:0;return(n>65535||3*n>131070)&&(++qt.dataOffset,qt.dataOffset<r.length?a=r[qt.dataOffset]:(a=qt.requestRenderData(),r[qt.dataOffset]=a),i=a),i&&i.vertexCount<n&&i.request(e,3*e),a},stroke:function(t){a.copy(Gt,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){a.copy(Gt,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,r=t.lineCap,a=t.lineJoin,i=t.miterLimit;if(qt=t.impl){var n,s,h,o,u=(n=e,s=Pt,h=qt.tessTol,o=2*kt(n/(n+h)),zt(2,Nt(s/o)));this._calculateJoins(qt,e,a,i);for(var l=qt.paths,c=0,f=qt.pathOffset,d=qt.pathLength;f<d;f++){var v=l[f],p=v.points.length;a===J.ROUND?c+=2*(p+v.bevel*(u+2)+1):c+=2*(p+5*v.bevel+1),v.closed||(r===$.ROUND?c+=2*(2*u+2):c+=12)}var _=Zt=this.getRenderData(t,c);if(_){for(var x=_.vData,g=_.iData,y=qt.pathOffset,m=qt.pathLength;y<m;y++){var S=l[y],w=S.points,D=w.length,b=_.vertexStart,B=void 0,C=void 0,M=0,T=0,F=S.closed;if(F?(B=w[D-1],C=w[0],M=0,T=D):(B=w[0],C=w[1],M=1,T=D-1),C=C||B,!F){var L=new tt(C.x,C.y);L.subtract(B),L.normalize();var R=L.x,A=L.y;r===$.BUTT?this._buttCapStart(B,R,A,e,0):r===$.SQUARE?this._buttCapStart(B,R,A,e,e):r===$.ROUND&&this._roundCapStart(B,R,A,e,u)}for(var E=M;E<T;++E)a===J.ROUND?this._roundJoin(B,C,e,e,u):0!=(C.flags&(et.PT_BEVEL|et.PT_INNERBEVEL))?this._bevelJoin(B,C,e,e):(this._vSet(C.x+C.dmx*e,C.y+C.dmy*e,1),this._vSet(C.x-C.dmx*e,C.y-C.dmy*e,-1)),B=C,C=w[E+1];if(F){var O=8*b;this._vSet(x[O],x[O+1],1),this._vSet(x[O+8],x[O+8+1],-1)}else{var H=new tt(C.x,C.y);H.subtract(B),H.normalize();var P=H.x,I=H.y;r===$.BUTT?this._buttCapEnd(C,P,I,e,0):r===$.SQUARE?this._buttCapEnd(C,P,I,e,e):r===$.ROUND&&this._roundCapEnd(C,P,I,e,u)}for(var z=_.indicesStart,N=b+2,k=_.vertexStart;N<k;N++)g[z++]=N-2,g[z++]=N-1,g[z++]=N;_.indicesStart=z}Zt=null,qt=null}}},_expandFill:function(t){if(qt=t.impl){for(var e=qt.paths,r=0,a=qt.pathOffset,i=qt.pathLength;a<i;a++)r+=e[a].points.length;var n=Zt=this.getRenderData(t,r);if(n){for(var s=n,h=s.vData,o=s.iData,u=qt.pathOffset,l=qt.pathLength;u<l;u++){var c=e[u],f=c.points,d=f.length;if(0!==d){for(var v=n.vertexStart,p=0;p<d;++p)this._vSet(f[p].x,f[p].y);var _=n.indicesStart;if(c.complex){for(var x=[],g=v,y=n.vertexStart;g<y;g++){var m=8*g;x.push(h[m++]),x.push(h[m++]),x.push(h[m++])}var S=Ht(x,null,3);if(!S||0===S.length)continue;for(var w=0,D=S.length;w<D;w++)o[_++]=S[w]+v}else for(var b=v,B=v+2,C=s.vertexStart;B<C;B++)o[_++]=b,o[_++]=B-1,o[_++]=B;s.indicesStart=_}}Zt=null,qt=null}}},_calculateJoins:function(t,e,r,a){var i=0;e>0&&(i=1/e);for(var n=t.paths,s=t.pathOffset,h=t.pathLength;s<h;s++){var o=n[s],u=o.points,l=u.length,c=u[l-1],f=u[0];o.bevel=0;for(var d=0;d<l;d++){var v,p,_=c.dy,x=-c.dx,g=f.dy,y=-f.dx;if(f.dmx=.5*(_+g),f.dmy=.5*(x+y),(v=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var m=1/v;m>600&&(m=600),f.dmx*=m,f.dmy*=m}f.dx*c.dy-c.dx*f.dy>0&&(f.flags|=et.PT_LEFT),v*(p=zt(11,It(c.len,f.len)*i))*p<1&&(f.flags|=et.PT_INNERBEVEL),f.flags&et.PT_CORNER&&(v*a*a<1||r===J.BEVEL||r===J.ROUND)&&(f.flags|=et.PT_BEVEL),0!=(f.flags&(et.PT_BEVEL|et.PT_INNERBEVEL))&&o.bevel++,c=f,f=u[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,r=t.pathOffset,a=t.pathLength;r<a;r++){var i=e[r],n=i.points,s=n[n.length-1],h=n[0];n.length>2&&s.equals(h)&&(i.closed=!0,n.pop(),s=n[n.length-1]);for(var o=0,u=n.length;o<u;o++){var l=new tt(h.x,h.y);l.subtract(s),s.len=l.length(),(l.x||l.y)&&l.normalize(),s.dx=l.x,s.dy=l.y,s=h,h=n[o+1]}}},_chooseBevel:function(t,e,r,a){var i=r.x,n=r.y,s=0,h=0,o=0,u=0;return 0!==t?(s=i+e.dy*a,h=n-e.dx*a,o=i+r.dy*a,u=n-r.dx*a):(s=o=i+r.dmx*a,h=u=n+r.dmy*a),[s,h,o,u]},_buttCapStart:function(t,e,r,a,i){var n=t.x-e*i,s=t.y-r*i,h=r,o=-e;this._vSet(n+h*a,s+o*a,1),this._vSet(n-h*a,s-o*a,-1)},_buttCapEnd:function(t,e,r,a,i){var n=t.x+e*i,s=t.y+r*i,h=r,o=-e;this._vSet(n+h*a,s+o*a,1),this._vSet(n-h*a,s-o*a,-1)},_roundCapStart:function(t,e,r,a,i){for(var n=t.x,s=t.y,h=r,o=-e,u=0;u<i;u++){var l=u/(i-1)*Pt,c=Wt(l)*a,f=Ut(l)*a;this._vSet(n-h*c-e*f,s-o*c-r*f,1),this._vSet(n,s,0)}this._vSet(n+h*a,s+o*a,1),this._vSet(n-h*a,s-o*a,-1)},_roundCapEnd:function(t,e,r,a,i){var n=t.x,s=t.y,h=r,o=-e;this._vSet(n+h*a,s+o*a,1),this._vSet(n-h*a,s-o*a,-1);for(var u=0;u<i;u++){var l=u/(i-1)*Pt,c=Wt(l)*a,f=Ut(l)*a;this._vSet(n,s,0),this._vSet(n-h*c+e*f,s-o*c+r*f,1)}},_roundJoin:function(t,e,r,a,i){var n=t.dy,s=-t.dx,h=e.dy,o=-e.dx,u=e.x,l=e.y;if(0!=(e.flags&et.PT_LEFT)){var c=this._chooseBevel(e.flags&et.PT_INNERBEVEL,t,e,r),f=c[0],d=c[1],v=c[2],p=c[3],_=Vt(-s,-n),x=Vt(-o,-h);x>_&&(x-=2*Pt),this._vSet(f,d,1),this._vSet(u-n*a,e.y-s*a,-1);for(var g=Kt(Nt((_-x)/Pt)*i,2,i),y=0;y<g;y++){var m=_+y/(g-1)*(x-_),S=u+Wt(m)*a,w=l+Ut(m)*a;this._vSet(u,l,0),this._vSet(S,w,-1)}this._vSet(v,p,1),this._vSet(u-h*a,l-o*a,-1)}else{var D=this._chooseBevel(e.flags&et.PT_INNERBEVEL,t,e,-a),b=D[0],B=D[1],C=D[2],M=D[3],T=Vt(s,n),F=Vt(o,h);F<T&&(F+=2*Pt),this._vSet(u+n*a,l+s*a,1),this._vSet(b,B,-1);for(var L=Kt(Nt((F-T)/Pt)*i,2,i),R=0;R<L;R++){var A=T+R/(L-1)*(F-T),E=u+Wt(A)*r,O=l+Ut(A)*r;this._vSet(E,O,1),this._vSet(u,l,0)}this._vSet(u+h*a,l+o*a,1),this._vSet(C,M,-1)}},_bevelJoin:function(t,e,r,a){var i=0,n=0,s=0,h=0,o=0,u=0,l=0,c=0,f=t.dy,d=-t.dx,v=e.dy,p=-e.dx;if(e.flags&et.PT_LEFT){var _=this._chooseBevel(e.flags&et.PT_INNERBEVEL,t,e,r);o=_[0],u=_[1],l=_[2],c=_[3],this._vSet(o,u,1),this._vSet(e.x-f*a,e.y-d*a,-1),this._vSet(l,c,1),this._vSet(e.x-v*a,e.y-p*a,-1)}else{var x=this._chooseBevel(e.flags&et.PT_INNERBEVEL,t,e,-a);i=x[0],n=x[1],s=x[2],h=x[3],this._vSet(e.x+f*r,e.y+d*r,1),this._vSet(i,n,-1),this._vSet(e.x+v*r,e.y+p*r,1),this._vSet(s,h,-1)}},_vSet:function(t,e,r){if(void 0===r&&(r=0),Zt){var i=Zt,n=8*i.vertexStart,s=i.vData;s[n++]=t,s[n++]=e,s[n++]=0,a.toArray(s,Gt,n),n+=4,s[n++]=r,i.vertexStart++}}},Yt=t("g",{getAssembler:function(){return Qt}});rt.Assembler=Yt;var Jt=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},$t=new i,te=null,ee=null,re=[],ae=[],ie=[],ne=[],se=new n,he=new n,oe=new s,ue=null,le=0,ce=0,fe=0,de=0,ve=0,pe=1,_e=null,xe="",ge=0,ye=0,me=0,Se=0,we=0,De=0,be=0,Be=!1,Ce=0,Me=0,Te=0,Fe={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&te!==t&&(ee=(te=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),te.actualFontSize=ge,ee.setContentSize(he),te.renderData.vertDirty=te.renderData.uvDirty=!1,te=null,this._resetProperties())},_updateFontScale:function(){pe=ge/ye},_updateFontFamily:function(t){var e=t.font;_e=e.spriteFrame,ue=e.fntConfig,O.fontAtlas=e.fontDefDictionary,A.packToDynamicAtlas(t,_e)},_updateLabelInfo:function(){O.hash="",O.margin=0},_updateProperties:function(t){xe=t.string.toString(),ge=t.fontSize,ye=ue?ue.fontSize:t.fontSize,me=t.horizontalAlign,Se=t.verticalAlign,we=t.spacingX,be=t.overflow,De=t._lineHeight;var e=ee.contentSize;he.width=e.width,he.height=e.height,be===H.NONE?(Be=!1,he.width+=2*O.margin,he.height+=2*O.margin):be===H.RESIZE_HEIGHT?(Be=!0,he.height+=2*O.margin):Be=t.enableWrapText,O.lineHeight=De,O.fontSize=ge,this._setupBMFontOverflowMetrics()},_resetProperties:function(){ue=null,_e=null,O.hash="",O.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=xe,e=t.length,r=ue.kerningDict,a=re,i=-1,n=0;n<e;++n){var s=t.charCodeAt(n),h=r[i<<16|65535&s]||0;a[n]=n<e-1?h:0,i=s}},_multilineTextWrap:function(t){for(var e=xe.length,r=0,a=0,i=0,n=0,s=0,h=0,o=0,u=null,l=0;l<e;){var c=xe.charAt(l);if("\n"!==c){for(var f=t(xe,l,e),d=h,v=o,p=s,_=a,x=!1,g=0;g<f;++g){var y=l+g;if("\r"!==(c=xe.charAt(y)))if(u=O.fontAtlas.getLetterDefinitionForChar(c,O)){var m=_+u.offsetX*pe-O.margin;if(Be&&Te>0&&a>0&&m+u.w*pe>Te&&!P(c)){ie.push(s),s=0,r++,a=0,i-=De*this._getFontScale()+0,x=!0;break}oe.x=m,oe.y=i-u.offsetY*pe,this._recordLetterInfo(oe,c,y,r),y+1<re.length&&y<e-1&&(_+=re[y+1]),_+=u.xAdvance*pe+we,p=oe.x+u.w*pe,d<oe.y&&(d=oe.y),v>oe.y-u.h*pe&&(v=oe.y-u.h*pe)}else this._recordPlaceholderInfo(y,c),console.log("Can't find letter definition in texture atlas "+ue.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(y,c)}x||(a=_,h<d&&(h=d),o>v&&(o=v),n<(s=p)&&(n=s),l+=f)}else ie.push(s),s=0,r++,a=0,i-=De*this._getFontScale()+0,this._recordPlaceholderInfo(l,c),l++}return ie.push(s),ce=(le=r+1)*De*this._getFontScale(),le>1&&(ce+=0*(le-1)),he.width=Ce,he.height=Me,Ce<=0&&(he.width=parseFloat(n.toFixed(2))+2*O.margin),Me<=0&&(he.height=parseFloat(ce.toFixed(2))+2*O.margin),de=he.height,ve=0,h>0&&(de=he.height+h),o<-ce&&(ve=ce+o),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return be===H.SHRINK?pe:1},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(I(a)||"\n"===a||P(a))return 1;var i=1,n=O.fontAtlas.getLetterDefinitionForChar(a,O);if(!n)return i;for(var s=n.xAdvance*pe+we,h=e+1;h<r&&(a=t.charAt(h),n=O.fontAtlas.getLetterDefinitionForChar(a,O));++h){if(s+n.offsetX*pe+n.w*pe>Te&&!P(a)&&Te>0)return i;if(s+=n.xAdvance*pe+we,"\n"===a||P(a)||I(a))break;i++}return i},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=ae.length){var r=new Jt;ae.push(r)}ae[t].char=e,ae[t].hash=e.charCodeAt(0)+O.hash,ae[t].valid=!1},_recordLetterInfo:function(t,e,r,a){if(r>=ae.length){var i=new Jt;ae.push(i)}var n=e.charCodeAt(0)+O.hash;ae[r].line=a,ae[r].char=e,ae[r].hash=n,ae[r].valid=O.fontAtlas.getLetter(n).valid,ae[r].x=t.x,ae[r].y=t.y},_alignText:function(){ce=0,ie.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),be===H.SHRINK&&ge>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||be===H.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),ge=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,r=0|ge,a=0;e<r;){var i=a=e+r+1>>1;if(i<=0)break;pe=i/ye,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=a-1:e=a}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return ce>he.height},_isHorizontalClamp:function(){for(var t=!1,e=0,r=xe.length;e<r;++e){var a=ae[e];if(a.valid){var i=O.fontAtlas.getLetterDefinitionForChar(a.char,O);if(!i)continue;var n=a.x+i.w/2*pe,s=a.line;if(Ce>0)if(Be){if(ie[s]>he.width&&(n>he.width||n<0)){t=!0;break}}else if(n>he.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var r=ie[e],a=t>he.width||t<0;return Be?r>he.width&&a:a},_updateQuads:function(){if(!te)return!1;var t=_e?_e.texture:O.fontAtlas.getTexture(),e=te.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var r=ee.anchorPoint,a=he,i=r.x*a.width,n=r.y*a.height,s=!0,h=0,o=xe.length;h<o;++h){var u=ae[h];if(u.valid){var l=O.fontAtlas.getLetter(u.hash);if(l){$t.height=l.h,$t.width=l.w,$t.x=l.u,$t.y=l.v;var c=u.y+fe;if(Me>0){if(c>de){var f=c-de;$t.y+=f,$t.height-=f,c-=f}c-l.h*pe<ve&&be===H.CLAMP&&($t.height=c<ve?0:(c-ve)/pe)}var d=u.line,v=u.x+l.w/2*pe+ne[d];if(Ce>0&&this._isHorizontalClamped(v,d))if(be===H.CLAMP)$t.width=0;else if(be===H.SHRINK){if(he.width>l.w){s=!1;break}$t.width=0}if($t.height>0&&$t.width>0){var p=this._determineRect(),_=u.x+ne[u.line];this.appendQuad(te,t,$t,p,_-i,c-n,pe)}}else console.warn("Can't find letter in this bitmap-font")}}return s},appendQuad:function(){},_determineRect:function(){var t=_e.isRotated(),e=_e.getOriginalSize(),r=_e.getRect(),a=_e.getOffset(),i=a.x+(e.width-r.width)/2,n=a.y-(e.height-r.height)/2;if(t){var s=$t.x;$t.x=r.x+r.height-$t.y-$t.height-n,$t.y=s+r.y-i,$t.y<0&&($t.height+=n)}else $t.x+=r.x-i,$t.y+=r.y+n;return t},_computeAlignmentOffset:function(){switch(ne.length=0,me){case z.LEFT:for(var t=0;t<le;++t)ne.push(0);break;case z.CENTER:for(var e=0,r=ie.length;e<r;e++)ne.push((he.width-ie[e])/2);break;case z.RIGHT:for(var a=0,i=ie.length;a<i;a++)ne.push(he.width-ie[a])}if(fe=he.height,Se!==N.TOP){var n=he.height-ce+De*this._getFontScale()-ye*pe;Se===N.BOTTOM?fe-=n:fe-=n/2}},_setupBMFontOverflowMetrics:function(){var t=he.width,e=he.height;be===H.RESIZE_HEIGHT&&(e=0),be===H.NONE&&(t=0,e=0),Ce=t,Me=e,se.width=t,se.height=e,Te=t}},Le={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){dt(t.node,e,t.renderData,t.color)},appendQuad:function(t,e,r,a,i,n,s){var h=t.renderData;if(h){var o=h.dataLength;h.dataLength+=4,h.vertexCount=h.dataLength,h.indicesCount=h.dataLength/2*3;var u=h.data,l=e.width,c=e.height,f=r.width,d=r.height,v=0,p=0,_=0,x=0;a?(v=r.x/l,x=(r.x+d)/l,p=(r.y+f)/c,_=r.y/c,u[o].u=v,u[o].v=_,u[o+1].u=v,u[o+1].v=p,u[o+2].u=x,u[o+2].v=_,u[o+3].u=x,u[o+3].v=p):(v=r.x/l,x=(r.x+f)/l,p=(r.y+d)/c,_=r.y/c,u[o].u=v,u[o].v=p,u[o+1].u=x,u[o+1].v=p,u[o+2].u=v,u[o+2].v=_,u[o+3].u=x,u[o+3].v=_),u[o].x=i,u[o].y=n-d*s,u[o+1].x=i+f*s,u[o+1].y=n-d*s,u[o+2].x=i,u[o+2].y=n,u[o+3].x=i+f*s,u[o+3].y=n}}};h(Le,Fe);var Re=null,Ae=o(Fe,{getAssemblerData:function(){return Re||(Re=new k(1024,1024)),Re.getTexture()},_updateFontFamily:function(t){O.fontAtlas=Re,O.fontFamily=this._getFontFamily(t);var e=t.getComponent(nt);e&&e.enabled?(O.isOutlined=!0,O.margin=e.width,O.out=e.color.clone(),O.out.a=e.color.a*t.color.a/255):(O.isOutlined=!1,O.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(t.font._nativeAsset?e=t.font._nativeAsset:F.postLoadNative(t.font,(function(){t.isValid&&(e=t.font._nativeAsset||"Arial",t.updateRenderData(!0))}))),e},_updateLabelInfo:function(t){O.fontDesc=this._getFontDesc(),O.color=t.color,O.hash=W(O)},_getFontDesc:function(){return O.fontSize.toString()+"px "+O.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Ee=new a(255,255,255,255),Oe={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var r=t.node;Ee.a=t.color.a,dt(r,e,t.renderData,Ee)}},appendQuad:Le.appendQuad};h(Oe,Ae);var He=U.Overflow,Pe=G(),Ie=null,ze=null,Ne=null,ke="",We="",Ue=0,Ve=0,Ze=[],qe=new n,Ge=0,Xe=0,je=0,Ke=new a,Qe="",Ye=He.NONE,Je=!1,$e=null,tr=a.BLACK.clone(),er=null,rr=a.BLACK.clone(),ar=new i,ir=n.ZERO.clone(),nr=n.ZERO.clone(),sr=s.ZERO.clone(),hr=s.ZERO.clone(),or=0,ur=0,lr=!1,cr=!1,fr=!1,dr=["left","center","right"],vr={getAssemblerData:function(){return U._canvasPool.get()},resetAssemblerData:function(t){t&&U._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(),this._calDynamicAtlas(t),t.actualFontSize=Ue,e.setContentSize(qe),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),Ie=null,ze=null,Ne=null}},updateVertexData:function(){},updateUvs:function(){},_updateFontFamily:function(t){t.useSystemFont?Qe=t.fontFamily||"Arial":t.font?t.font._nativeAsset?Qe=t.font._nativeAsset:(F.postLoadNative(t.font,(function(){t.isValid&&(Qe=t.font._nativeAsset||"Arial",t.updateRenderData(!0))})),Qe="Arial"):Qe="Arial"},_updateProperties:function(t,e){var r=t.assemblerData;r&&(Ie=r.context,ze=r.canvas,Ne=t.spriteFrame,We=t.string.toString(),Ue=t.fontSize,Ve=Ue,Ye=t.overflow,nr.width=qe.width=e.width,nr.height=qe.height=e.height,ur=t.underlineHeight,Ge=t.lineHeight,Xe=t.horizontalAlign,je=t.verticalAlign,Ke=t.color,lr=t.isBold,cr=t.isItalic,fr=t.isUnderline,Je=Ye!==He.NONE&&(Ye===He.RESIZE_HEIGHT||t.enableWrapText),($e=($e=nt&&t.getComponent(nt))&&$e.enabled&&$e.width>0?$e:null)&&tr.set($e.color),(er=(er=st&&t.getComponent(st))&&er.enabled?er:null)&&rr.set(er.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,r=0,a=0,i=0;if(ir.width=ir.height=0,$e&&(t=e=r=a=i=$e.width,ir.width=ir.height=2*i),er){var n=er.blur+i,s=er.offset.x,h=er.offset.y;r=Math.max(r,-s+n),a=Math.max(a,s+n),t=Math.max(t,h+n),e=Math.max(e,-h+n)}if(cr){var o=Ve*Math.tan(.20943951);a+=o,ir.width+=o}ar.x=r,ar.y=t,ar.width=r+a,ar.height=t+e},_calculateFillTextStartPosition:function(){var t=0;Xe===z.RIGHT?t=qe.width-ar.width:Xe===z.CENTER&&(t=(qe.width-ar.width)/2);var e=this._getLineHeight()*(Ze.length-1),r=Ue*(1-q/2);if(je!==N.TOP){var a=e+ar.height+Ue-qe.height;je===N.BOTTOM?r-=a+=q/2*Ue:r-=a/2}r+=Pe*Ue,sr.set(t+ar.x,r+ar.y)},_updateTexture:function(){if(Ie&&ze){Ie.clearRect(0,0,ze.width,ze.height),Ie.font=ke,this._calculateFillTextStartPosition();var t=this._getLineHeight();Ie.lineJoin="round",Ie.fillStyle="rgba("+Ke.r+", "+Ke.g+", "+Ke.b+", 1)";var e,r=sr.x,a=0;this._drawTextEffect(sr,t);for(var n=0;n<Ze.length;++n)a=sr.y+n*t,$e&&Ie.strokeText(Ze[n],r,a),Ie.fillText(Ze[n],r,a);er&&(Ie.shadowColor="transparent"),Ne&&(e=Ne instanceof E?Ne.texture:Ne,0!==ze.width&&0!==ze.height&&(e.reset({width:ze.width,height:ze.height,mipmapLevel:1}),e.uploadData(ze),Ne instanceof E&&(Ne.rect=new i(0,0,ze.width,ze.height),Ne._calculateUV()),u.director.root&&u.director.root.batcher2D&&u.director.root.batcher2D._releaseDescriptorSetCache(e.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===U.CacheMode.BITMAP){var e=t.ttfSpriteFrame;A.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===U.CacheMode.BITMAP){var e=t.ttfSpriteFrame;A.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){Ie.strokeStyle="rgba("+tr.r+", "+tr.g+", "+tr.b+", "+tr.a/255+")",Ie.lineWidth=2*$e.width},_setupShadow:function(){Ie.shadowColor="rgba("+rr.r+", "+rr.g+", "+rr.b+", "+rr.a/255+")",Ie.shadowBlur=er.blur,Ie.shadowOffsetX=er.offset.x,Ie.shadowOffsetY=-er.offset.y},_drawTextEffect:function(t,e){if(er||$e||fr){var r=Ze.length>1&&er,a=this._measureText(Ie,ke),i=0,n=0;er&&this._setupShadow(),$e&&this._setupOutline();for(var s=0;s<Ze.length;++s)i=t.x,n=t.y+s*e,r&&($e&&Ie.strokeText(Ze[s],i,n),Ie.fillText(Ze[s],i,n)),fr&&(or=a(Ze[s]),Xe===z.RIGHT?hr.x=t.x-or:Xe===z.CENTER?hr.x=t.x-or/2:hr.x=t.x,hr.y=n+Ve/8,Ie.fillRect(hr.x,hr.y,or,ur));r&&(Ie.shadowColor="transparent")}},_updateLabelDimensions:function(){qe.width=Math.min(qe.width,2048),qe.height=Math.min(qe.height,2048);var t=!1;ze.width!==qe.width&&(ze.width=qe.width,t=!0),ze.height!==qe.height&&(ze.height=qe.height,t=!0),t&&(Ie.font=ke),Ie.textAlign=dr[Xe],Ie.textBaseline="alphabetic"},_getFontDesc:function(){var t=Ue.toString()+"px ";return t+=Qe,lr&&(t="bold "+t),cr&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===Ge?Ue:Ge*Ue/Ve)},_calculateParagraphLength:function(t,e){for(var r,a=[],i=l(t);!(r=i()).done;){var n=r.value,s=V(e,n,ke);a.push(s)}return a},_measureText:function(t,e){return function(r){return V(t,r,e)}},_calculateShrinkFont:function(t){if(Ie){var e=this._calculateParagraphLength(t,Ie),r=0,a=0,i=0;if(Je){var n=nr.width,s=nr.height;if(n<0||s<0)return;a=s+1;for(var h=0,o=0|Ue+1,u=0;h<o;){if((u=h+o+1>>1)<=0){c(4003);break}Ue=u,ke=this._getFontDesc(),Ie.font=ke;var l=this._getLineHeight();for(a=0,r=0;r<t.length;++r){var f=V(Ie,t[r],ke);a+=Z(t[r],f,n,this._measureText(Ie,ke)).length*l}a>s?o=u-1:h=u}0===h?c(4003):(Ue=h,ke=this._getFontDesc(),Ie.font=ke)}else{for(a=t.length*this._getLineHeight(),r=0;r<t.length;++r)i<e[r]&&(i=e[r]);var d=(qe.width-ar.width)/i,v=qe.height/a;Ue=Ve*Math.min(1,d,v)|0,ke=this._getFontDesc(),Ie.font=ke}}},_calculateWrapText:function(t){if(Je&&Ie){Ze=[];for(var e=nr.width,r=0;r<t.length;++r){var a=V(Ie,t[r],ke),i=Z(t[r],a,e,this._measureText(Ie,ke));Ze=Ze.concat(i)}}},_calculateLabelFont:function(){if(Ie){var t=We.split("\n");switch(Ze=t,ke=this._getFontDesc(),Ie.font=ke,Ye){case He.NONE:for(var e=0,r=0,a=0;a<t.length;++a){var i=V(Ie,t[a],ke);e=e>i?e:i}r=(Ze.length+q)*this._getLineHeight();var n=parseFloat(e.toFixed(2)),s=parseFloat(r.toFixed(2));qe.width=n+ar.width,qe.height=s+ar.height,nr.width=n+ir.width,nr.height=s+ir.height;break;case He.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case He.CLAMP:this._calculateWrapText(t);break;case He.RESIZE_HEIGHT:this._calculateWrapText(t);var h=(Ze.length+q)*this._getLineHeight();qe.height=h+ar.height,nr.height=h+ir.height}}}},pr=a.WHITE.clone(),_r={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var r=e.vData=new Float32Array(36);r[3]=r[21]=r[22]=r[31]=0,r[4]=r[12]=r[13]=r[30]=1;for(var i=5,n=0;n<4;n++)a.toArray(r,pr,i),i+=9;return e},fillBuffers:function(t,e){var r=t.renderData,a=r.data,i=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,h=n.indicesOffset,o=n.vertexOffset;n.request()||(n=e.currBufferBatch,h=0,o=0,s=0);var u=n.vData,l=n.iData,c=r.vData,f=a[0],d=a[3];i.updateWorldTransform();var v=i._pos,p=i._rot,_=i._scale,x=f.x*_.x,g=d.x*_.x,y=f.y*_.y,m=d.y*_.y,S=p.x,w=p.y,D=p.z,b=p.w,B=S*w,C=D*b,M=S*S-w*w,T=b*b-D*D,F=T+M,L=2*(B-C),R=T-M,A=2*(B+C),E=v.x,O=v.y;c[0]=F*x+L*y+E,c[1]=R*y+A*x+O,c[9]=F*g+L*y+E,c[10]=R*y+A*g+O,c[18]=F*x+L*m+E,c[19]=R*m+A*x+O,c[27]=F*g+L*m+E,c[28]=R*m+A*g+O,u.set(c,s),l[h++]=o,l[h++]=o+1,l[h++]=o+2,l[h++]=o+2,l[h++]=o+1,l[h++]=o+3},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=r.width,i=r.height,n=r.anchorX*a,s=r.anchorY*i,h=e.data;h[0].x=-n,h[0].y=-s,h[3].x=a-n,h[3].y=i-s}},updateUvs:function(t){var e=t.renderData;if(e){var r=e.vData;if(r&&e.uvDirty){var a=t.ttfSpriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1}}}};h(_r,vr);var xr=t("l",{getAssembler:function(t){var e=_r;return t.font instanceof X?e=Le:t.cacheMode===U.CacheMode.CHAR&&(e=Oe),e}});U.Assembler=xr;var gr=j.FillType,yr=new r,mr={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;A.packToDynamicAtlas(t,e);var r=t.renderData;if(r&&e){var a=r.uvDirty,i=r.vertDirty;if(!a&&!i)return;var n=t.fillStart,s=t.fillRange;s<0&&(n+=s,s=-s),s=(s=(s=n+s)>1?1:s)<0?0:s;var h=(n=(n=n>1?1:n)<0?0:n)+(s=(s-=n)<0?0:s);h=h>1?1:h,a&&this.updateUVs(t,n,h),i&&(this.updateVertexData&&this.updateVertexData(t,n,h),this.updateWorldVertexData(t))}},updateUVs:function(t,e,r){var a=t.spriteFrame,i=t.renderData,n=i.data,s=a.width,h=a.height,o=a.getRect(),u=0,l=0,c=0,d=0,v=0,p=0,_=0,x=0,g=0,y=0;switch(a.isRotated()?(u=o.x/s,l=(o.y+o.width)/h,c=v=u,_=g=(o.x+o.height)/s,p=y=l,d=x=o.y/h):(u=o.x/s,l=(o.y+o.height)/h,c=_=u,v=g=(o.x+o.width)/s,d=p=l,x=y=o.y/h),t.fillType){case gr.HORIZONTAL:n[0].u=c+(v-c)*e,n[0].v=d+(p-d)*e,n[1].u=c+(v-c)*r,n[1].v=d+(p-d)*r,n[2].u=_+(g-_)*e,n[2].v=x+(y-x)*e,n[3].u=_+(g-_)*r,n[3].v=x+(y-x)*r;break;case gr.VERTICAL:n[0].u=c+(_-c)*e,n[0].v=d+(x-d)*e,n[1].u=v+(g-v)*e,n[1].v=p+(y-p)*e,n[2].u=c+(_-c)*r,n[2].v=d+(x-d)*r,n[3].u=v+(g-v)*r,n[3].v=p+(y-p)*r;break;default:f(2626)}i.uvDirty=!1},updateVertexData:function(t,e,r){var a=t.renderData,i=a.data,n=t.node._uiProps.uiTransformComp,s=n.width,h=n.height,o=n.anchorX*s,u=n.anchorY*h,l=-o,c=-u,d=s-o,v=h-u,p=0;switch(t.fillType){case gr.HORIZONTAL:p=l+(d-l)*r,l+=(d-l)*e,d=p;break;case gr.VERTICAL:p=c+(v-c)*r,c+=(v-c)*e,v=p;break;default:f(2626)}i[4].x=l,i[4].y=c,i[5].x=d,i[5].y=c,i[6].x=l,i[6].y=v,i[7].x=d,i[7].y=v,a.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var r,a=e.data,i=l(a);!(r=i()).done;)r.value.z=0;return e},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(yr);for(var i=0;i<4;i++){var n=a[i+4],s=a[i];e.transformMat4(s,n,yr)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t),t.node,function(t,e,r,i){var n=r.data,s=e.acquireBufferBatch(),h=s.byteOffset>>2,o=r.vertexCount,u=s.indicesOffset,l=s.vertexOffset;s.request(o,r.indicesCount)||(s=e.currBufferBatch,o=0,u=0,l=0);for(var c=s.vData,f=0;f<o;f++){var d=n[f];c[h++]=d.x,c[h++]=d.y,c[h++]=d.z,c[h++]=d.u,c[h++]=d.v,a.toArray(c,i,h),h+=4}var v=s.iData;v[u++]=l,v[u++]=l+1,v[u++]=l+2,v[u++]=l+1,v[u++]=l+3,v[u++]=l+2}(0,e,t.renderData,t.color)}},Sr=2*Math.PI,wr=[new s,new s,new s,new s],Dr=new Array(4),br=new Array(8),Br=[new s,new s,new s,new s],Cr=[new s,new s,new s,new s],Mr=new s,Tr=[new s,new s,new s,new s];function Fr(t,e,r,a,i,n,s){var h=Math.sin(n);h=Math.abs(h)>1e-6?h:0;var o=Math.cos(n),u=0,l=0;if(0!==(o=Math.abs(o)>1e-6?o:0)){if(u=h/o,(t-i.x)*o>0){var c=i.y+u*(t-i.x);s[0].x=t,s[0].y=c}if((e-i.x)*o>0){var f=i.y+u*(e-i.x);s[2].x=e,s[2].y=f}}if(0!==h){if(l=o/h,(a-i.y)*h>0){var d=i.x+l*(a-i.y);s[3].x=d,s[3].y=a}if((r-i.y)*h>0){var v=i.x+l*(r-i.y);s[1].x=v,s[1].y=r}}}function Lr(t,e){var r=e.x-t.x,a=e.y-t.y;if(0===r&&0===a)return 0;if(0===r)return a>0?.5*Math.PI:1.5*Math.PI;var i=Math.atan(a/r);return r<0&&(i+=Math.PI),i}function Rr(t,e,r,a,i){var n=Dr,s=n[0],h=n[1],o=n[2],u=n[3];t[e].x=r.x,t[e].y=r.y,t[e+1].x=a.x,t[e+1].y=a.y,t[e+2].x=i.x,t[e+2].y=i.y,Ar((r.x-s)/(o-s),(r.y-h)/(u-h),t,e),Ar((a.x-s)/(o-s),(a.y-h)/(u-h),t,e+1),Ar((i.x-s)/(o-s),(i.y-h)/(u-h),t,e+2)}function Ar(t,e,r,a){var i=br,n=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,h=i[1]+(i[3]-i[1])*t,o=i[5]+(i[7]-i[5])*t,u=r[a];u.u=n+(s-n)*e,u.v=h+(o-h)*e}for(var Er={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;A.packToDynamicAtlas(t,e);var r,a,i,n,h,o,u,c,f,d=t.renderData;if(d&&e&&(d.vertDirty||d.uvDirty)){var v=d.data,p=t.fillStart,_=t.fillRange;for(_<0&&(p+=_,_=-_);p>=1;)p-=1;for(;p<0;)p+=1;var x=(p*=Sr)+(_*=Sr);!function(t){var e=t.node._uiProps.uiTransformComp,r=e.width,a=e.height,i=e.anchorX*r,n=e.anchorY*a,h=-i,o=-n,u=r-i,c=a-n,f=Dr;f[0]=h,f[1]=o,f[2]=u,f[3]=c;var d=t.fillCenter,v=Mr.x=Math.min(Math.max(0,d.x),1)*(u-h)+h,p=Mr.y=Math.min(Math.max(0,d.y),1)*(c-o)+o;wr[0].x=wr[3].x=h,wr[1].x=wr[2].x=u,wr[0].y=wr[1].y=o,wr[2].y=wr[3].y=c;for(var _,x=l(Tr);!(_=x()).done;){var g=_.value;s.set(g,0,0)}v!==f[0]&&s.set(Tr[0],3,0),v!==f[2]&&s.set(Tr[2],1,2),p!==f[1]&&s.set(Tr[1],0,1),p!==f[3]&&s.set(Tr[3],2,3)}(t),a=(r=e).width,i=r.height,n=r.getRect(),h=0,o=0,u=0,c=0,f=br,r.isRotated()?(h=n.x/a,o=(n.x+n.height)/a,u=n.y/i,c=(n.y+n.width)/i,f[0]=f[2]=h,f[4]=f[6]=o,f[3]=f[7]=c,f[1]=f[5]=u):(h=n.x/a,o=(n.x+n.width)/a,u=n.y/i,c=(n.y+n.height)/i,f[0]=f[4]=h,f[2]=f[6]=o,f[1]=f[3]=c,f[5]=f[7]=u),Fr(Dr[0],Dr[2],Dr[1],Dr[3],Mr,p,Br),Fr(Dr[0],Dr[2],Dr[1],Dr[3],Mr,p+_,Cr);for(var g=0,y=0;y<4;++y){var m=Tr[y];if(m)if(_>=Sr)d.dataLength=g+3,Rr(v,g,Mr,wr[m.x],wr[m.y]),g+=3;else{var S=Lr(Mr,wr[m.x]),w=Lr(Mr,wr[m.y]);w<S&&(w+=Sr),S-=Sr,w-=Sr;for(var D=0;D<3;++D)S>=x||(S>=p?(d.dataLength=g+3,Rr(v,g,Mr,wr[m.x],w>=x?Cr[y]:wr[m.y]),g+=3):w>p&&(w<=x?(d.dataLength=g+3,Rr(v,g,Mr,Br[y],wr[m.y]),g+=3):(d.dataLength=g+3,Rr(v,g,Mr,Br[y],Cr[y]),g+=3))),S+=Sr,w+=Sr}}d.indicesCount=d.vertexCount=g,d.vertDirty=d.uvDirty=!1}},fillBuffers:function(t,r){!function(t,r,i,n){var s=i.data,h=r.acquireBufferBatch(),o=h.byteOffset>>2,u=i.vertexCount,l=h.indicesOffset,c=h.vertexOffset;h.request(u,i.indicesCount)||(h=r.currBufferBatch,u=0,l=0,c=0);var f=h.vData;t.getWorldMatrix(ft);for(var d=0;d<u;d++){var v=s[d];e.set(ct,v.x,v.y,0),e.transformMat4(ct,ct,ft),f[o++]=ct.x,f[o++]=ct.y,f[o++]=ct.z,f[o++]=v.u,f[o++]=v.v,a.toArray(f,n,o),o+=4}for(var p=h.iData,_=0;_<i.dataLength;_++)p[l+_]=c+_}(t.node,r,t.renderData,t.color)}},Or=[],Hr=0;Hr<4;Hr++)Or.push(new e);for(var Pr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;A.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.uvDirty&&this.updateUvs(t))},fillBuffers:function(t,e){if(null!==t){var r=t.renderData.data,a=t.node,i=e.acquireBufferBatch(),n=i.byteOffset>>2,s=i.indicesOffset,h=i.vertexOffset;i.request()||(i=e.currBufferBatch,n=0,s=0,h=0);var o=i.vData,u=i.iData,l=t.renderData.vData,c=r[0],f=r[3],d=a.worldMatrix,v=d.m00,p=d.m01,_=d.m04,x=d.m05,g=d.m12,y=d.m13,m=c.x,S=f.x,w=c.y,D=f.y,b=v*m,B=v*S,C=p*m,M=p*S,T=_*w,F=_*D,L=x*w,R=x*D;l[0]=b+T+g,l[1]=C+L+y,l[9]=B+T+g,l[10]=M+L+y,l[18]=b+F+g,l[19]=C+R+y,l[27]=B+F+g,l[28]=M+R+y,o.set(l,n),u[s++]=h,u[s++]=h+1,u[s++]=h+2,u[s++]=h+2,u[s++]=h+1,u[s++]=h+3}},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=e.data,i=r.width,n=r.height,s=r.anchorX*i,h=r.anchorY*n,o=0,u=0,l=0,c=0;if(t.trim)o=-s,u=-h,l=i-s,c=n-h;else{var f=t.spriteFrame,d=f.getOriginalSize(),v=f.getRect(),p=d.width,_=d.height,x=v.width,g=v.height,y=f.getOffset(),m=i/p,S=n/_,w=y.x+(p-x)/2,D=y.x-(p-x)/2;o=w*m-s,u=(y.y+(_-g)/2)*S-h,l=i+D*m-s,c=n+(y.y-(_-g)/2)*S-h}a[0].x=o,a[0].y=u,a[0].z=0,a[3].x=l,a[3].y=c,a[3].z=0,e.vertDirty=!1}},updateUvs:function(t){var e=t.renderData,r=e.vData,a=t.spriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,r=5,a=t.color,i=a.r/255,n=a.g/255,s=a.b/255,h=a.a/255,o=0;o<4;o++)e[r]=i,e[r+1]=n,e[r+2]=s,e[r+3]=h,r+=9}},Ir=new e,zr=new r,Nr={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;A.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&r.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,r=e.data,a=t.node._uiProps.uiTransformComp,i=a.width,n=a.height,s=a.anchorX*i,h=a.anchorY*n,o=t.spriteFrame,u=o.insetLeft,l=o.insetRight,c=o.insetTop,f=o.insetBottom,d=i-u-l,v=n-c-f,p=i/(u+l),_=n/(c+f);p=Number.isNaN(p)||p>1?1:p,_=Number.isNaN(_)||_>1?1:_,d=d<0?0:d,v=v<0?0:v,r[0].x=-s,r[0].y=-h,r[1].x=u*p-s,r[1].y=f*_-h,r[2].x=r[1].x+d,r[2].y=r[1].y+v,r[3].x=i-s,r[3].y=n-h,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=e.acquireBufferBatch(),i=t.renderData,n=i.data,s=r.byteOffset>>2,h=i.vertexCount,o=r.indicesOffset,u=r.vertexOffset,l=t.spriteFrame.uvSliced;r.request(h,i.indicesCount)||(r=e.currBufferBatch,s=0,o=0,u=0);for(var c=r.vData,f=r.iData,d=4;d<20;++d){var v=n[d],p=l[d-4];c[s++]=v.x,c[s++]=v.y,c[s++]=v.z,c[s++]=p.u,c[s++]=p.v,a.toArray(c,t.color,s),s+=4}for(var _=0;_<3;++_)for(var x=0;x<3;++x){var g=u+4*_+x;f[o++]=g,f[o++]=g+1,f[o++]=g+4,f[o++]=g+1,f[o++]=g+5,f[o++]=g+4}},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(zr);for(var i=0;i<4;++i)for(var n=a[i],s=0;s<4;++s){var h=a[s],o=a[4+4*i+s];e.set(Ir,h.x,n.y,0),e.transformMat4(o,Ir,zr)}}},kr=[],Wr=0;Wr<4;Wr++)kr.push(new e);var Ur={useModel:!1,sizableWidth:0,sizableHeight:0,vRepeat:0,hRepeat:0,row:0,col:0,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,r=t.spriteFrame;if(r&&e&&(e.uvDirty||e.vertDirty)){var a=t.node._uiProps.uiTransformComp,i=Math.abs(a.width),n=Math.abs(a.height),s=r.getRect(),h=r.insetLeft,o=r.insetRight,u=s.width-h-o,l=r.insetTop,c=r.insetBottom,f=s.height-l-c;this.sizableWidth=i-h-o,this.sizableHeight=n-l-c,this.sizableWidth=this.sizableWidth>0?this.sizableWidth:0,this.sizableHeight=this.sizableHeight>0?this.sizableHeight:0,this.hRepeat=0===u?this.sizableWidth:this.sizableWidth/u,this.vRepeat=0===f?this.sizableHeight:this.sizableHeight/f,this.row=Math.ceil(this.vRepeat+2),this.col=Math.ceil(this.hRepeat+2),e.dataLength=Math.max(8,this.row+1,this.col+1),this.updateVerts(t),e.vertexCount=this.row*this.col*4,e.indicesCount=this.row*this.col*6,e.uvDirty=!1,e.vertDirty=!1}},fillBuffers:function(t,e){var r=t.node,i=t.renderData,n=e.acquireBufferBatch(),s=n.indicesOffset,h=n.byteOffset>>2,o=n.vertexOffset,u=i.vertexCount,l=i.indicesCount,c=n.vData,f=n.iData;n.request(u,l)||(n=e.currBufferBatch,h=0,s=0,o=0);var d=t.spriteFrame,v=d.isRotated(),p=d.uv,_=d.uvSliced,x=d.getRect(),g=d.insetLeft,y=d.insetRight,m=x.width-g-y,S=d.insetTop,w=d.insetBottom,D=x.height-S-w,b=r.worldMatrix;this.fillVertices(c,h,b,this.row,this.col,i.data);for(var B=0,C=0,M=0,T=this.row;M<T;++M){C=this.sizableHeight>D?this.sizableHeight>=M*D?1:this.vRepeat%1:this.vRepeat;for(var F=0,L=this.col;F<L;++F){B=this.sizableWidth>m?this.sizableWidth>=F*m?1:this.hRepeat%1:this.hRepeat;var R=h+3,A=R+1;v?(c[R]=p[0],c[A]=p[1],c[R+9]=p[0],c[A+9]=p[1]+(p[7]-p[1])*B,c[R+18]=p[0]+(p[6]-p[0])*C,c[A+18]=p[1],c[R+27]=c[R+18],c[A+27]=c[A+9]):(0===F?c[R]=p[0]:F>0&&F<this.col-1?c[R]=_[1].u:F===this.col-1&&(c[R]=_[2].u),0===M?c[A]=_[0].v:M>0&&M<this.row-1?c[A]=_[4].v:M===this.row-1&&(c[A]=_[8].v),0===F||F>0&&F<this.col-1?c[R+9]=_[1].u+(_[2].u-_[1].u)*B:F===this.col-1&&(c[R+9]=_[3].u),0===M?c[A+9]=_[0].v:M>0&&M<this.row-1?c[A+9]=_[4].v:M===this.row-1&&(c[A+9]=_[8].v),0===F?c[R+18]=p[0]:F>0&&F<this.col-1?c[R+18]=_[1].u:F===this.col-1&&(c[R+18]=_[2].u),0===M||M>0&&M<this.row-1?c[A+18]=_[4].v+(_[8].v-_[4].v)*C:M===this.row-1&&(c[A+18]=_[12].v),c[R+27]=c[R+9],c[A+27]=c[A+18]),a.toArray(c,t.color,A+1),a.toArray(c,t.color,A+9+1),a.toArray(c,t.color,A+18+1),a.toArray(c,t.color,A+27+1),h+=36}}for(var E=0;E<l;E+=6)f[s++]=o,f[s++]=o+1,f[s++]=o+2,f[s++]=o+1,f[s++]=o+3,f[s++]=o+2,o+=4},fillVertices:function(t,r,a,i,n,s){for(var h=0,o=0,u=0,l=0,c=0,f=i;c<f;++c){u=s[c].y,l=s[c+1].y;for(var d=0,v=n;d<v;++d){h=s[d].x,o=s[d+1].x,e.set(kr[0],h,u,0),e.set(kr[1],o,u,0),e.set(kr[2],h,l,0),e.set(kr[3],o,l,0);for(var p=0;p<4;p++){var _=kr[p];e.transformMat4(_,_,a);var x=9*p;t[r+x]=_.x,t[r+x+1]=_.y,t[r+x+2]=_.z}r+=36}}},updateVerts:function(t){var e,r,a=t.node._uiProps.uiTransformComp,i=t.renderData.data,n=t.spriteFrame,s=n.getRect(),h=Math.abs(a.width),o=Math.abs(a.height),u=a.anchorX*h,l=a.anchorY*o,c=n.insetLeft,f=n.insetRight,d=s.width-c-f,v=n.insetTop,p=n.insetBottom,_=s.height-v-p,x=a.width/(c+f)>1?1:a.width/(c+f),g=a.height/(v+p)>1?1:a.height/(v+p);e=d>0?Math.floor(1e3*this.sizableWidth)/1e3%d==0?d:this.sizableWidth%d:this.sizableWidth,r=_>0?Math.floor(1e3*this.sizableHeight)/1e3%_==0?_:this.sizableHeight%_:this.sizableHeight;for(var y=0;y<=this.col;y++)0===y?i[y].x=-u:y>0&&y<this.col?1===y?i[y].x=c*x+Math.min(d,this.sizableWidth)-u:d>0?y===this.col-1?i[y].x=c+e+d*(y-2)-u:i[y].x=c+Math.min(d,this.sizableWidth)+d*(y-2)-u:i[y].x=c+this.sizableWidth-u:y===this.col&&(i[y].x=Math.min(c+this.sizableWidth+f,h)-u);for(var m=0;m<=this.row;m++)0===m?i[m].y=-l:m>0&&m<this.row?1===m?i[m].y=p*g+Math.min(_,this.sizableHeight)-l:_>0?m===this.row-1?i[m].y=p+r+(m-2)*_-l:i[m].y=p+Math.min(_,this.sizableHeight)+(m-2)*_-l:i[m].y=p+this.sizableHeight-l:m===this.row&&(i[m].y=Math.min(p+this.sizableHeight+v,o)-l)}},Vr=j.Type,Zr=j.FillType,qr=t("s",{getAssembler:function(t){var e=Pr,r=t;switch(r.type){case Vr.SLICED:e=Nr;break;case Vr.TILED:e=Ur;break;case Vr.FILLED:e=r.fillType===Zr.RADIAL?Er:mr}return e}});j.Assembler=qr;var Gr=Q.sharedManager,Xr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===ot.IMAGE_STENCIL&&(Pr.updateRenderData(t),Pr.updateColor(t))},fillBuffers:function(t,e){(t.type!==ot.IMAGE_STENCIL||t.spriteFrame)&&(Gr.pushMask(t),e.finishMergeBatches(),function(t,e){Gr.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(Gr.enterLevel(t),t.type===ot.IMAGE_STENCIL){Pr.fillBuffers(t,e);var r=t.graphics.getMaterialInstance(0);e.forceMergeBatches(r,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),Gr.enableMask())}},jr={fillBuffers:function(){Gr.exitMask()}},Kr={getAssembler:function(){return Xr}},Qr={getAssembler:function(){return jr}};ht.Assembler=Kr,ht.PostAssembler=Qr;var Yr=new M(null),Jr=new r,$r=t("B",function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new v((function(){return new ut(e)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new p,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._parentOpacity=1,this._descriptorSetCache=new ea,this._root=t,this.device=t.device,this._batches=new _(64),this._drawBatchPool=new x((function(){return new lt}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=at);var e=t===at?36:it(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var r;t instanceof ut?r=t:(r=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var a=r.vertexFormatBytes,i=this._customMeshBuffers.get(a);return i||(i=[],this._customMeshBuffers.set(a,i)),i.push(r),r},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var r=0;r<e.length;r++)if(e[r]===t){e.splice(r,1);break}},d(e,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}}]),t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var r,a=l(this._meshBuffers.keys());!(r=a()).done;){var i=r.value,n=this._meshBuffers.get(i);n&&n.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),Q.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,r=0;r<e.length;r++){var a=e[r];if(a.visibility&t.layer)return a}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var r=t[e];r.enabledInHierarchy&&this._recursiveScreenNode(r.node)}var a=0;if(this._batches.length)for(var i=0;i<this._batches.length;++i){var n=this._batches.array[i];if(n.renderScene){if(n.model)for(var s=n.model.subModels,h=0;h<s.length;h++)s[h].priority=a++;else n.hDescriptorSet=this._descriptorSetCache.getDescriptorSet(n);n.renderScene.addBatch(n)}}},t.uploadBuffers=function(){if(this._batches.length>0){for(var t,e=this._doUploadBuffersCall,r=l(e.keys());!(t=r()).done;){var a=t.value;e.get(a).call(a,this)}for(var i,n=this._meshBuffers,s=l(n.keys());!(i=s()).done;){var h=i.value,o=n.get(h);o&&o.forEach((function(t){t.uploadBuffers(),t.reset()}))}for(var u,c=this._customMeshBuffers,f=l(c.keys());!(u=f()).done;){var d=u.value,v=c.get(d);v&&v.forEach((function(t){t.uploadBuffers(),t.reset()}))}this._descriptorSetCache.update()}},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._parentOpacity=1,this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),Q.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,r,a){var i,n,s=t,h=0,o=0;e?(i=e.getGFXTexture(),n=e.getGFXSampler(),h=e.getHash(),o=e.getSamplerHash()):(i=null,n=null);var u=s._getRenderScene(),l=s.getRenderMaterial(0);s.stencilStage=Q.sharedManager.stage;var c=s.blendHash,f=s.stencilStage;this._currScene===u&&this._currLayer===t.node.layer&&this._currMaterial===l&&this._currBlendTargetHash===c&&this._currDepthStencilStateStage===f&&this._currTextureHash===h&&this._currSamplerHash===o&&this._currTransform===a||(this.autoMergeBatches(this._currComponent),this._currScene=u,this._currComponent=s,this._currTransform=a,this._currMaterial=l,this._currTexture=i,this._currSampler=n,this._currTextureHash=h,this._currSamplerHash=o,this._currBlendTargetHash=c,this._currDepthStencilStateStage=f,this._currLayer=t.node.layer),r&&(r.fillBuffers(s,this),this._applyOpacity(s))},t.commitModel=function(t,e,r){var a;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var i=0;r&&(t.stencilStage!==Y.ENABLED&&t.stencilStage!==Y.DISABLED||(t.stencilStage=Q.sharedManager.stage),a=Q.sharedManager.getStencilStage(t.stencilStage,r),i=Q.sharedManager.getStencilHash(t.stencilStage));var n=u.director.getTotalFrames();e&&(e.updateTransform(n),e.updateUBOs(n));for(var s=0;s<e.subModels.length;s++){var h=this._drawBatchPool.alloc(),o=e.subModels[s];h.renderScene=t._getRenderScene(),h.visFlags=t.node.layer,h.model=e,h.bufferBatch=null,h.texture=null,h.sampler=null,h.useLocalData=null,a||(a=null),h.fillPasses(r,a,i,null,0,o.patches),h.hDescriptorSet=g.get(o.handle,y.DESCRIPTOR_SET),h.hInputAssembler=g.get(o.handle,y.INPUT_ASSEMBLER),h.model.visFlags=h.visFlags,this._batches.push(h)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,r=null==e?void 0:e.recordBatch(),a=this._currMaterial;if(r&&a&&e){var i,n,s=0,h=0;t&&(i=-1===t.blendHash?null:t.getBlendState(),h=t.blendHash,n=null!==t.customMaterial?Q.sharedManager.getStencilStage(t.stencilStage,a):Q.sharedManager.getStencilStage(t.stencilStage),s=Q.sharedManager.getStencilHash(t.stencilStage));var o=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();o.renderScene=this._currScene,o.visFlags=this._currLayer,o.bufferBatch=e,o.texture=this._currTexture,o.sampler=this._currSampler,o.hInputAssembler=r,o.useLocalData=this._currTransform,o.textureHash=this._currTextureHash,o.samplerHash=this._currSamplerHash,o.fillPasses(a,n,s,i,h,null),this._batches.push(o),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,m.__isWebIOS14OrIPadOS14Env&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,r){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=r.node.layer,this._currScene=r._getRenderScene(),this.autoMergeBatches(r)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var r=t.children.length,a=this._parentOpacity;if(this._parentOpacity*=t._uiProps.opacity,this._preProcess(t),r>0&&!t._static)for(var i=t.children,n=0;n<i.length;++n){var s=i[n];this.walk(s,e)}this._postProcess(t),this._parentOpacity=a,e+=1},t._preProcess=function(t){if(t._uiProps.uiTransformComp){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.updateAssembler(this)}},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var r=it(t),a=this._meshBuffers.get(r);return a||(a=[],this._meshBuffers.set(r,a)),a.push(e),e},t._recreateMeshBuffer=function(t,e,r){this.autoMergeBatches(),this._requireBufferBatch(t,e,r)},t._requireBufferBatch=function(t,e,r){var a=it(t),i=this._meshBuffers.get(a);i||(i=[],this._meshBuffers.set(a,i));var n=this._meshBufferUseCount.get(a)||0;n>=i.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=i[n],this._meshBufferUseCount.set(a,n+1),e&&r&&this._currMeshBuffer.request(e,r)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._applyOpacity=function(t){for(var e=t.color.a/255,r=this._parentOpacity*=e,a=this.currBufferBatch,i=a.byteOffset>>2,n=a.vData,s=a.lastByteOffset>>2,h=a.vertexFormatBytes/4,o=s;o<i;o+=h)n[o+ut.OPACITY_OFFSET]*=r;a.lastByteOffset=a.byteOffset},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},e}()),ta=function(){function t(){this._handle=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=u.director.root.device;this._localData=new Float32Array(S.COUNT),this._localBuffer=t.createBuffer(new w(D.UNIFORM|D.TRANSFER_DST,b.HOST|b.DEVICE,S.SIZE,S.SIZE))}d(t,[{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){var e=u.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,Yr.layout=t.passes[0].localSetLayout,this._handle&&(B.free(this._handle),this._handle=null),this._handle=B.alloc(e,Yr),this._descriptorSet=B.get(this._handle),this._descriptorSet.bindBuffer(S.BINDING,this._localBuffer);var r=C.SAMPLER_SPRITE;this._descriptorSet.bindTexture(r,t.texture),this._descriptorSet.bindSampler(r,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,r){return this._transform===t&&this._textureHash===e&&this._samplerHash===r},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._handle&&(B.free(this._handle),this._handle=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;r.toArray(this._localData,e,S.MAT_WORLD_OFFSET),r.inverseTranspose(Jr,e),r.toArray(this._localData,Jr,S.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},t}(),ea=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new x((function(){return new ta}),16)}var e=t.prototype;return e.getDescriptorSet=function(t){var e=u.director.root;if(t.useLocalData){for(var r=this._localDescriptorSetCache,a=0,i=r.length;a<i;a++){var n=r[a];if(n.equals(t.useLocalData,t.textureHash,t.samplerHash))return n.handle}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.handle}var h=this._descriptorSetCache.get(t.textureHash);if(h&&h.has(t.samplerHash))return h.get(t.samplerHash);Yr.layout=t.passes[0].localSetLayout;var o=B.alloc(e.device,Yr),l=B.get(o),c=C.SAMPLER_SPRITE;return l.bindTexture(c,t.texture),l.bindSampler(c,t.sampler),l.update(),h?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,o):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,o]])),o},e.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){B.free(t)})),this._descriptorSetCache.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){B.free(t)}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();u.internal.Batcher2D=$r;var ra,aa=null,ia=-1,na=Object.create(null),sa=[];function ha(){for(var t=!0,e=Date.now(),r=sa.length-1;r>=0;r--){var a=sa[r],i=a.fontFamilyName;if(e-a.startTime>3e3)T(4933,i),a.onComplete(null,i),sa.splice(r,1);else{var n=a.refWidth,s="40px "+i;aa.font=s,n!==V(aa,"BES bswy:->@123",s)?(sa.splice(r,1),a.onComplete(null,i)):t=!1}}t&&(clearInterval(ia),ia=-1)}function oa(t,e,r){var a=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var r,a=t.lastIndexOf("/");return-1!==(r=-1===a?t.substring(0,e)+"_LABEL":t.substring(a+1,e)+"_LABEL").indexOf(" ")&&(r='"'+r+'"'),r}(t);if(na[a])r(null,a);else{if(!aa){var i=document.createElement("canvas");i.width=100,i.height=100,aa=i.getContext("2d")}var n=V(aa,"BES bswy:->@123","40px "+a),s=document.createElement("style");s.type="text/css";var h="";Number.isNaN(a)?h+="@font-face { font-family:"+a+"; src:":h+='@font-face { font-family:"'+a+'"; src:',h+='url("'+t+'");',s.textContent=h+"}",document.body.appendChild(s);var o,u,l,c,f,d,v=document.createElement("div"),p=v.style;if(p.fontFamily=a,v.innerHTML=".",p.position="absolute",p.left="-100px",p.top="-100px",document.body.appendChild(v),function(){if(void 0===ra)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ra=t?parseInt(t[1],10)>42:!e}else ra=!1;return ra}())o=Date.now(),u=a,l=r,c=new Promise((function(t,e){!function r(){Date.now()-o>=3e3?e():document.fonts.load("40px "+u).then((function(e){e.length>=1?t():setTimeout(r,100)}),(function(){e()}))}()})),f=null,d=new Promise((function(t,e){f=setTimeout(e,3e3)})),Promise.race([d,c]).then((function(){f&&(clearTimeout(f),f=null),l(null,u)}),(function(){T(4933,u),l(null,u)}));else{var _={fontFamilyName:a,refWidth:n,onComplete:r,startTime:Date.now()};sa.push(_),-1===ia&&(ia=setInterval(ha,100))}na[a]=s}}function ua(t,e,r,a){var i=new K;i._nativeUrl=t,i._nativeAsset=e,a(null,i)}L.register({".font":oa,".eot":oa,".ttf":oa,".woff":oa,".svg":oa,".ttc":oa}),R.register({".font":ua,".eot":ua,".ttf":ua,".woff":ua,".svg":ua,".ttc":ua}),u.UI={MeshBuffer:ut,spriteAssembler:qr,graphicsAssembler:Yt,labelAssembler:xr}}}}));
