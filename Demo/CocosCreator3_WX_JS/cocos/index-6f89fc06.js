System.register(["./coordinates-converts-utils-bf8713a9.js","./event-enum-5a5aa40e.js","./deprecated-3.0.0-f3f53c89.js","./renderable-component-658e90bd.js","./transform-utils-1f4a2037.js","./view-7d20208a.js","./screen-d46ce30a.js","./json-asset-0797cbb7.js","./camera-component-f1234106.js","./find-5191dd26.js","./factory-9595a1ce.js"],(function(e){"use strict";var t,i,n,r,a,s,o,u,h,l,c,d,p,f,_,m,g,v,y,T,w,b,E,S,A,N,x,I,R,C,P,k,F,M,D,B,L,U,O,H,V,W,z,j,G,Y,q,X,K,J,Q,$,Z,ee,te,ie,ne,re,ae,se,oe,ue,he,le,ce,de,pe,fe,_e,me,ge,ve,ye,Te,we,be,Ee,Se,Ae,Ne,xe,Ie,Re,Ce,Pe,ke,Fe,Me,De,Be,Le,Ue,Oe,He,Ve,We,ze,je,Ge,Ye,qe,Xe,Ke,Je,Qe,$e,Ze,et,tt,it,nt,rt,at,st,ot,ut,ht,lt,ct,dt,pt,ft,_t,mt,gt,vt,yt,Tt,wt,bt,Et,St,At,Nt,xt,It,Rt,Ct,Pt,kt,Ft,Mt,Dt,Bt,Lt,Ut,Ot,Ht,Vt,Wt,zt,jt,Gt,Yt,qt,Xt,Kt,Jt,Qt,$t,Zt,ei,ti,ii,ni,ri,ai,si,oi,ui,hi,li,ci,di,pi,fi,_i,mi,gi,vi,yi,Ti,wi,bi,Ei,Si,Ai,Ni,xi,Ii,Ri,Ci,Pi,ki,Fi,Mi,Di,Bi,Li,Ui,Oi,Hi,Vi,Wi,zi,ji,Gi,Yi;return{setters:[function(e){t=e.a$,i=e.b0,n=e.b1,r=e.b2,a=e.b3,s=e.b4,o=e.b5,u=e.b6,h=e.b7,l=e.b8,c=e.b9,d=e.ba,p=e.bb,f=e.bc,_=e.bd,m=e.be,g=e.bf,v=e.bg,y=e.bh,T=e.bi,w=e.bj,b=e.bk,E=e.bl,S=e.bm,A=e.bn,N=e.bo,x=e.bp,I=e.bq,R=e.br,C=e.bs,P=e.bt,k=e.bu,F=e.bv,M=e.bw,D=e.bx,B=e.by,L=e.bz,U=e.bA,O=e.bB,H=e.e,V=e.dc,W=e.l,z=e.ee,j=e.dh,G=e.dT,Y=e.cO,q=e.cP,X=e.F,K=e.cb,J=e.a2,Q=e.a3,$=e.ah,Z=e.ag,ee=e.B,te=e.v,ie=e.M,ne=e.ew,re=e.A,ae=e.I,se=e.da,oe=e.dL,ue=e.cN,he=e.e4,le=e.e3,ce=e.g,de=e.f,pe=e.d,fe=e.c,_e=e.ez,me=e.eA,ge=e.a1,ve=e.az,ye=e.ay,Te=e.a6,we=e.dl,be=e.t,Ee=e.P,Se=e.ax,Ae=e.dG,Ne=e.dH,xe=e.cW,Ie=e.dJ,Re=e.e0,Ce=e.aw,Pe=e.bL,ke=e.bM,Fe=e.bU,Me=e.eB,De=e.e8,Be=e.c3,Le=e.eC,Ue=e.eD,Oe=e.eE,He=e.c8,Ve=e.eF,We=e.eG,ze=e.eH,je=e.eI,Ge=e.eJ,Ye=e.eK,qe=e.ck,Xe=e.eL,Ke=e.eM,Je=e.eN,Qe=e.eO,$e=e.eP,Ze=e.eQ,et=e.c5,tt=e.eR,it=e.eS,nt=e.eT,rt=e.eU,at=e.eV,st=e.i,ot=e.eW,ut=e.eX,ht=e.eY,lt=e.k,ct=e.eZ,dt=e.ep,pt=e.e_,ft=e.e$,_t=e.o,mt=e.ci,gt=e.cl,vt=e.f0,yt=e.n,Tt=e.e2,wt=e.ec,bt=e.e5,Et=e.e7,St=e.ea,At=e.e9,Nt=e.S,xt=e.x,It=e.cA,Rt=e.N,Ct=e.w,Pt=e.e1,kt=e.Y,Ft=e.f1,Mt=e.f2,Dt=e.f3},function(e){Bt=e.e,Lt=e.L,Ut=e.m,Ot=e.l},function(e){Ht=e.d,Vt=e.e,Wt=e.i,zt=e.L,jt=e.P,Gt=e.R,Yt=e.T,qt=e.S,Xt=e.A,Kt=e.O,Jt=e.C,Qt=e.F,$t=e.K,Zt=e.a,ei=e.E,ti=e.l,ii=e.p,ni=e.b,ri=e.t,ai=e.s,si=e.c,oi=e.o,ui=e.f,hi=e.g},function(e){li=e.R,ci=e.c,di=e.N},function(e){pi=e.m,fi=e.c,_i=e.n,mi=e.o,gi=e.B,vi=e.p,yi=e.b,Ti=e.H,wi=e.C},function(e){bi=e.P,Ei=e.F,Si=e.G,Ai=e.g},function(){},function(e){Ni=e.S},function(e){xi=e.S,Ii=e.a,Ri=e.N,Ci=e.C},function(){},function(e){Pi=e.d,ki=e.f,Fi=e.c,Mi=e.g,Di=e.a,Bi=e.s,Li=e.b,Ui=e.e,Oi=e.h,Hi=e.i,Vi=e.j,Wi=e.B,zi=e.p,ji=e.r,Gi=e.k,Yi=e.l}],execute:function(){e({q:Ir,r:Rr,s:Cr});var qi=Object.freeze({__proto__:null,bits:t,Vec2:i,v2:n,Vec3:r,v3:a,Vec4:s,v4:o,Quat:u,quat:h,Mat3:l,Mat4:c,mat4:d,AffineTransform:p,Size:f,size:_,Rect:m,rect:g,Color:v,color:y,EPSILON:T,equals:w,approx:b,clamp:E,clamp01:S,lerp:A,toRadian:N,toDegree:x,random:I,randomRange:R,randomRangeInt:C,pseudoRandom:P,pseudoRandomRange:k,pseudoRandomRangeInt:F,nextPow2:M,repeat:D,pingPong:B,inverseLerp:L,absMaxComponent:U,absMax:O});e("m",qi);var Xi=Object.freeze({__proto__:null,distance:Ht,enums:Vt,intersect:Wt,Line:zt,Plane:jt,Ray:Gt,Triangle:Yt,Sphere:qt,AABB:Xt,OBB:Kt,Capsule:Jt,Frustum:Qt,Keyframe:$t,AnimationCurve:Zt,get ERaycastMode(){return ei},line:ti,plane:ii,ray:ni,triangle:ri,sphere:ai,aabb:si,obb:oi,capsule:ui,frustum:hi});e("g",Xi);var Ki=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.setting=window._CCSettings.splashScreen;t.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,t.base64src=this.setting.base64src||"",t.effect=this.setting.effect||"FADE-INOUT",t.clearColor=this.setting.clearColor||new V(.88,.88,.88,1),t.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,t.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new V(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{W.view.enableRetina(!0);var i=window._CCSettings.designResolution;i?W.view.setDesignResolutionSize(i.width,i.height,i.policy):W.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,W.game.once(W.Game.EVENT_GAME_INITED,(function(){W.director._lateUpdate=performance.now()}),W.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var n=this.setting.clearColor;this.clearColors=[new V(n.x,n.y,n.z,n.w)];var r=this.device,a=r.width,s=r.height,o=r.surfaceTransform;this.screenWidth=o%2?s:a,this.screenHeight=o%2?a:s,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else H("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),W.game.resume())},e.init=function(){var e=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),W.game.pause(),this.handle=requestAnimationFrame((function t(i){if(!e.cancelAnimate){e.startTime<0&&(e.startTime=i);var n=i-e.startTime,r=S(n/e.setting.totalTime),a=pi(r);"NONE"===e.setting.effect&&(a=1),e.material.setProperty("u_precent",a),e.material.passes[0].update(),e.setting.displayWatermark&&e.textMaterial&&(e.textMaterial.setProperty("u_precent",a),e.textMaterial.passes[0].update()),e.frame(i),n>e.setting.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.frame=function(){if(!this.cancelAnimate){var e=this.device;e.acquire();var t=this.cmdBuff,i=this.framebuffer,n=this.renderArea;n.height=e.height,n.width=e.width,t.begin(),t.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.material.passes[0],a=bi.getOrCreatePipelineState(e,r,this.shader,i.renderPass,this.assmebler);if(t.bindPipelineState(a),t.bindDescriptorSet(z.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.assmebler),t.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var s=this.textMaterial.passes[0],o=bi.getOrCreatePipelineState(e,s,this.textShader,i.renderPass,this.textAssmebler);t.bindPipelineState(o),t.bindDescriptorSet(z.MATERIAL,s.descriptorSet),t.bindInputAssembler(this.textAssmebler),t.draw(this.textAssmebler)}t.endRenderPass(),t.end(),e.queue.submit([t]),e.present()}},e.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var e=this.textImg.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var t="Powered by Cocos Creator",i=e.measureText(t);e.fillText(t,(330-i.width)/2,6),this.textRegion=new j,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new G(Y.TEX2D,q.SAMPLED|q.TRANSFER_DST,X.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new K,this.textMaterial.initialize({effectName:"splash-screen"});var n=this.textMaterial.passes[0],r=n.getBinding("mainTexture");n.bindTexture(r,this.textTexture),this.textShader=J.get(n.getShaderVariant()),Q.get($.get(n.handle,Z.DESCRIPTOR_SET)).update();var a=4*Float32Array.BYTES_PER_ELEMENT,s=4*a;this.textVB=this.device.createBuffer(new ee(te.VERTEX|te.TRANSFER_DST,ie.HOST|ie.DEVICE,s,a));var o=new Float32Array(16),u=-this.textImg.width/2,h=this.textImg.height;h=this.screenWidth<this.screenHeight?(u=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(u=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var l=0;o[l++]=u,o[l++]=h,o[l++]=0,o[l++]=1,o[l++]=-u,o[l++]=h,o[l++]=1,o[l++]=1,o[l++]=u,o[l++]=-h,o[l++]=0,o[l++]=0,o[l++]=-u,o[l++]=-h,o[l++]=1,o[l++]=0;for(var c=0;c<o.length;c+=4)o[c]+=this.screenWidth/2,o[c+1]+=.1*this.screenHeight;for(var d=this.device.screenSpaceSignY,p=ne[this.device.surfaceTransform],f=0;f<o.length;f+=4){var _=o[f]/this.screenWidth*2-1,m=(o[f+1]/this.screenHeight*2-1)*d;o[f]=p[0]*_+p[2]*m,o[f+1]=p[1]*_+p[3]*m}this.textVB.update(o);var g=Uint16Array.BYTES_PER_ELEMENT,v=6*g;this.textIB=this.device.createBuffer(new ee(te.INDEX|te.TRANSFER_DST,ie.HOST|ie.DEVICE,v,g));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var T=[new re("a_position",X.RG32F),new re("a_texCoord",X.RG32F)],w=new ae(T,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(w)},e.initCMD=function(){var e=this.device;this.renderArea=new se(0,0,e.width,e.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=e.commandBuffer},e.initIA=function(){var e=this.device,t=4*Float32Array.BYTES_PER_ELEMENT,i=4*t;this.vertexBuffers=e.createBuffer(new ee(te.VERTEX|te.TRANSFER_DST,ie.HOST|ie.DEVICE,i,t));var n=new Float32Array(16),r=-this.image.width/2,a=this.image.height;a=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var s=0;n[s++]=r,n[s++]=a,n[s++]=0,n[s++]=1,n[s++]=-r,n[s++]=a,n[s++]=1,n[s++]=1,n[s++]=r,n[s++]=-a,n[s++]=0,n[s++]=0,n[s++]=-r,n[s++]=-a,n[s++]=1,n[s++]=0;for(var o=0;o<n.length;o+=4)n[o]+=this.screenWidth/2,n[o+1]+=this.screenHeight/2;for(var u=this.device.screenSpaceSignY,h=ne[this.device.surfaceTransform],l=0;l<n.length;l+=4){var c=n[l]/this.screenWidth*2-1,d=(n[l+1]/this.screenHeight*2-1)*u;n[l]=h[0]*c+h[2]*d,n[l+1]=h[1]*c+h[3]*d}this.vertexBuffers.update(n);var p=Uint16Array.BYTES_PER_ELEMENT,f=6*p;this.indicesBuffers=e.createBuffer(new ee(te.INDEX|te.TRANSFER_DST,ie.HOST|ie.DEVICE,f,p));var _=new Uint16Array(6);_[0]=0,_[1]=1,_[2]=2,_[3]=1,_[4]=3,_[5]=2,this.indicesBuffers.update(_);var m=[new re("a_position",X.RG32F),new re("a_texCoord",X.RG32F)],g=new ae(m,[this.vertexBuffers],this.indicesBuffers);this.assmebler=e.createInputAssembler(g)},e.initPSO=function(){var e=this.device;this.material=new K,this.material.initialize({effectName:"splash-screen"});var t=new oe;t.addressU=ue.CLAMP,t.addressV=ue.CLAMP,this.sampler=e.createSampler(t),this.texture=e.createTexture(new G(Y.TEX2D,q.SAMPLED|q.TRANSFER_DST,X.RGBA8,this.image.width,this.image.height));var i=this.material.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.texture),this.shader=J.get(i.getShaderVariant());var r=Q.get($.get(i.handle,Z.DESCRIPTOR_SET));r.bindSampler(n,this.sampler),r.update(),this.region=new j,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,e.copyTexImagesToTexture([this.image],this.texture,[this.region])},e.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,t._ins=void 0},he(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();Ki._ins=void 0,W.internal.SplashScreen=Ki;var Ji=e("k",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},he(e,[{key:"priority",set:function(e){this._priority=e},get:function(){return this._priority}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}()),Qi=new me("Scheduler"),$i=function(e,t,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=n};$i.get=function(e,t,i,n){var r=$i._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=i,r.markedForDeletion=n):r=new $i(e,t,i,n),r},$i.put=function(e){$i._listEntries.length<20&&(e.target=null,$i._listEntries.push(e))},$i._listEntries=[];var Zi=function(e,t,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=n};Zi.get=function(e,t,i,n){var r=Zi._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=i,r.callback=n):r=new Zi(e,t,i,n),r},Zi.put=function(e){Zi._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Zi._hashUpdateEntries.push(e))},Zi._hashUpdateEntries=[];var en=function(e,t,i,n,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=a};en.get=function(e,t,i,n,r,a){var s=en._hashTimerEntries.pop();return s?(s.timers=e,s.target=t,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=a):s=new en(e,t,i,n,r,a),s},en.put=function(e){en._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,en._hashTimerEntries.push(e))},en._hashTimerEntries=[];var tn=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,n,r,a){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=n,this._delay=a,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===W.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();tn._timers=[],tn.get=function(){return tn._timers.pop()||new tn},tn.put=function(e){tn._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,tn._timers.push(e))};var nn=e("S",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=_e(!0),t._hashForTimers=_e(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}le(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?pe(1513):e.id=Qi.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,n,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=(i=this._updatesNegList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updates0List).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updatesPosList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);var s=this._arrayForTimers;for(t=0;t<s.length;t++){if(a=s[t],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(e),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,n,r,a){if("function"!=typeof e){var s=e;e=t,t=s}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!n,n=W.macro.REPEAT_FOREVER,r=0),ce(t,1502);var o=t.uuid||t.id;if(o){var u,h,l=this._hashForTimers[o];if(l?l.paused!==a&&pe(1511):(l=en.get(null,t,0,null,null,a),this._arrayForTimers.push(l),this._hashForTimers[o]=l),null==l.timers)l.timers=[];else for(h=0;h<l.timers.length;++h)if((u=l.timers[h])&&e===u._callback)return fe(1507,u.getInterval(),i),void(u._interval=i);(u=tn.get()).initWithCallback(this,e,t,i,n,r),l.timers.push(u),this._currentTarget===l&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else de(1510)},i.scheduleUpdate=function(e,t,i){var n=e.uuid||e.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return fe(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(e)}var a,s=$i.get(e,t,i,!1);0===t?(a=this._updates0List,this._appendIn(a,s)):(a=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,s,t)),this._hashForUpdates[n]=Zi.get(a,s,e,null)}else de(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(n)for(var r=n.timers,a=0,s=r.length;a<s;a++){var o=r[a];if(e===o._callback)return o!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(a,1),tn.put(o),n.timerIndex>=a&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}else de(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else de(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,a=n.length;r<a;r++)tn.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else de(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(W.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(e){var t,i,n,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)i=r[t],this.unscheduleAllForTarget(i.target);var a=0;if(e<0)for(t=0;t<this._updatesNegList.length;)a=this._updatesNegList.length,(n=this._updatesNegList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),a===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)a=this._updates0List.length,(n=this._updates0List[t])&&this.unscheduleUpdate(n.target),a===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)a=this._updatesPosList.length,(n=this._updatesPosList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),a===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){ce(e,1508),ce(t,1509);var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,a=0;a<r.length;++a)if(e===r[a]._callback)return!0;return!1}de(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(W.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,n,r,a=[],s=this._arrayForTimers;for(i=0,n=s.length;i<n;i++)(t=s[i])&&(t.paused=!0,a.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=e&&(r.paused=!0,a.push(r.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,a.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=e&&(r.paused=!0,a.push(r.target));return a},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){ce(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var n=this._hashForUpdates[t];n&&(n.entry.paused=!0)}else de(1510)},i.resumeTarget=function(e){ce(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var n=this._hashForUpdates[t];n&&(n.entry.paused=!1)}else de(1510)},i.isTargetPaused=function(e){ce(e,1505);var t=e.uuid||e.id;if(!t)return de(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var n=this._hashForUpdates[t];return!!n&&n.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===e){i.splice(n,1);break}en.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var n=i.list,r=i.entry,a=0,s=n.length;a<s;a++)if(n[a]===r){n.splice(a,1);break}delete this._hashForUpdates[t],$i.put(r),Zi.put(i)}},i._priorityIn=function(e,t,i){for(var n=0;n<e.length;n++)if(i<e[n].priority)return void e.splice(n,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(Ji));nn.PRIORITY_SYSTEM=1<<31,nn.PRIORITY_NON_SYSTEM=nn.PRIORITY_SYSTEM+1,nn.ID="scheduler",W.Scheduler=nn;var rn=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=ge,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}},he(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return Te.get(ve.get(this._poolHandle,ye.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===ve.get(this._poolHandle,ye.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===ve.get(this._poolHandle,ye.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]);var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=ve.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=t.renderPassInfo,n=i.colorAttachments,r=i.depthStencilAttachment,a=0;a<n.length;a++)n[a].format===X.UNKNOWN&&(n[a].format=e.colorFormat);r&&r.format===X.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var s=0;s<n.length;s++){var o=null;this._swapchainBufferIndices&1<<s?ve.set(this._poolHandle,ye.HAS_ON_SCREEN_ATTACHMENTS,1):(o=e.createTexture(new G(Y.TEX2D,q.COLOR_ATTACHMENT|q.SAMPLED,n[s].format,this._width,this._height)),ve.set(this._poolHandle,ye.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(o)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new G(Y.TEX2D,q.DEPTH_STENCIL_ATTACHMENT|q.SAMPLED,r.format,this._width,this._height)),ve.set(this._poolHandle,ye.HAS_OFF_SCREEN_ATTACHMENTS,1)):ve.set(this._poolHandle,ye.HAS_ON_SCREEN_ATTACHMENTS,1));var u=Te.alloc(e,new we(this._renderPass,this._colorTextures,this._depthStencilTexture));return ve.set(this._poolHandle,ye.FRAMEBUFFER,u),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(Te.get(ve.get(this._poolHandle,ye.FRAMEBUFFER)).destroy(),this._poolHandle=ge)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),i=!0);for(var n=0;n<this._colorTextures.length;n++){var r=this._colorTextures[n];r&&(r.resize(e,t),i=!0)}var a=Te.get(ve.get(this._poolHandle,ye.FRAMEBUFFER));i&&a&&(a.destroy(),a.initialize(new we(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var s,o=be(this._cameras);!(s=o()).done;){var u=s.value;u.isWindowSize&&u.resize(e,t)}},t.extractRenderCameras=function(){for(var e=[],t=0;t<this._cameras.length;t++){var i=this._cameras[t];i.enabled&&(i.update(),e.push(i))}return e},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},e}(),an=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=ge,this._device=e,this._dataPoolMgr=W.internal.DataPoolManager&&new W.internal.DataPoolManager(e),li.registerCreateFunc(this),rn.registerCreateFunc(this),this._cameraPool=new Ee((function(){return new Bt(t._device)}),4)}he(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(e){this._curWindow=e},get:function(){return this._curWindow}},{key:"tempWindow",set:function(e){this._tempWindow=e},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Se.get(this._poolHandle,Ce.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Se.get(this._poolHandle,Ce.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=Se.alloc();var t=new Ae,i=new Ne;i.depthStoreOp=xe.DISCARD,i.stencilStoreOp=xe.DISCARD;var n=new Ie([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:n,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(Re.initBuiltinRes(this._device)).then((function(){W.view.on("design-resolution-changed",(function(){var t=W.game.canvas.width,i=W.game.canvas.height;e.resize(t,i)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Se.free(this._poolHandle),this._poolHandle=ge)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var i,n=be(this._windows);!(i=n()).done;){var r=i.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}},t.setRenderPipeline=function(e){if(e||(e=this.createDefaultPipeline()),this._pipeline=e,!this._pipeline.activate())return!1;var t=W.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&W.internal.Batcher2D&&(this._batcher=new W.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.createDefaultPipeline=function(){var e=new Ei;return e.initialize({flows:[]}),e},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Se.set(this._poolHandle,Ce.CUMULATIVE_TIME,0)},t.frameMove=function(e){var t=this;Se.set(this._poolHandle,Ce.FRAME_TIME,e),++this._frameCount,Se.set(this._poolHandle,Ce.CUMULATIVE_TIME,Se.get(this._poolHandle,Ce.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var i=0;i<this._scenes.length;++i)this._scenes[i].removeBatches();this._batcher&&this._batcher.update(),this._pipeline&&function(){t._device.acquire();var e=t._windows,i=t._scenes,n=W.director.getTotalFrames();t._batcher&&t._batcher.uploadBuffers();for(var r=0;r<i.length;r++)i[r].update(n);W.director.emit(W.Director.EVENT_BEFORE_COMMIT);for(var a=[],s=0;s<e.length;s++)e[s].extractRenderCameras().forEach((function(e){a.push(e)}));a.sort((function(e,t){return e.priority-t.priority})),t._pipeline.render(a),t._device.present()}(),this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=be(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=be(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new Ee((function(){return new e}),10)),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):pe(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new Ee((function(){return new e}),4)),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case Lt.SPHERE:e.scene.removeSphereLight(e);break;case Lt.SPOT:e.scene.removeSpotLight(e)}},e}();W.Root=an;var sn={};Pe(sn,"vmath",[{name:"vec2",newName:"Vec2",target:qi,targetName:"math"},{name:"vec3",newName:"Vec3",target:qi,targetName:"math"},{name:"vec4",newName:"Vec4",target:qi,targetName:"math"},{name:"quat",newName:"Quat",target:qi,targetName:"math"},{name:"mat3",newName:"Mat3",target:qi,targetName:"math"},{name:"mat4",newName:"Mat4",target:qi,targetName:"math"},{name:"color4",newName:"Color",target:qi,targetName:"math"},{name:"rect",newName:"Rect",target:qi,targetName:"math"},{name:"approx",newName:"approx",target:qi,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:qi,targetName:"math"},{name:"equals",newName:"equals",target:qi,targetName:"math"},{name:"clamp",newName:"clamp",target:qi,targetName:"math"},{name:"clamp01",newName:"clamp01",target:qi,targetName:"math"},{name:"lerp",newName:"lerp",target:qi,targetName:"math"},{name:"toRadian",newName:"toRadian",target:qi,targetName:"math"},{name:"toDegree",newName:"toDegree",target:qi,targetName:"math"},{name:"random",newName:"random",target:qi,targetName:"math"},{name:"randomRange",newName:"randomRange",target:qi,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:qi,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:qi,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:qi,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:qi,targetName:"math"},{name:"repeat",newName:"repeat",target:qi,targetName:"math"},{name:"pingPong",newName:"pingPong",target:qi,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:qi,targetName:"math"}]),W.vmath=sn,Pe(nn.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:nn,targetName:"Scheduler"}]),Pe(Ut.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:Ut,targetName:"EventTouch"}]),Pe(ci.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ke(ci.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),Pe(an.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]);var on=e("D",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new nn,t._compScheduler=new Ii,t._nodeActivator=new Ri,t._systems=[],W.game.once(Si.EVENT_RENDERER_INITED,t._initOnRendererInitialized,De(t)),t}le(t,e);var i=t.prototype;return i.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},i.convertToGL=function(e){var t=W.game.container,i=W.view,r=t.getBoundingClientRect(),a=r.left+window.pageXOffset-t.clientLeft,s=r.top+window.pageYOffset-t.clientTop,o=i._devicePixelRatio*(e.x-a),u=i._devicePixelRatio*(s+r.height-e.y);return i._isRotated?n(i._viewportRect.width-u,o):n(o,u)},i.convertToUI=function(e){var t=W.game.container,i=W.view,r=t.getBoundingClientRect(),a=r.left+window.pageXOffset-t.clientLeft,s=r.top+window.pageYOffset-t.clientTop,o=n(0,0);return i._isRotated?(o.x=a+e.y/i._devicePixelRatio,o.y=s+r.height-(i._viewportRect.width-e.x)/i._devicePixelRatio):(o.x=a+e.x*i._devicePixelRatio,o.y=s+r.height-e.y*i._devicePixelRatio),o},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return _(W.winSize)},i.getWinSizeInPixels=function(){return _(W.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){W.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Ot&&Ot.setEnabled(!1),W.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),W.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),Ot&&Ot.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof Ni&&(e=e.scene),ce(e instanceof xi,1216),e._load();for(var n=Object.keys(W.game._persistRootNodes).map((function(e){return W.game._persistRootNodes[e]})),r=0;r<n.length;r++){var a=n[r];a.emit(W.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var s=e.getChildByUuid(a.uuid);if(s){var o=s.getSiblingIndex();s._destroyImmediate(),e.insertChild(a,o)}else a.parent=e}var u=this._scene;W.isValid(u)&&u.destroy(),W.assetManager._releaseManager._autoRelease(u,e,n),this._scene=null,Fe._deferredDestroy(),t&&t(),this.emit(W.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(W.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var n=this;e instanceof Ni&&(e=e.scene),ce(e,1205),ce(e instanceof xi,1216),e._load(),this.once(W.Director.EVENT_AFTER_DRAW,(function(){n.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var n=this;if(this._loadingScene)return pe(1208,e,this._loadingScene),!1;var r=W.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));return r?(this.emit(W.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,a){console.timeEnd("LoadScene "+e),n._loadingScene="",r?(H(r),t&&t(r)):n.runSceneImmediate(a,i,t)})),!0):(de(1209,e),!1)},i.preloadScene=function(e,t,i){var n=W.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));if(n)n.preloadScene(e,null,t,i);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(r)),H("preloadScene: "+r)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||fe(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(e){W.Camera.main&&(W.Camera.main.depth=!!e)},i.setClearColor=function(e){W.Camera.main&&(W.Camera.main.backgroundColor=e)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/W.game.getFrameRate()},i.setAnimationInterval=function(e){W.game.setFrameRate(Math.round(1e3/e))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(nn.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(Ji.sortByPriority)},i.unregisterSystem=function(e){Me.fastRemove(this._systems,e),this._systems.sort(Ji.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(W.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var i=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var n=0;n<this._systems.length;++n)this._systems[n].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(t.EVENT_AFTER_UPDATE),Fe._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(i)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),Ot.frameUpdateListeners(),di.bookOfChange.clear(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,Ot&&Ot.setEnabled(!0),this.registerSystem(nn.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new an(W.game._gfxDevice),this._root.initialize({}).catch((function(e){return de(1217),Promise.reject(e)}))},he(t,[{key:"root",get:function(){return this._root}}]),t}(Be));on.EVENT_INIT="director_init",on.EVENT_RESET="director_reset",on.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",on.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",on.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",on.EVENT_BEFORE_UPDATE="director_before_update",on.EVENT_AFTER_UPDATE="director_after_update",on.EVENT_BEFORE_DRAW="director_before_draw",on.EVENT_AFTER_DRAW="director_after_draw",on.EVENT_BEFORE_COMMIT="director_before_commit",on.EVENT_BEFORE_PHYSICS="director_before_physics",on.EVENT_AFTER_PHYSICS="director_after_physics",on.instance=void 0,W.Director=on;var un=e("f",on.instance=W.director=new on),hn=new(function(){function e(){this._loading=new Le,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=Ue.createMap(!0),a=null;if(Array.isArray(t)){(t=Oe(t)).length!==e.length&&de(4915);for(var s=0;s<e.length;s++)r[e[s]+"@import"]=t[s]}else{var o=Ue._getClassId(He);if(t.type===o&&t.data){var u=t.data;u.length!==e.length&&de(4915);for(var h=0;h<e.length;h++)r[e[h]+"@import"]=Ve(o,{base:u[h][0],mipmaps:u[h][1]})}else a=new Error("unmatched type pack!"),r=null}n(a,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?Ue.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(We.has(e.id))i(null,We.get(e.id));else{var r=e.info.packs,a=r.find((function(e){return n._loading.has(e.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:i,id:e.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:i,id:e.id}]);var s=ze(a.uuid,{ext:a.ext,bundle:e.config.name});Pi.download(a.uuid,s,a.ext,e.options,(function(t,i){We.remove(a.uuid),t&&H(t.message,t.stack),n.unpack(a.packedUuids,i,a.ext,e.options,(function(e,i){if(!e)for(var r in i)We.add(r,i[r]);for(var s=n._loading.remove(a.uuid),o=0,u=s.length;o<u;o++){var h=s[o];if(t||e)h.onComplete(t||e);else{var l=i[h.id];l?h.onComplete(null,l):h.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else Pi.download(e.id,e.url,e.ext,e.options,i)},e}());function ln(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,a=[],s=r.total;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],ki(e.input,(function(n,o){if(!n.isNative&&Ye.has(n.uuid)){var u=Ye.get(n.uuid);return u.addRef(),dn(n,e,u,null,u.__asyncLoadAssets__,a,s),void o()}hn.load(n,e.options,(function(u,h){u?e.isFinish||(!W.assetManager.force||i?(H(u.message,u.stack),r.canInvoke=!1,t(u)):dn(n,e,null,null,!1,a,s)):e.isFinish||dn(n,e,null,h,!n.isNative,a,s),o()}))}),(function(){if(e.isFinish)return Fi(e,!0),void e.dispatch("error");if(a.length>0){var s=je.create({input:a,progress:r,options:n,onProgress:e.onProgress,onError:je.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,s.output),s.recycle()),i&&cn(e),t(n)}});Ge.async(s)}else i&&cn(e),t()}))}function cn(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}function dn(e,t,i,n,r,a,s){var o=t.options.__exclude__,u=t.progress;e.content=i,e.file=n,t.output.push(e),r&&(o[e.uuid]=!0,Mi(e.uuid,n||i,o,a,!0,!1,e.config),u.total=s+a.length),u.canInvoke&&t.dispatch("progress",++u.finish,u.total,e)}var pn=new(function(e){function t(){return e.apply(this,arguments)||this}le(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return pe(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var a=e.childNodes[n];1===a.nodeType&&("key"===a.tagName?i=a.firstChild.nodeValue:t[i]=this._parseNode(a))}return t},t}(e("v",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function fn(e,t){return e[t]<<8|e[t+1]}var _n=new(function(){function e(){this._parsing=new Le,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parseAudio=function(e,t,i){e instanceof ArrayBuffer?qe.__audioSupport.context.decodeAudioData(e,(function(e){i(null,e)}),(function(e){i(new Error("Error with decoding audio data"+e.err),null)})):i(null,e)},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Int32Array(a,0,13);if(55727696===s[0]){var o=s[7],u=s[6],h=s[12]+52;r={_data:new Uint8Array(a,h),_compressed:!0,width:o,height:u,format:0}}else{if(559044176!==s[11])throw new Error("Invalid magic number in PVR header");var l=s[0],c=s[1],d=s[2];r={_data:new Uint8Array(a,l),_compressed:!0,width:d,height:c,format:0}}}catch(e){n=e}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Uint8Array(a),o=fn(s,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var u=fn(s,12),h=fn(s,14);fn(s,8),fn(s,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:u,height:h,format:0}}catch(e){n=e}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Uint8Array(a);if(1554098963!==s[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=s[4],u=s[5],h=s[6];if((o<3||o>6||u<3||u>6||h<3||h>6)&&(o<4||7===o||9===o||11===o||o>12||u<4||7===u||9===u||11===u||u>12||1!==h))throw new Error("Invalid block number in ASTC header");var l=function(e,t){return 4===e?$e.RGBA_ASTC_4x4:5===e?4===t?$e.RGBA_ASTC_5x4:$e.RGBA_ASTC_5x5:6===e?5===t?$e.RGBA_ASTC_6x5:$e.RGBA_ASTC_6x6:8===e?5===t?$e.RGBA_ASTC_8x5:6===t?$e.RGBA_ASTC_8x6:$e.RGBA_ASTC_8x8:10===e?5===t?$e.RGBA_ASTC_10x5:6===t?$e.RGBA_ASTC_10x6:8===t?$e.RGBA_ASTC_10x8:$e.RGBA_ASTC_10x10:10===t?$e.RGBA_ASTC_12x10:$e.RGBA_ASTC_12x12}(o,u),c=s[7]+(s[8]<<8)+(s[9]<<16),d=s[10]+(s[11]<<8)+(s[12]<<16);s[13],s[14],s[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:c,height:d,format:l}}catch(e){n=e}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=pn.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=Xe(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Ke(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var a=this,s=Je.get(e);if(s)r(null,s);else{var o=this._parsing.get(e);if(o)o.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?We.remove(e):Qe(i)||Je.add(e,i);for(var n=a._parsing.remove(e),r=0,s=n.length;r<s;r++)n[r](t,i)}))):r(null,t)}}},e}());function mn(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],ki(e.input,(function(a,s){var o=je.create({input:a,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinish&&(!W.assetManager.force||i?(H(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,a)),e.output.push(u),o.recycle(),s(null)}});gn.async(o)}),(function(){if(n.__exclude__=null,e.isFinish)return Fi(e,!0),void e.dispatch("error");Ui(e),Fi(e,!0),t()}))}var gn=new Ze("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,a=i.uuid,s=i.file,o=n.reloadAsset;s||!o&&!r&&Ye.has(a)?t():hn.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,a=i.id,s=i.file,o=i.options;if(i.isNative)_n.parse(a,s,i.ext,o,(function(r,s){r?t(r):(i.content=s,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),We.remove(a),Je.remove(a),t())}));else{var u=i.uuid;if(u in r){var h=r[u],l=h.finish,c=h.content,d=h.err,p=h.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),l||Di(u,u,r)?(c&&c.addRef(),i.content=c,t(d)):p.push({done:t,item:i})}else if(!o.reloadAsset&&Ye.has(u)){var f=Ye.get(u);o.__asyncLoadAssets__||!f.__asyncLoadAssets__?(i.content=f.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()):vn(e,f,t,!1)}else o.__uuid__=u,_n.parse(a,s,"import",o,(function(i,n){i?t(i):vn(e,n,t,!0)}))}}]);function vn(e,t,i,n){var r=e.input,a=e.progress,s=r,o=s.uuid,u=s.id,h=s.options,l=s.config,c=h.__asyncLoadAssets__,d=h.cacheAsset,p=[];t.addRef&&t.addRef(),Mi(o,t,Object.create(null),p,!1,c,l),a.canInvoke&&e.dispatch("progress",++a.finish,a.total+=p.length,r);var f=e.options.__exclude__[o]={content:t,finish:!1,callbacks:[{done:i,item:r}]},_=je.create({input:p,options:e.options,onProgress:e.onProgress,onError:je.prototype.recycle,progress:a,onComplete:function(e){if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=c,f.finish=!0,f.err=e,!e){for(var i,r=Array.isArray(_.output)?_.output:[_.output],a=Object.create(null),s=be(r);!(i=s()).done;){var h=i.value;h&&(a[h instanceof et?h._uuid+"@import":o+"@native"]=h)}if(n){Bi(o,t,a);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){H(e.message,e.stack)}We.remove(u),Je.remove(u),Li(o,t,d)}else if(t.__nativeDepend__){Bi(o,t,a);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){H(e.message,e.stack)}}_.recycle()}for(var l=f.callbacks,p=0,m=l.length;p<m;p++){var g=l[p];t.addRef&&t.addRef(),g.item.content=t,g.done(e)}l.length=0}});tt.async(_)}function yn(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var a in i)switch(a){case it.PATH:case it.UUID:case it.DIR:case it.SCENE:case it.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[a]=i[a];break;case"__exclude__":case"__outputAsArray__":r[a]=i[a];break;default:n[a]=i[a],r[a]=i[a]}e.options=r;var s=je.create({input:e.input,options:n}),o=null;try{e.output=e.source=nt.sync(s)}catch(e){o=e;for(var u=0,h=s.output.length;u<h;u++)s.output[u].recycle()}s.recycle(),t(o)}var Tn=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},he(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();Tn.MAX_DEAD_NUM=500,Tn._deadPool=[];var wn=[];function bn(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(n){var r=i[n],a=Tn.create(),s=null,o=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||it.UUID]=i[n]),"object"==typeof r)for(var u in rt(r,t),r.preset&&rt(r,at[r.preset]),r){switch(u){case it.UUID:if("break"===function(){var e=a.uuid=ut(r.uuid);if(!r.bundle){var t=ot.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(ot.has(r.bundle)){if(s=ot.get(r.bundle).config,(o=s.getAssetInfo(e))&&o.redirect){if(!ot.has(o.redirect))throw new Error("Please load bundle "+o.redirect+" first");s=ot.get(o.redirect).config,o=s.getAssetInfo(e)}a.config=s,a.info=o}return a.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case it.DIR:if(ot.has(r.bundle)){ot.get(r.bundle).config.getDirWithPath(r.dir,r.type,wn);for(var h,l=be(wn);!(h=l()).done;){var c=h.value;i.push({uuid:c.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}wn.length=0}a.recycle(),a=null;break;case it.PATH:if(ot.has(r.bundle)){if(s=ot.get(r.bundle).config,(o=s.getInfoWithPath(r.path,r.type))&&o.redirect){if(!ot.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");s=ot.get(o.redirect).config,o=s.getAssetInfo(o.uuid)}if(!o)throw a.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);a.config=s,a.uuid=o.uuid,a.info=o}a.ext=r.ext||".json";break;case it.SCENE:if(!r.bundle){var d=ot.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=d&&d.name}if(ot.has(r.bundle)){if(s=ot.get(r.bundle).config,(o=s.getSceneInfo(r.scene))&&o.redirect){if(!ot.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");s=ot.get(o.redirect).config,o=s.getAssetInfo(o.uuid)}if(!o)throw a.recycle(),new Error("Bundle "+s.name+" doesn't contain scene "+r.scene);a.config=s,a.uuid=o.uuid,a.info=o}break;case"__isNative__":a.isNative=r.__isNative__;break;case it.URL:a.url=r.url,a.uuid=r.uuid||r.url,a.ext=r.ext||st(r.url),a.isNative=void 0===r.__isNative__||r.__isNative__;break;default:a.options[u]=r[u]}if(!a)break}if(!a)return"continue";if(e.output.push(a),!a.uuid&&!a.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<i.length;r++)n(r);return null}function En(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,a,s=n.config;a=n.isNative?s&&s.nativeBase?s.base+s.nativeBase:W.assetManager.generalNativeBase:s&&s.importBase?s.base+s.importBase:W.assetManager.generalImportBase;var o=n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?a+"/"+o.slice(0,2)+"/"+o+u+"/"+n.options.__nativeName__:a+"/"+o.slice(0,2)+"/"+o+u+n.ext,n.url=r}}return null}var Sn=e("A",function(){function e(){this.pipeline=tt.append(yn).append(mn),this.fetchPipeline=Ge.append(yn).append(ln),this.transformPipeline=nt.append(bn).append(En),this.bundles=ot,this.assets=Ye,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=ht,this.force=!!dt,this.allowImageBitmap=!qe.isMobile,this.utils=pt,this.downloader=Pi,this.parser=_n,this.packManager=hn,this.cacheAsset=!0,this.cacheManager=null,this.presets=at,this.factory=Hi,this.preprocessPipe=yn,this.fetchPipe=ln,this.loadPipe=mn,this.references=ft,this._releaseManager=Vi,this._files=We,this._parsed=Je,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return ot.get(e)||null},t.removeBundle=function(e){e._destroy(),ot.remove(e.name)},t.loadAny=function(e,t,i,n){var r=zi(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.preset=a.preset||"default",e=Array.isArray(e)?e.slice():e;var u=new je({input:e,onProgress:s,onComplete:Oi(o),options:a});tt.async(u)},t.preloadAny=function(e,t,i,n){var r=zi(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.preset=a.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=new je({input:e,onProgress:s,onComplete:Oi(o),options:a});Ge.async(u)},t.postLoadNative=function(e,t,i){var n=zi(t,void 0,i),r=n.options,a=n.onComplete;if(e._native&&e.__nativeDepend__){var s=ht.getNativeDep(e._uuid);if(s){if(!ot.has(s.bundle)){var o=ot.find((function(t){return!!t.getAssetInfo(e._uuid)}));o&&(s.bundle=o.name)}this.loadAny(s,r,(function(t,i){t?H(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=i,e.__nativeDepend__=!1),a&&a(t)}))}}else Oi(a)(null)},t.loadRemote=function(e,t,i){var n=zi(t,void 0,i),r=n.options,a=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(H(t.message,t.stack),a&&a(t,i)):Hi.create(e,i,r.ext||st(e),r,(function(e,t){a&&a(e,t)}))}))):Oi(a)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=zi(t,void 0,i),r=n.options,a=n.onComplete,s=lt(e);this.bundles.has(s)?Oi(a)(null,this.getBundle(s)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(H(t.message,t.stack),a&&a(t,i)):Hi.create(e,i,"bundle",r,(function(e,t){a&&a(e,t)}))})))},t.releaseAsset=function(e){Vi.tryRelease(e,!0)},t.releaseUnusedAssets=function(){Ye.forEach((function(e){Vi.tryRelease(e)}))},t.releaseAll=function(){Ye.forEach((function(e){Vi.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},he(e,[{key:"main",get:function(){return ot.get(ct.MAIN)||null}},{key:"resources",get:function(){return ot.get(ct.RESOURCES)||null}}]),e}());Sn.Pipeline=Ze,Sn.Task=je,Sn.Cache=Le,Sn.RequestItem=Tn,Sn.Bundle=Wi,Sn.BuiltinBundleName=ct;var An=e("h",W.assetManager=new Sn);W.AssetManager=Sn;var Nn=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],xn=[".mp3",".ogg",".wav",".m4a"];function In(){return!0}var Rn={transformURL:function(e){var t=vt(e);if(!t)return e;var i=ot.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var n,r=i.getAssetInfo(t);if(!(n=e.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(n))return e;var a=!1;if(".ttf"===st(e)&&(a=!0),a){var s=yt(e),o=lt(e);e=s+"."+n+"/"+o}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+n}));return e}},Cn=e("i",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=Gi}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var n=Array.isArray(e)?e:[e],r=0;r<n.length;r++){var a=n[r];"string"==typeof a?n[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var s=[],o=[];An.loadAny(n,null,(function(e,i,n){n.content&&(Nn.includes(n.ext)?s.push(n.content):xn.includes(n.ext)&&o.push(n.content)),t&&t(e,i,n)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var a=function(e){var i=t[e];if(!(i instanceof et)){var r=i,a=n[e].url;s.includes(r)?Hi.create(a,i,".png",{},(function(i,n){r=t[e]=n})):o.includes(r)&&Hi.create(a,i,".mp3",{},(function(i,n){r=t[e]=n})),Ye.add(a,r)}},u=0;u<t.length;u++)a(u);if(t.length>1){var h=Object.create(null);t.forEach((function(e){h[e._uuid]=e})),r={isCompleted:In,_map:h}}else r=t[0]}i&&i(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return An.assets.has(e)?{content:An.assets.get(e)}:null},t.loadRes=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete,u=st(e);u&&!ji.getInfoWithPath(e,a)&&(e=e.slice(0,-u.length)),ji.load(e,a,s,o)},t.loadResArray=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;e.forEach((function(t,i){var n=st(t);n&&!ji.getInfoWithPath(t,a)&&(e[i]=t.slice(0,-n.length))})),ji.load(e,a,s,o)},t.loadResDir=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;ji.loadDir(e,a,s,(function(t,i){var n=[];t||(n=ji.getDirWithPath(e,a).map((function(e){return e.path}))),o&&o(t,i,n)}))},t.getRes=function(e,t){return Ye.has(e)?Ye.get(e):ji.get(e,t)},t.getResCount=function(){return Ye.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return ht.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({url:e},i)}};for(var n in e)i(n);Pi.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({content:e},i)}};for(var n in e)i(n);_n.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=Ye.get(i)),An.releaseAsset(i)}else e&&("string"==typeof e&&(e=Ye.get(e)),An.releaseAsset(e))},t.releaseAsset=function(e){An.releaseAsset(e)},t.releaseRes=function(e,t){ji.release(e,t)},t.releaseAll=function(){An.releaseAll(),Ye.clear()},t.removeItem=function(e){return!!Ye.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=ht.getDepsRecursively(e),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},he(e,[{key:"onProgress",set:function(e){Yi(e)}},{key:"_cache",get:function(){return Ye._map}},{key:"md5Pipe",get:function(){return Rn}},{key:"downloader",get:function(){return Pi}},{key:"loader",get:function(){return An.parser}}]),e}()),Pn=e("l",new Cn),kn=e("j",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,An.init(e),e.rawAssets&&ji.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:ct.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){An.loadAny(e,t)}}),Fn=e("u",{});Pe(Fn,"url",[{name:"normalize",target:An.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?ze({path:_t(e.substr(10)),bundle:ct.RESOURCES,__isNative__:!0,ext:st(e)}):""}}]),ke(kn,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ke(Pn,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),Pe(W,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return Pn}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return kn}},{name:"Pipeline",target:Sn,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return Fn}}]),ke(W,"cc",[{name:"LoadingItems",suggest:mt(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),Pe(gt,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:Pi,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),Pe(un,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return An.main?null===(t=An.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),Pe(Ai,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return An.main&&An.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var Mn,Dn,Bn,Ln,Un,On,Hn,Vn,Wn,zn,jn=Vi._autoRelease;Vi._autoRelease=function(e,t,i){jn.call(Vi,e,t,i);for(var n=Pn._autoReleaseSetting,r=Object.keys(n),a=0;a<r.length;a++){var s=r[a];if(!0===n[s]){var o=Ye.get(s);o&&Vi.tryRelease(o)}}};var Gn,Yn,qn,Xn,Kn,Jn,Qn=e("E",(Mn=Tt("cc.ClickEvent"),Dn=wt(W.Node),Mn((zn=function(){function e(){Et(this,"target",Un,this),Et(this,"component",On,this),Et(this,"_componentId",Hn,this),Et(this,"handler",Vn,this),Et(this,"customEventData",Wn,this)}e.emitEvents=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var a=0,s=t.length;a<s;a++){var o=t[a];o instanceof e&&o.emit(n)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(W.isValid(t)){this._genCompIdIfNeeded();var i=W.js._getClassById(this._componentId),n=t.getComponent(i);if(W.isValid(n)){var r=n[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(n,e))}}},t._compName2Id=function(e){var t=W.js.getClassByName(e);return W.js._getClassId(t)},t._compId2Name=function(e){var t=W.js._getClassById(e);return W.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},he(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),Un=bt((Ln=zn).prototype,"target",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),On=bt(Ln.prototype,"component",[St,At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Hn=bt(Ln.prototype,"_componentId",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vn=bt(Ln.prototype,"handler",[St,At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Wn=bt(Ln.prototype,"customEventData",[St,At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Bn=Ln))||Bn));W.Component.EventHandler=Qn,Pe(Ci,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),Pe(Ci.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),W.CameraComponent=Ci,Ue.setClassAlias(Ci,"cc.CameraComponent");var $n,Zn,er,tr,ir,nr,rr,ar,sr,or,ur,hr=e("U",Tt("cc.animation.UniformProxyFactory")((Jn=function(){function e(e,t){Et(this,"passIndex",qn,this),Et(this,"uniformName",Xn,this),Et(this,"channelIndex",Kn,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],i=t.getHandle(this.uniformName);if(!i)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var n=Nt.getPropertyTypeFromHandle(i);if(n===xt.UBO){var r=void 0===this.channelIndex?i:t.getHandle(this.uniformName,this.channelIndex,It.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var i,n=be(e.shaderInfo.blocks);!(i=n()).done;)for(var r,a=i.value,s=be(a.members);!(r=s()).done;){var o=r.value;if(o.name===t)return o.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(n===xt.SAMPLER){var a=Nt.getBindingFromHandle(i),s=t.properties[this.uniformName],o=s&&s.value?s.value+"-texture":Rt(s.type),u=Re.get(o);return u||(Ct("Illegal texture default value: "+o+"."),u=Re.get("default-texture")),{set:function(e){e||(e=u);var i=e.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(a,i),e instanceof Pt&&t.bindSampler(a,kt.getSampler(W.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+n+".")},e}(),qn=bt((Yn=Jn).prototype,"passIndex",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xn=bt(Yn.prototype,"uniformName",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kn=bt(Yn.prototype,"channelIndex",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Gn=Yn))||Gn);function lr(e,t,i,n){var r,a,s,o,h,l,c=new t,d=new t,p=new t,f=Tt(e)((l=function(){function e(e,i,n){Et(this,"dataPoint",s,this),Et(this,"inTangent",o,this),Et(this,"outTangent",h,this),this.dataPoint=e||new t,this.inTangent=i||new t,this.outTangent=n||new t}var r=e.prototype;return r.lerp=function(e,t,r){var a=this.dataPoint,s=e.dataPoint;d=i(d,this.inTangent,r),p=i(p,e.outTangent,r);var o=t*t*t,u=t*t,h=o-2*u+t,l=-2*o+3*u,f=o-u;return c=i(c,a,2*o-3*u+1),c=n(c,c,d,h),c=n(c,c,s,l),c=n(c,c,p,f)},r.getNoLerp=function(){return this.dataPoint},e}(),s=bt((a=l).prototype,"dataPoint",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),o=bt(a.prototype,"inTangent",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),h=bt(a.prototype,"outTangent",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=a))||r;if(t===u){var _=f.prototype.lerp;f.prototype.lerp=function(e,t,i){var n=_.call(this,e,t,i);return u.normalize(n,n),n}}return f}e("M",Tt("cc.animation.MorphWeightsValueProxy")((tr=function(){function e(){Et(this,"subMeshIndex",er,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeights(i,t.subMeshIndex)}}},e}(),er=bt((Zn=tr).prototype,"subMeshIndex",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$n=Zn))||$n),e("a",Tt("cc.animation.MorphWeightsAllValueProxy")(ir=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var i,n,r=null!==(i=null===(n=e.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,a=0;a<r;++a)e.setWeights(t,a)}}},e}())||ir);var cr=e("C",lr("cc.CubicSplineVec2Value",i,i.multiplyScalar,i.scaleAndAdd));W.CubicSplineVec2Value=cr;var dr=e("b",lr("cc.CubicSplineVec3Value",r,r.multiplyScalar,r.scaleAndAdd));W.CubicSplineVec3Value=dr;var pr=e("c",lr("cc.CubicSplineVec4Value",s,s.multiplyScalar,s.scaleAndAdd));W.CubicSplineVec4Value=pr;var fr=e("d",lr("cc.CubicSplineQuatValue",u,u.multiplyScalar,u.scaleAndAdd));W.CubicSplineQuatValue=fr;var _r,mr,gr,vr=e("e",Tt("cc.CubicSplineNumberValue")((ur=function(){function e(e,t,i){Et(this,"dataPoint",ar,this),Et(this,"inTangent",sr,this),Et(this,"outTangent",or,this),this.dataPoint=e,this.inTangent=t,this.outTangent=i}var t=e.prototype;return t.lerp=function(e,t,i){var n=this.dataPoint,r=e.dataPoint,a=t*t*t,s=t*t;return n*(2*a-3*s+1)+this.outTangent*i*(a-2*s+t)+r*(-2*a+3*s)+e.inTangent*i*(a-s)},t.getNoLerp=function(){return this.dataPoint},e}(),ar=bt((rr=ur).prototype,"dataPoint",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sr=bt(rr.prototype,"inTangent",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),or=bt(rr.prototype,"outTangent",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nr=rr))||nr);W.CubicSplineNumberValue=vr,Pe(fi.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return fi.prototype.removeState.call(this,e.name)}}]),W.AnimationComponent=fi,Ue.setClassAlias(fi,"cc.AnimationComponent");var yr,Tr,wr,br,Er=e("t",Tt((gr=mr=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._anims=new Dt([]),t._delayEvents=[],t._blendStateBuffer=new gi,t._crossFades=[],t._sockets=[],t}le(t,e);var i=t.prototype;return i.addCrossFade=function(e){this._crossFades.push(e)},i.removeCrossFade=function(e){Mt(this._crossFades,e)},i.update=function(e){for(var t=this._delayEvents,i=this._crossFades,n=this._sockets,r=0,a=i.length;r<a;r++)i[r].update(e);var s=this._anims,o=s.array;for(s.i=0;s.i<o.length;++s.i){var u=o[s.i];u.isMotionless||u.update(e)}this._blendStateBuffer.apply();for(var h=W.director.getTotalFrames(),l=0,c=n.length;l<c;l++){var d=n[l],p=d.target,f=d.transform;p.matrix=_i(f,h)}for(var _=0,m=t.length;_<m;_++){var g=t[_];g.fn.apply(g.thisArg,g.args)}t.length=0},i.destruct=function(){},i.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},i.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):de(3907)},i.pushDelayEvent=function(e,t,i){this._delayEvents.push({fn:e,thisArg:t,args:i})},i.addSockets=function(e,t){for(var i=this,n=function(n){var r=t[n];if(i._sockets.find((function(e){return e.target===r.target})))return"continue";var a=e.getChildByPath(r.path),s=r.target&&a&&vi(a,e);s&&i._sockets.push({target:r.target,transform:s})},r=0;r<t.length;++r)n(r)},i.removeSockets=function(e,t){for(var i=0;i<t.length;++i)for(var n=t[i],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===n.target){mi(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},he(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(Ji),mr.ID="animation",_r=gr))||_r);un.on(on.EVENT_INIT,(function(){var e=new Er;un.registerSystem(Er.ID,e,nn.PRIORITY_SYSTEM)})),W.AnimationManager=Er,W.easing=yi;var Sr=e("H",Tt("cc.HierachyModifier")(yr=function(e){function t(){return e.apply(this,arguments)||this}return le(t,e),t}(Ti))||yr);W.HierachyModifier=Sr;var Ar=e("n",Tt("cc.ComponentModifier")(Tr=function(e){function t(){return e.apply(this,arguments)||this}return le(t,e),t}(wi))||Tr);W.ComponentModifier=Ar;var Nr=e("o",Tt("cc.CurveValueAdapter")(wr=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||wr);W.CurveValueAdapter=Nr;var xr=e("p",Tt("cc.UniformCurveValueAdapter")(br=function(e){function t(){return e.apply(this,arguments)||this}return le(t,e),t}(hr))||br);function Ir(e){return"string"==typeof e}function Rr(e){return"number"==typeof e}function Cr(e,t){return e instanceof t}W.UniformCurveValueAdapter=xr,W.isPropertyModifier=Ir,W.isElementModifier=Rr,W.isCustomTargetModifier=Cr,W.math=qi,W.geometry=Xi}}}));
