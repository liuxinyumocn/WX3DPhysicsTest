System.register(["./coordinates-converts-utils-bf8713a9.js","./index-6f89fc06.js","./event-enum-5a5aa40e.js","./renderable-component-658e90bd.js","./texture-buffer-pool-d3259f64.js","./view-7d20208a.js","./screen-d46ce30a.js","./json-asset-0797cbb7.js","./camera-component-f1234106.js","./find-5191dd26.js","./sprite-frame-30c057cb.js","./sprite-6803ade1.js","./renderable-2d-386fc016.js","./graphics-1e47dff7.js","./vertex-format-dd7257e2.js","./deprecated-a9ea7a0c.js"],(function(t){"use strict";var e,i,n,r,s,o,a,h,l,c,u,p,f,_,d,y,m,g,b,v,C,T,S,D,x,E,A,I,O,w,R,L,B,F,P,k,M,H,z,j,N,W,U,X,G,V,Y,q,Q,Z,$,J,K,tt,et,it,nt,rt,st,ot,at,ht,lt,ct,ut,pt,ft,_t,dt,yt,mt,gt,bt,vt,Ct,Tt,St,Dt,xt,Et;return{setters:[function(t){e=t.b9,i=t.b0,n=t.bE,r=t.e2,s=t.ec,o=t.e3,a=t.e4,h=t.e7,l=t.e8,c=t.bg,u=t.b2,p=t.e0,f=t.l,_=t.B,d=t.v,y=t.M,m=t.cD,g=t.e5,b=t.fl,v=t.e6,C=t.fs,T=t.fw,S=t.ft,D=t.eb,x=t.fu,E=t.fm,A=t.fn,I=t.d,O=t.bl,w=t.ea,R=t.t,L=t.fr,B=t.fS,F=t.d_,P=t.fq,k=t.fQ,M=t.f7,H=t.I,z=t.a4,j=t.a1,N=t.dY,W=t.an,U=t.am,X=t.S,G=t.ah,V=t.e9,Y=t.fT,q=t.eD},function(t){Q=t.f,Z=t.h},function(t){$=t.M,J=t.q},function(t){K=t.a,tt=t.N},function(){},function(t){et=t.G},function(){},function(t){it=t.R},function(t){nt=t.P},function(){},function(t){rt=t.S},function(t){st=t.c,ot=t.H,at=t.F,ht=t.b,lt=t.S,ct=t.T,ut=t.a,pt=t.f,ft=t.d,_t=t.i,dt=t.e,yt=t.V},function(t){mt=t.I,gt=t.a,bt=t.R,vt=t.U},function(t){Ct=t.G},function(t){Tt=t.g,St=t.a,Dt=t.b,xt=t.c},function(t){Et=t.U}],execute:function(){var At,It,Ot,wt,Rt,Lt,Bt,Ft,Pt,kt,Mt,Ht,zt,jt,Nt,Wt,Ut,Xt,Gt,Vt,Yt,qt,Qt,Zt,$t,Jt,Kt;t("e",void 0);var te,ee=new e,ie=new i,ne=new e,re=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(te||(te=t("e",{}))),n(te);var se=t("a",(At=r("cc.Mask"),It=C(),Ot=T(110),wt=S(),Rt=s(te),Lt=D(),Bt=x(),Ft=D(),Pt=x(),kt=E(),Mt=s(rt),Ht=E(),zt=E(),jt=A(),Nt=E(),Wt=E(),Ut=E(),Xt=E(),At(Gt=It(Gt=Ot(Gt=wt((Kt=Jt=function(t){function n(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,h(e,"_type",Yt,l(e)),h(e,"_inverted",qt,l(e)),h(e,"_segments",Qt,l(e)),h(e,"_spriteFrame",Zt,l(e)),h(e,"_alphaThreshold",$t,l(e)),e._graphics=null,e._instanceMaterialType=mt.ADD_COLOR,e}o(n,t),a(n,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==te.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){f.game.renderType!==et.RENDER_TYPE_CANVAS?(this._inverted=t,this.stencilStage=gt.DISABLED,this._graphics&&(this._graphics.stencilStage=gt.DISABLED)):I(4202)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=O(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===te.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===te.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]);var r=n.prototype;return r.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},r.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._broadcastToNode(this.node)},r.onRestore=function(){this._createGraphics(),this._updateGraphics()},r.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},r.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&Q.root.destroyModel(this._clearModel),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},r.isHit=function(t){var n=this.node._uiProps.uiTransformComp,r=n.contentSize,s=r.width,o=r.height,a=ie;this.node.getWorldMatrix(ee),e.invert(ne,ee),i.transformMat4(a,t,ne);var h=n.anchorPoint;a.x+=h.x*s,a.y+=h.y*o;var l=!1;if(this.type===te.RECT||this.type===te.GRAPHICS_STENCIL)l=a.x>=0&&a.y>=0&&a.x<=s&&a.y<=o;else if(this.type===te.ELLIPSE){var c=s/2,u=o/2,p=a.x-.5*s,f=a.y-.5*o;l=p*p/(c*c)+f*f/(u*u)<1}return this._inverted&&(l=!l),l},r._render=function(t){t.commitComp(this,null,this._assembler,null)},r._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},r._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},r._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==te.IMAGE_STENCIL||null!==this._spriteFrame)},r._flushAssembler=function(){var t=n.Assembler.getAssembler(this),e=n.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==e&&(this._postAssembler=e),this._useRenderData()},r._createGraphics=function(){if(!this._graphics){var t=this._graphics=new Ct;t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=c.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},r._updateGraphics=function(){if(this._graphics&&(this._type===te.RECT||this._type===te.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,r=i.height,s=t.anchorPoint,o=-n*s.x,a=-r*s.y;if(this._type===te.RECT)e.rect(o,a,n,r);else if(this._type===te.ELLIPSE){for(var h=function(t,e,i){re.length=0;for(var n=2*Math.PI/i,r=0;r<i;++r)re.push(new u(e.x*Math.cos(n*r)+t.x,e.y*Math.sin(n*r)+t.y,0));return re}(new u(o+n/2,a+r/2,0),new u(n/2,r/2,0),this._segments),l=0;l<h.length;++l){var c=h[l];0===l?e.moveTo(c.x,c.y):e.lineTo(c.x,c.y)}e.close()}e.fill()}},r._createClearModel=function(){if(!this._clearModel){var t=p.get("default-clear-stencil");this._clearStencilMtl=new $({parent:t,owner:this,subModelIdx:0}),this._clearModel=Q.root.createModel(K),this._clearModel.node=this._clearModel.transform=this.node;var e=Tt(St),i=f.director.root.device,n=i.createBuffer(new _(d.VERTEX|d.TRANSFER_DST,y.DEVICE,4*e,e)),r=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(r);var s=i.createBuffer(new _(d.INDEX|d.TRANSFER_DST,y.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);s.update(o);var a=new it([n],St,m.TRIANGLE_LIST,s);a.subMeshIdx=0,this._clearModel.initSubModel(0,a,this._clearStencilMtl)}},r._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=gt.DISABLED,this._type===te.IMAGE_STENCIL?(t=p.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=p.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},r._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},r._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},r._useRenderData=function(){this._type!==te.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},r._broadcastToNode=function(t){var e=t.children;t.eventProcessor.registerComponentHitList(n);for(var i=0,r=e.length;i<r;i++)this._broadcastToNode(e[i])},n}(bt),Jt.Type=te,g((Vt=Kt).prototype,"type",[Rt,Lt,Bt],Object.getOwnPropertyDescriptor(Vt.prototype,"type"),Vt.prototype),g(Vt.prototype,"inverted",[Ft,Pt],Object.getOwnPropertyDescriptor(Vt.prototype,"inverted"),Vt.prototype),g(Vt.prototype,"segments",[kt],Object.getOwnPropertyDescriptor(Vt.prototype,"segments"),Vt.prototype),g(Vt.prototype,"spriteFrame",[Mt,Ht],Object.getOwnPropertyDescriptor(Vt.prototype,"spriteFrame"),Vt.prototype),g(Vt.prototype,"alphaThreshold",[zt,jt,b],Object.getOwnPropertyDescriptor(Vt.prototype,"alphaThreshold"),Vt.prototype),g(Vt.prototype,"dstBlendFactor",[v,Nt],Object.getOwnPropertyDescriptor(Vt.prototype,"dstBlendFactor"),Vt.prototype),g(Vt.prototype,"srcBlendFactor",[v,Wt],Object.getOwnPropertyDescriptor(Vt.prototype,"srcBlendFactor"),Vt.prototype),g(Vt.prototype,"color",[v,Ut],Object.getOwnPropertyDescriptor(Vt.prototype,"color"),Vt.prototype),g(Vt.prototype,"customMaterial",[v,Xt],Object.getOwnPropertyDescriptor(Vt.prototype,"customMaterial"),Vt.prototype),Yt=g(Vt.prototype,"_type",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return te.RECT}}),qt=g(Vt.prototype,"_inverted",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qt=g(Vt.prototype,"_segments",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Zt=g(Vt.prototype,"_spriteFrame",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$t=g(Vt.prototype,"_alphaThreshold",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Gt=Vt))||Gt)||Gt)||Gt)||Gt));f.Mask=se;var oe,ae,he,le,ce,ue,pe,fe,_e,de,ye,me,ge,be,ve,Ce,Te,Se,De,xe,Ee,Ae,Ie,Oe,we,Re,Le,Be,Fe,Pe,ke,Me,He,ze,je,Ne,We,Ue,Xe,Ge,Ve,Ye,qe,Qe,Ze,$e,Je,Ke=/^(click)(\s)*=|(param)(\s)*=/,ti=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,ei=t("H",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),r=-1;if(n>=0&&(r=t.lastIndexOf("<",n))<e-1&&(r=t.indexOf("<",n+1),n=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var s=t.substring(e,r),o=t.substring(r+1,n);""===o&&(s=t.substring(e,n+1)),this._processResult(s),-1===n?n=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",r=0,s="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(r=t.indexOf(" "),n[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(s=t.substring(r+1).trim(),e.event=this._processEventHandler(s)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var a;i=ti.exec(t);for(var h=!1;i;){if(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),a=(r=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),a.endsWith("/")&&(a=a.slice(0,-1)),"src"===n){switch(a.charCodeAt(0)){case 34:case 39:h=!0,a=a.slice(1,-1)}e.isImage=!0,e.src=a}else if("height"===n)e.imageHeight=parseInt(a);else if("width"===n)e.imageWidth=parseInt(a);else if("align"===n){switch(a.charCodeAt(0)){case 34:case 39:a=a.slice(1,-1)}e.imageAlign=a.toLowerCase()}else"offset"===n?e.imageOffset=a:"click"===n&&(e.event=this._processEventHandler(n+"="+a));e.event&&"param"===n&&(e.event[n]=a.replace(/^"|"$/g,"")),i=ti.exec(t)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var l={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var c,u=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=u.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),c=(r=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===n?e.event=this._processEventHandler(n+"="+c):"color"===n?l.color=c:"width"===n&&(l.width=parseInt(c)),e.event&&"param"===n&&(e.event[n]=c.replace(/^"|"$/g,"")),i=u.exec(t)}e.outline=l}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,n=!1,r=Ke.exec(t);r;){var s=r[0],o="";if(n=!1,'"'===(t=t.substring(s.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(o=a?a[0]:"").length}n&&(e[s=s.substring(0,s.length-1).trim()]=o),t=t.substring(i).trim(),r=Ke.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=R(this._specialSymbolArray);!(e=i()).done;){var n=e.value,r=n[0],s=n[1];t=t.replace(r,s)}return t},t}()),ii=t("L",(oe=r("cc.LabelOutline"),ae=C(),he=T(110),le=S(),ce=B(st),ue=x(),pe=x(),oe(fe=ae(fe=he(fe=le(fe=ce(fe=L((me=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,h(e,"_color",de,l(e)),h(e,"_width",ye,l(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(st);t&&t.updateRenderData(!0)},a(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(F),de=g((_e=me).prototype,"_color",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c(0,0,0,255)}}),ye=g(_e.prototype,"_width",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g(_e.prototype,"color",[ue],Object.getOwnPropertyDescriptor(_e.prototype,"color"),_e.prototype),g(_e.prototype,"width",[pe],Object.getOwnPropertyDescriptor(_e.prototype,"width"),_e.prototype),fe=_e))||fe)||fe)||fe)||fe)||fe)||fe)),ni=new ei,ri=new P((function(t){if(!f.isValid(t.node))return!1;var e=t.node.getComponent(ii);return e&&(e.width=0),!0}),20),si=new P((function(t){return f.isValid(t.node)}),10);function oi(t){return{node:new nt(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function ai(t,e){var i;"RICHTEXT_CHILD"===t?i=ri._get():"RICHTEXT_Image_CHILD"===t&&(i=si._get());var n=(i=i||oi(t)).node;return n||(n=new nt(t)),"RICHTEXT_Image_CHILD"===t?(i.comp=n.getComponent(ut)||n.addComponent(ut),i.comp.spriteFrame=e,i.comp.type=ut.Type.SLICED,i.comp.sizeMode=ut.SizeMode.CUSTOM):(i.comp=n.getComponent(st)||n.addComponent(st),i.comp.string=e,i.comp.horizontalAlign=ot.LEFT,i.comp.verticalAlign=yt.TOP),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var hi,li=t("R",(ge=r("cc.RichText"),be=C(),ve=T(110),Ce=S(),Te=x(),Se=s(ot),De=x(),xe=x(),Ee=x(),Ae=s(at),Ie=x(),Oe=x(),we=s(ht),Re=x(),Le=x(),Be=x(),Fe=s(lt),Pe=x(),ke=x(),ge(Me=be(Me=ve(Me=Ce(Me=L((Je=$e=function(t){function e(){var e;return e=t.call(this)||this,h(e,"_lineHeight",ze,l(e)),h(e,"_string",je,l(e)),h(e,"_horizontalAlign",Ne,l(e)),h(e,"_fontSize",We,l(e)),h(e,"_maxWidth",Ue,l(e)),h(e,"_fontFamily",Xe,l(e)),h(e,"_font",Ge,l(e)),h(e,"_isSystemFontUsed",Ve,l(e)),h(e,"_userDefinedFont",Ye,l(e)),h(e,"_cacheMode",qe,l(e)),h(e,"_imageAtlas",Qe,l(e)),h(e,"_handleTouchEvent",Ze,l(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}o(e,t),a(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]);var i=e.prototype;return i.onLoad=function(){this.node.on(J.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(tt.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=R(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),"RICHTEXT_CHILD"===i.type?ri.put(i):"RICHTEXT_Image_CHILD"===i.type&&si.put(i)}this.node.off(tt.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(J.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(tt.EventType.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(tt.EventType.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return ai("RICHTEXT_CHILD",t)},i._createImage=function(t){return ai("RICHTEXT_Image_CHILD",t)},i._onTTFLoaded=function(){var t=this;this._font instanceof ct?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):Z.postLoadNative(this._font,(function(){t.isValid&&(t._layoutDirty=!0,t._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},i._measureText=function(t,e){var i=this,n=function(e){var n;return 0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0]).node.getComponent(st).string=e,n.styleIndex=t,i._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize.width};return e?n(e):n},i._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(F),r=function(){var r=e.value,s=r.clickHandler,o=r.clickParam;s&&i._containsTouchLocation(r,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[s];e.enabledInHierarchy&&i&&i.call(e,t,o)})),t.propagationStopped=!0)},s=R(this._segments);!(e=s()).done;)r()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(vt);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if("RICHTEXT_CHILD"===i.name||"RICHTEXT_Image_CHILD"===i.name){i.parent===this.node?i.parent=null:t.splice(e,1);var n=oi(i.name);n.node=i,"RICHTEXT_CHILD"===i.name?(n.comp=i.getComponent(st),ri.put(n)):(n.comp=i.getComponent(ut),si.put(n))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(st);n&&(n.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this._applyTextAttribute(i),this.node.addChild(i.node),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var s=this._getFirstWordLen(t,r,t.length),o=t.substr(r,s),a=this._measureText(i,o);if(!(this._lineOffsetX+a<=this._maxWidth)){if(r>0){var h=t.substr(0,r);this._addLabelSegment(h,i),t=t.substr(r,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,r+=s}if(n>this._maxWidth)for(var l=pt(t,n,this._maxWidth,this._measureText(i)),c=0;c<l.length;++c){var u=l[c],p=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&c<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var r=i.style,s=n.style;if(r){if(s){if(!!s.outline!=!!r.outline)return!0;if(r.size!==s.size||r.italic!==s.italic||r.isImage!==s.isImage)return!0;if(r.src!==s.src||r.imageAlign!==s.imageAlign||r.imageHeight!==s.imageHeight||r.imageWidth!==s.imageWidth||r.imageOffset!==s.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(s&&(s.size||s.italic||s.isImage||s.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var r=this._createImage(n);switch(r.comp,e.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}r.node.layer=this.node.layer,this.node.addChild(r.node),this._segments.push(r);var s=n.rect.clone(),o=1,a=s.width,h=s.height,l=e.imageWidth||0,c=e.imageHeight||0;c>0?(a*=o=c/h,h*=o):(a*=o=this._lineHeight/h,h*=o),l>0&&(a=l),this._maxWidth>0?(this._lineOffsetX+a>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(a,h),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var u=e.event;u&&(r.clickHandler=u.click,r.clickParam=u.param)}else I(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=ni.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var r=this._textArray[n],s=r.text;if(void 0!==s){if(""===s){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=s.split("\n"),a=0;a<o.length;++a){var h=o[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),o.length>1&&a<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&a<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(s)&&a===o.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+ft)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(_t(n)||dt(n))return 1;for(var r=1,s=e+1;s<i&&(n=t.charAt(s),!dt(n)&&!_t(n));++s)r++;return r},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,r=n.anchorX,s=n.anchorY,o=0;o<this._segments.length;++o){var a=this._segments[o],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case ot.LEFT:break;case ot.CENTER:l-=this._linesWidth[h-1]/2;break;case ot.RIGHT:l-=this._linesWidth[h-1]}var c=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*s,c.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(ut)){var u=a.node.position.clone(),p=this._lineHeight,f=this._lineHeight*(1+ft);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=p+(f-p)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-p)/2}if(a.imageOffset){var _=a.imageOffset.split(",");if(1===_.length&&_[0]){var d=parseFloat(_[0]);Number.isInteger(d)&&(u.y+=d)}else if(2===_.length){var y=parseFloat(_[0]),m=parseFloat(_[1]);Number.isInteger(y)&&(u.x+=y),Number.isInteger(m)&&(u.y+=m)}}a.node.position=u}var g=a.node.getComponent(ii);if(g){var b=a.node.position.clone();b.y-=g.width,a.node.position=b}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return c[e]?c[e]:(new c).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(st);if(e){var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var r=t.node.getComponent(ii);r||(r=t.node.addComponent(ii)),r.color=this._convertLiteralColorValue(i.outline.color),r.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var s=i.event;s&&(t.clickHandler=s.click||"",t.clickParam=s.param||"")}else e.fontSize=this._fontSize;e.cacheMode=this._cacheMode,this._font instanceof at&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=R(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},e}(Et),$e.HorizontalAlign=ot,$e.VerticalAlign=yt,g((He=Je).prototype,"string",[k,Te],Object.getOwnPropertyDescriptor(He.prototype,"string"),He.prototype),g(He.prototype,"horizontalAlign",[Se,De],Object.getOwnPropertyDescriptor(He.prototype,"horizontalAlign"),He.prototype),g(He.prototype,"fontSize",[xe],Object.getOwnPropertyDescriptor(He.prototype,"fontSize"),He.prototype),g(He.prototype,"fontFamily",[Ee],Object.getOwnPropertyDescriptor(He.prototype,"fontFamily"),He.prototype),g(He.prototype,"font",[Ae,Ie],Object.getOwnPropertyDescriptor(He.prototype,"font"),He.prototype),g(He.prototype,"useSystemFont",[Oe],Object.getOwnPropertyDescriptor(He.prototype,"useSystemFont"),He.prototype),g(He.prototype,"cacheMode",[we,Re],Object.getOwnPropertyDescriptor(He.prototype,"cacheMode"),He.prototype),g(He.prototype,"maxWidth",[Le],Object.getOwnPropertyDescriptor(He.prototype,"maxWidth"),He.prototype),g(He.prototype,"lineHeight",[Be],Object.getOwnPropertyDescriptor(He.prototype,"lineHeight"),He.prototype),g(He.prototype,"imageAtlas",[Fe,Pe],Object.getOwnPropertyDescriptor(He.prototype,"imageAtlas"),He.prototype),g(He.prototype,"handleTouchEvent",[ke],Object.getOwnPropertyDescriptor(He.prototype,"handleTouchEvent"),He.prototype),ze=g(He.prototype,"_lineHeight",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),je=g(He.prototype,"_string",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),Ne=g(He.prototype,"_horizontalAlign",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ot.LEFT}}),We=g(He.prototype,"_fontSize",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Ue=g(He.prototype,"_maxWidth",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xe=g(He.prototype,"_fontFamily",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Ge=g(He.prototype,"_font",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ve=g(He.prototype,"_isSystemFontUsed",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ye=g(He.prototype,"_userDefinedFont",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qe=g(He.prototype,"_cacheMode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ht.NONE}}),Qe=g(He.prototype,"_imageAtlas",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ze=g(He.prototype,"_handleTouchEvent",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Me=He))||Me)||Me)||Me)||Me)||Me)),ci=t("U",r("cc.UIMeshRenderer")(hi=C()(hi=T(110)(hi=S()(hi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._models=null,e._modelComponent=null,e}o(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=R(this._models);!(e=i()).done;){var n=e.value;t.commitModel.call(t,this,n,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,r=n.length,s=0;s<r;s++){var o=n[s];o._priority=M.MAX-11,o.blendState.targets[0].blend||i.overridePipelineStates({blendState:{targets:[{blend:!0}]}},s)}}},a(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(Et))||hi)||hi)||hi)||hi),ui=t("M",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}a(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}}]);var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=Dt(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var n=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new _(d.VERTEX|d.TRANSFER_DST,y.HOST|y.DEVICE,n,n)));var r=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new _(d.INDEX|d.TRANSFER_DST,y.HOST|y.DEVICE,r,r))),this._attributes=t,this._iaInfo=new H(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,n=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var r=this.vData.byteLength,s=this.iData.length;if(i>r||n>s){for(;r<i||s<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)z.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return j;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(z.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=z.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._dirty=!1}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),n=0,r=e.length;n<r;n++)i[n]=e[n]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,n=0,r=e.length;n<r;n++)i[n]=e[n]},a(t,[{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());ui.OPACITY_OFFSET=8;var pi,fi,_i,di,yi,mi,gi,bi,vi,Ci,Ti,Si,Di,xi,Ei,Ai,Ii,Oi,wi,Ri,Li,Bi,Fi,Pi,ki,Mi,Hi,zi,ji=N.Enum.NONE|N.Enum.UI_3D,Ni=t("D",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._handle=j,this._passes=[],this._handle=W.alloc(),W.set(this._handle,U.VIS_FLAGS,ji),W.set(this._handle,U.INPUT_ASSEMBLER,j),W.set(this._handle,U.DESCRIPTOR_SET,j)}a(t,[{key:"handle",get:function(){return this._handle}},{key:"hInputAssembler",get:function(){return W.get(this._handle,U.INPUT_ASSEMBLER)},set:function(t){W.set(this._handle,U.INPUT_ASSEMBLER,t)}},{key:"hDescriptorSet",get:function(){return W.get(this._handle,U.DESCRIPTOR_SET)},set:function(t){W.set(this._handle,U.DESCRIPTOR_SET,t)}},{key:"visFlags",get:function(){return W.get(this._handle,U.VIS_FLAGS)},set:function(t){W.set(this._handle,U.VIS_FLAGS,t)}},{key:"passes",get:function(){return this._passes}}]);var e=t.prototype;return e.destroy=function(){if(this._handle){for(var t=this.passes.length,e=0;e<t;e++)this.passes[e]._destroyHandle();this._passes=[],W.free(this._handle),this._handle=j}},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=j,this.hDescriptorSet=j,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=ji},e.fillPasses=function(t,e,i,n,r,s){if(t){var o=t.passes;if(!o)return;W.set(this._handle,U.PASS_COUNT,o.length);for(var a=U.PASS_0,h=U.SHADER_0,l=0,c=0;c<o.length;c++,a++,h++){this._passes[c]||(this._passes[c]=new X(f.director.root),this._passes[c]._handle=G.alloc());var u=o[c],p=this._passes[c];e||(e=u.depthStencilState,i=0),n||(n=u.blendState,r=0),-1===r&&(r=0),l=i<<16|r,u.update(),p._initPassFromTarget(u,e,n,l),W.set(this._handle,a,p.handle),W.set(this._handle,h,p.getShaderVariant(s))}}},t}()),Wi=t("b",(pi=r("cc.UIStaticBatch"),fi=C(),_i=S(),di=T(110),yi=E(),mi=E(),gi=E(),pi(bi=fi(bi=_i(bi=di((Ci=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}o(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=xt,i=new ui(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers())},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new Ni;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return Q.root&&Q.root.batcher2D?Q.root.batcher2D:(I(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),I(9300)},a(e,[{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(bt),g((vi=Ci).prototype,"dstBlendFactor",[v,yi],Object.getOwnPropertyDescriptor(vi.prototype,"dstBlendFactor"),vi.prototype),g(vi.prototype,"srcBlendFactor",[v,mi],Object.getOwnPropertyDescriptor(vi.prototype,"srcBlendFactor"),vi.prototype),g(vi.prototype,"color",[v,gi],Object.getOwnPropertyDescriptor(vi.prototype,"color"),vi.prototype),bi=vi))||bi)||bi)||bi)||bi)),Ui=(t("c",(Ti=r("cc.LabelShadow"),Si=C(),Di=T(110),xi=S(),Ei=B(st),Ai=x(),Ii=x(),Oi=x(),Ti(wi=Si(wi=Di(wi=xi(wi=Ei(wi=L((Pi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,h(e,"_color",Li,l(e)),h(e,"_offset",Bi,l(e)),h(e,"_blur",Fi,l(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(st);t&&t.updateRenderData(!0)},a(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(F),Li=g((Ri=Pi).prototype,"_color",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c(0,0,0,255)}}),Bi=g(Ri.prototype,"_offset",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(2,2)}}),Fi=g(Ri.prototype,"_blur",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g(Ri.prototype,"color",[Ai],Object.getOwnPropertyDescriptor(Ri.prototype,"color"),Ri.prototype),g(Ri.prototype,"offset",[Ii],Object.getOwnPropertyDescriptor(Ri.prototype,"offset"),Ri.prototype),g(Ri.prototype,"blur",[Oi],Object.getOwnPropertyDescriptor(Ri.prototype,"blur"),Ri.prototype),wi=Ri))||wi)||wi)||wi)||wi)||wi)||wi)),t("d",r("cc.UIOpacity")(ki=C()(ki=T(110)(ki=S()(ki=L((zi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,h(e,"_opacity",Hi,l(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.opacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.opacity=1},a(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Y(t,0,255),this._opacity=t,this.node._uiProps.opacity=t/255)}}]),e}(F),g((Mi=zi).prototype,"opacity",[V],Object.getOwnPropertyDescriptor(Mi.prototype,"opacity"),Mi.prototype),Hi=g(Mi.prototype,"_opacity",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ki=Mi))||ki)||ki)||ki)||ki)||ki));f.MaskComponent=se,q.setClassAlias(se,"cc.MaskComponent"),f.LabelComponent=st,q.setClassAlias(st,"cc.LabelComponent"),f.LabelOutlineComponent=ii,q.setClassAlias(ii,"cc.LabelOutlineComponent"),f.RichTextComponent=li,q.setClassAlias(li,"cc.RichTextComponent"),f.SpriteComponent=ut,q.setClassAlias(ut,"cc.SpriteComponent"),f.UIModelComponent=ci,q.setClassAlias(ci,"cc.UIModelComponent"),f.GraphicsComponent=Ct,q.setClassAlias(Ct,"cc.GraphicsComponent"),q.setClassAlias(Wi,"cc.UIStaticBatchComponent"),q.setClassAlias(Ui,"cc.UIOpacityComponent")}}}));
