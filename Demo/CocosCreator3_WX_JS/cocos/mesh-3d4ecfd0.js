System.register(["./coordinates-converts-utils-bf8713a9.js","./deprecated-3.0.0-f3f53c89.js","./json-asset-0797cbb7.js"],(function(t){"use strict";var e,r,i,n,s,a,u,o,h,f,c,d,l,v,_,m,g,p,w,b,x,T,y,A,M,I,E,B,R,P,O,U,S,N,V,F,C,L,k;return{setters:[function(t){e=t.e4,r=t.fF,i=t.fG,n=t.l,s=t.c7,a=t.c8,u=t.w,o=t.Y,h=t.t,f=t.u,c=t.B,d=t.v,l=t.M,v=t.d4,_=t.fH,m=t.fI,g=t.fJ,p=t.fK,w=t.fL,b=t.fM,x=t.b2,T=t.e2,y=t.e3,A=t.e7,M=t.e8,I=t.b6,E=t.d7,B=t.f9,R=t.F,P=t.c5,O=t.e5,U=t.d1,S=t.bO,N=t.d,V=t.A,F=t.ea,C=t.ck},function(t){L=t.A},function(t){k=t.R}],execute:function(){var D,G,z,H,W,X,j=t("B",function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var r=t-e;this._arrayBufferOrPaddings.push(r),this._length+=r}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(r){"number"==typeof r?e+=r:(t.set(new Uint8Array(r),e),e+=r.byteLength)})),t.buffer},t}()),q=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var r=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(r).fill(null);for(var n=0;n<r;++n){var s=this._mesh.struct.morph.subMeshMorphs[n];s&&(s.targets.length>i.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[n]=new Z(this._mesh,n,this._mesh.struct.morph,e):this._subMeshRenderings[n]=new J(this._mesh,n,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,r=new Array(e),i=0;i<e;++i){var n,s;r[i]=null!==(n=null===(s=this._subMeshRenderings[i])||void 0===s?void 0:s.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var i;null===(i=r[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){g(t._mesh.struct.morph);var i=t._mesh.struct.morph.subMeshMorphs[e],n=r[e];if(null!==n){var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes(f.ATTR_POSITION)&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes(f.ATTR_NORMAL)&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes(f.ATTR_TANGENT)&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,n.requiredPatches()),s}},adaptPipelineState:function(t,e){var i;null===(i=r[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t,e=h(r);!(t=e()).done;){var i=t.value;null==i||i.destroy()}}}},t}(),J=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var n=r.subMeshMorphs[e];this._subMeshMorph=n,$(t,e,i);var s=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=s;var a=n.targets.length,u=K(i,s*a);this._textureInfo={width:u.width,height:u.height},this._attributes=n.attributes.map((function(e,r){var i=u.create(),a=i.valueView;return n.targets.forEach((function(e,i){for(var n=e.displacements[r],u=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),o=s*i*4,h=0;h<s;++h)a[o+4*h+0]=u[3*h+0],a[o+4*h+1]=u[3*h+1],a[o+4*h+2]=u[3*h+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=h(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Y(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(r){for(var n,s=h(t._attributes);!(n=s()).done;){var a=n.value,o=void 0;switch(a.name){case f.ATTR_POSITION:o=b;break;case f.ATTR_NORMAL:o=w;break;case f.ATTR_TANGENT:o=p;break;default:u("Unexpected attribute!")}void 0!==o&&(r.bindSampler(o,a.morphTexture.sampler),r.bindTexture(o,a.morphTexture.texture))}r.bindBuffer(i.BINDING,e.buffer),r.update()},destroy:function(){}}},t}(),Z=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var n=r.subMeshMorphs[e];$(t,e,i),this._attributes=n.attributes.map((function(e,r){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[r].offset,e.displacements[r].count)}}))}}))}return t.prototype.createInstance=function(){return new Q(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},e(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Q=function(){function t(t,e,r){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Y(r,0);var i=K(r,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],n=i.morphTexture.valueView,s=this._owner.data[e];r(t.length===s.targets.length);for(var a=0;a<s.targets.length;++a){var u=s.targets[a].displacements,o=t[a],h=u.length/3;if(0===a)for(var f=0;f<h;++f)n[4*f+0]=u[3*f+0]*o,n[4*f+1]=u[3*f+1]*o,n[4*f+2]=u[3*f+2]*o;else for(var c=0;c<h;++c)n[4*c+0]+=u[3*c+0]*o,n[4*c+1]+=u[3*c+1]*o,n[4*c+2]+=u[3*c+2]*o}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,r=h(this._attributes);!(e=r()).done;){var n=e.value,s=void 0;switch(n.attributeName){case f.ATTR_POSITION:s=b;break;case f.ATTR_NORMAL:s=w;break;case f.ATTR_TANGENT:s=p;break;default:u("Unexpected attribute!")}void 0!==s&&(t.bindSampler(s,n.morphTexture.sampler),t.bindTexture(s,n.morphTexture.texture))}t.bindBuffer(i.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),Y=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(i.SIZE)),this._remoteBuffer=t.createBuffer(new c(d.UNIFORM|d.TRANSFER_DST,l.HOST|l.DEVICE,i.SIZE,i.SIZE))}var s=t.prototype;return s.destroy=function(){this._remoteBuffer.destroy()},s.setWeights=function(t){r(t.length===this._targetCount);for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(i.OFFSET_OF_WEIGHTS+4*e,t[e],n.sys.isLittleEndian)},s.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(i.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,n.sys.isLittleEndian),this._localBuffer.setFloat32(i.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,n.sys.isLittleEndian)},s.setVerticesCount=function(t){this._localBuffer.setFloat32(i.OFFSET_OF_VERTICES_COUNT,t,n.sys.isLittleEndian)},s.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},e(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function K(t,e){var r,i,n,h;t.hasFeature(v.TEXTURE_FLOAT)?(r=e,n=16,i=a.PixelFormat.RGBA32F,h=Float32Array):(r=4*e,n=4,i=a.PixelFormat.RGBA8888,h=Uint8Array);var f=function(t){t<5&&(t=5);var e=_(t),r=m(e),i=r>>1;return{width:1<<(1&r?i+1:i),height:1<<i}}(r),c=f.width,d=f.height;return{width:c,height:d,create:function(){var e=new ArrayBuffer(c*d*n),r=new Float32Array(e),f=h===Float32Array?r:new h(e),l=new s({width:c,height:d,_data:f,_compressed:!1,format:i}),v=new a;v.setFilters(a.Filter.NEAREST,a.Filter.NEAREST),v.setMipFilter(a.Filter.NONE),v.setWrapMode(a.WrapMode.CLAMP_TO_EDGE,a.WrapMode.CLAMP_TO_EDGE,a.WrapMode.CLAMP_TO_EDGE),v.image=l,v.getGFXTexture()||u("Unexpected: failed to create morph texture?");var _=o.getSampler(t,v.getSamplerHash());return{get texture(){return v.getGFXTexture()},get sampler(){return _},get valueView(){return r},destroy:function(){v.destroy()},updatePixels:function(){v.uploadData(f)}}}}}function $(t,e,r){t.renderingSubMeshes[e].enableVertexIdChannel(r)}function tt(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var et=new x,rt=new x,it=new Uint8Array,nt=t("M",T("cc.Mesh")((X=function(t){function r(){var e;return(e=t.call(this)||this).morphRendering=null,A(e,"_struct",z,M(e)),A(e,"_dataLength",H,M(e)),A(e,"_hash",W,M(e)),e._data=it,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e.loaded=!1,e}y(r,t),e(r,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this.loaded=!0,this.emit("load")}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=S(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]);var i=r.prototype;return i.initialize=function(){var t=this;if(!this._initialized){this._initialized=!0,this._data.byteLength!==this._dataLength&&(this._data=new Uint8Array(this._dataLength),n.assetManager.postLoadNative(this));for(var e=this._data.buffer,r=n.director.root.device,i=this._createVertexBuffers(r,e),s=[],a=function(n){var a=t._struct.primitives[n];if(0===a.vertexBundelIndices.length)return"continue";var u=null,o=null;if(a.indexView){var h=a.indexView,f=h.stride,_=h.length;if(4===f&&!r.hasFeature(v.ELEMENT_INDEX_UINT)){var m=t._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(m>=65536)return N(10001,m,65536),"continue";f>>=1,_>>=1}u=r.createBuffer(new c(d.INDEX,l.DEVICE,_,f)),o=new(tt(h.stride))(e,h.offset,h.count),h.stride!==f&&(o=tt(f).from(o)),t.loaded?u.update(o):t.once("load",(function(){u.update(o)}))}var g=a.vertexBundelIndices.map((function(t){return i[t]})),p=[];if(a.vertexBundelIndices.length>0)for(var w=a.vertexBundelIndices[0],b=t._struct.vertexBundles[w].attributes,x=0;x<b.length;++x){var T=b[x];p[x]=new V(T.name,T.format,T.isInstanced,T.stream,T.isInstanced,T.location)}var y=new k(g,p,a.primitiveMode,u);y.mesh=t,y.subMeshIdx=n,s.push(y)},u=0;u<this._struct.primitives.length;u++)a(u);this._renderingSubMeshes=s,this._struct.morph&&(this.morphRendering=function(t,e){return new q(t,e)}(this,r))}},i.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},i.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},i.assign=function(t,e){this.reset({struct:t,data:e})},i.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._dataLength=this.data.byteLength,this._hash=0,this.loaded=!0,this.emit("load")},i.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var r=[],i=t.bindposes,n=0;n<i.length;n++)e.push(new L(1/0,1/0,1/0,-1/0,-1/0,-1/0)),r.push(!1);for(var s=this._struct.primitives,a=0;a<s.length;a++){var u=this.readAttribute(a,f.ATTR_JOINTS),o=this.readAttribute(a,f.ATTR_WEIGHTS),h=this.readAttribute(a,f.ATTR_POSITION);if(u&&o&&h)for(var c=Math.min(u.length/4,o.length/4,h.length/3),d=0;d<c;d++){x.set(et,h[3*d+0],h[3*d+1],h[3*d+2]);for(var l=0;l<4;++l){var v=4*d+l,_=u[v];if(!(0===o[v]||_>=i.length)){x.transformMat4(rt,et,i[_]),r[_]=!0;var m=e[_];x.min(m.center,m.center,rt),x.max(m.halfExtents,m.halfExtents,rt)}}}}for(var g=0;g<i.length;g++){var p=e[g];r[g]?L.fromPoints(p,p.center,p.halfExtents):e[g]=null}return e},i.merge=function(t,e,r){if(r&&(!this.loaded||!t.loaded||!this.validateMergingMesh(t)))return!1;var i=new x,n=e&&new I,s=e&&new L;if(n&&e.getRotation(n),!this._initialized){var a=JSON.parse(JSON.stringify(t._struct)),u=t._data.slice();if(e){a.maxPosition&&a.minPosition&&(x.add(s.center,a.maxPosition,a.minPosition),x.multiplyScalar(s.center,s.center,.5),x.subtract(s.halfExtents,a.maxPosition,a.minPosition),x.multiplyScalar(s.halfExtents,s.halfExtents,.5),L.transform(s,s,e),x.add(a.maxPosition,s.center,s.halfExtents),x.subtract(a.minPosition,s.center,s.halfExtents));for(var o=0;o<a.vertexBundles.length;o++)for(var c=a.vertexBundles[o],d=0;d<c.attributes.length;d++)if(c.attributes[d].name===f.ATTR_POSITION||c.attributes[d].name===f.ATTR_NORMAL){var l=c.attributes[d].format,v=new DataView(u.buffer,c.view.offset+st(c.attributes,d)),_=ot(v,l),m=ht(v,l);if(!_||!m)continue;for(var g=c.view.count,p=c.view.stride,w=ut(l),b=0;b<g;b++){var T=b*p,y=T+w,A=y+w;switch(i.set(_(T),_(y),_(A)),c.attributes[d].name){case f.ATTR_POSITION:i.transformMat4(e);break;case f.ATTR_NORMAL:x.transformQuat(i,i,n)}m(T,i.x),m(y,i.y),m(A,i.z)}}}return this.reset({struct:a,data:u}),this.initialize(),!0}for(var M,B,R,P,O,U=new j,S=0,N=0,V=0,F=0,C=0,k=0,D=0,G=0,z=!1,H=new Array(this._struct.vertexBundles.length),W=0;W<this._struct.vertexBundles.length;++W){var X=this._struct.vertexBundles[W],q=t._struct.vertexBundles[W];V=X.view.offset,F=q.view.offset,N=X.view.stride,S=X.view.count+q.view.count,M=new ArrayBuffer(S*N),B=new Uint8Array(M),V+=(R=this._data.subarray(V,V+X.view.length)).length,F+=(P=t._data.subarray(F,F+q.view.length)).length,B.set(R),C=0;for(var J,Z=h(X.attributes);!(J=Z()).done;){var Q=J.value;D=0,z=!1;for(var Y,K=h(q.attributes);!(Y=K()).done;){var $=Y.value;if(Q.name===$.name&&Q.format===$.format){z=!0;break}D+=E[$.format].size}if(z){G=E[Q.format].size,k=X.view.length+C;for(var tt=0;tt<q.view.count;++tt){if(O=P.subarray(D,D+G),B.set(O,k),(Q.name===f.ATTR_POSITION||Q.name===f.ATTR_NORMAL)&&e){var et=new Float32Array(B.buffer,k,3);switch(i.set(et[0],et[1],et[2]),Q.name){case f.ATTR_POSITION:i.transformMat4(e);break;case f.ATTR_NORMAL:x.transformQuat(i,i,n)}et[0]=i.x,et[1]=i.y,et[2]=i.z}k+=X.view.stride,D+=q.view.stride}}C+=E[Q.format].size}H[W]={attributes:X.attributes,view:{offset:U.getLength(),length:M.byteLength,count:S,stride:N}},U.addBuffer(M)}for(var rt,it,nt,at=0,ft=2,ct=0,dt=new Array(this._struct.primitives.length),lt=0;lt<this._struct.primitives.length;++lt){var vt=this._struct.primitives[lt],_t=t._struct.primitives[lt];dt[lt]={primitiveMode:vt.primitiveMode,vertexBundelIndices:vt.vertexBundelIndices};for(var mt,gt=h(vt.vertexBundelIndices);!(mt=gt()).done;){var pt=mt.value;ct=Math.max(ct,this._struct.vertexBundles[pt].view.count)}if(vt.indexView&&_t.indexView){at=vt.indexView.count,at+=_t.indexView.count,V=vt.indexView.offset,F=_t.indexView.offset,ft=at<256?1:at<65536?2:4;var wt=new ArrayBuffer(at*ft);if(rt=2===ft?new Uint16Array(wt):1===ft?new Uint8Array(wt):new Uint32Array(wt),it=2===vt.indexView.stride?new Uint16Array(this._data.buffer,V,vt.indexView.count):1===vt.indexView.stride?new Uint8Array(this._data.buffer,V,vt.indexView.count):new Uint32Array(this._data.buffer,V,vt.indexView.count),ft===vt.indexView.stride)rt.set(it);else for(var bt=0;bt<vt.indexView.count;++bt)rt[bt]=it[bt];V+=vt.indexView.length,nt=2===_t.indexView.stride?new Uint16Array(t._data.buffer,F,_t.indexView.count):1===_t.indexView.stride?new Uint8Array(t._data.buffer,F,_t.indexView.count):new Uint32Array(t._data.buffer,F,_t.indexView.count);for(var xt=0;xt<_t.indexView.count;++xt)rt[vt.indexView.count+xt]=ct+nt[xt];F+=_t.indexView.length,dt[lt].indexView={offset:U.getLength(),length:wt.byteLength,count:at,stride:ft},U.setNextAlignment(ft),U.addBuffer(wt)}}var Tt={vertexBundles:H,primitives:dt,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return Tt.minPosition&&t._struct.minPosition&&Tt.maxPosition&&t._struct.maxPosition&&(e?(x.add(s.center,t._struct.maxPosition,t._struct.minPosition),x.multiplyScalar(s.center,s.center,.5),x.subtract(s.halfExtents,t._struct.maxPosition,t._struct.minPosition),x.multiplyScalar(s.halfExtents,s.halfExtents,.5),L.transform(s,s,e),x.add(i,s.center,s.halfExtents),x.max(Tt.maxPosition,Tt.maxPosition,i),x.subtract(i,s.center,s.halfExtents),x.min(Tt.minPosition,Tt.minPosition,i)):(x.min(Tt.minPosition,Tt.minPosition,t._struct.minPosition),x.max(Tt.maxPosition,Tt.maxPosition,t._struct.maxPosition))),this.reset({struct:Tt,data:new Uint8Array(U.getCombined())}),this.initialize(),!0},i.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var r=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(r.attributes.length!==i.attributes.length)return!1;for(var n=0;n<r.attributes.length;++n)if(r.attributes[n].format!==i.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var a=this._struct.primitives[s],u=t._struct.primitives[s];if(a.vertexBundelIndices.length!==u.vertexBundelIndices.length)return!1;for(var o=0;o<a.vertexBundelIndices.length;++o)if(a.vertexBundelIndices[o]!==u.vertexBundelIndices[o])return!1;if(a.primitiveMode!==u.primitiveMode)return!1;if(a.indexView){if(void 0===u.indexView)return!1}else if(u.indexView)return!1}return!0},i.readAttribute=function(t,e){var r=this,i=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,s=t.attributes[e].format,a=B(E[s]);if(0!==n){var u=new DataView(r._data.buffer,t.view.offset+st(t.attributes,e)),o=E[s],h=ot(u,s);if(a&&h){for(var f=o.count,c=new a(n*f),d=t.view.stride,l=0;l<n;++l)for(var v=0;v<f;++v)c[f*l+v]=h(d*l+c.BYTES_PER_ELEMENT*v);i=c}}})),i},i.copyAttribute=function(t,e,r,i,n){var s=this,a=!1;return this._accessAttribute(t,e,(function(t,e){var u=t.view.count;if(0!==u){var o=t.attributes[e].format,h=new DataView(s._data.buffer,t.view.offset+st(t.attributes,e)),f=new DataView(r,n),c=E[o],d=ot(h,o),l=ht(f,o);if(d&&l){for(var v=c.count,_=t.view.stride,m=ut(o),g=i,p=m,w=0;w<u;++w)for(var b=0;b<v;++b)l(g*w+p*b,d(_*w+m*b));a=!0}}else a=!0})),a},i.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var r=e.indexView.stride;return new(1===r?Uint8Array:2===r?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},i.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var r=this._struct.primitives[t];if(!r.indexView)return!1;for(var i=r.indexView.count,n=1===r.indexView.stride?R.R8UI:2===r.indexView.stride?R.R16UI:R.R32UI,s=ot(new DataView(this._data.buffer),n),a=0;a<i;++a)e[a]=s(r.indexView.offset+E[n].size*a);return!0},i._accessAttribute=function(t,e,r){if(!(t>=this._struct.primitives.length))for(var i,n=this._struct.primitives[t],s=h(n.vertexBundelIndices);!(i=s()).done;){var a=i.value,u=this._struct.vertexBundles[a],o=u.attributes.findIndex((function(t){return t.name===e}));if(!(o<0)){r(u,o);break}}},i._createVertexBuffers=function(t,e){var r=this;return this._struct.vertexBundles.map((function(i){var n=t.createBuffer(new c(d.VERTEX,l.DEVICE,i.view.length,i.view.stride)),s=new Uint8Array(e,i.view.offset,i.view.length);return r.loaded?n.update(s):r.once("load",(function(){n.update(s)})),n}))},r}(P),z=O((G=X).prototype,"_struct",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),H=O(G.prototype,"_dataLength",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W=O(G.prototype,"_hash",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D=G))||D);function st(t,e){for(var r=0,i=0;i<e;++i){var n=t[i];r+=E[n.format].size}return r}n.Mesh=nt;var at=C.isLittleEndian;function ut(t){var e=E[t];return e.size/e.count}function ot(t,e){var r=E[e],i=r.size/r.count;switch(r.type){case U.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,at)};case 4:return function(e){return t.getUint32(e,at)}}break;case U.SNORM:case U.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,at)};case 4:return function(e){return t.getInt32(e,at)}}break;case U.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,at)};case 4:return function(e){return t.getUint32(e,at)}}break;case U.FLOAT:return function(e){return t.getFloat32(e,at)}}return null}function ht(t,e){var r=E[e],i=r.size/r.count;switch(r.type){case U.UNORM:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,at)};case 4:return function(e,r){return t.setUint32(e,r,at)}}break;case U.SNORM:case U.INT:switch(i){case 1:return function(e,r){return t.setInt8(e,r)};case 2:return function(e,r){return t.setInt16(e,r,at)};case 4:return function(e,r){return t.setInt32(e,r,at)}}break;case U.UINT:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,at)};case 4:return function(e,r){return t.setUint32(e,r,at)}}break;case U.FLOAT:return function(e,r){return t.setFloat32(e,r,at)}}return null}}}}));
