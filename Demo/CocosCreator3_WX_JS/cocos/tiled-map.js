System.register(["./coordinates-converts-utils-bf8713a9.js","./index-6f89fc06.js","./event-enum-5a5aa40e.js","./deprecated-3.0.0-f3f53c89.js","./renderable-component-658e90bd.js","./transform-utils-1f4a2037.js","./view-7d20208a.js","./screen-d46ce30a.js","./json-asset-0797cbb7.js","./camera-component-f1234106.js","./find-5191dd26.js","./factory-9595a1ce.js","./sprite-frame-30c057cb.js","./sprite-6803ade1.js","./renderable-2d-386fc016.js","./deprecated-a9ea7a0c.js","./ZipUtils-3ae2be0b.js"],(function(t){"use strict";var e,i,r,n,s,o,a,h,l,u,g,f,d,_,c,p,m,y,v,A,w,b,S,T,x,I,C,D,N,O,P,E,G,z,L,R,F,M,X,U,j,H,B,k,Y,V,Z;return{setters:[function(t){e=t.bE,i=t.b0,r=t.bg,n=t.bc,s=t.be,o=t.e4,a=t.c,h=t.f,l=t.e2,u=t.ec,g=t.bZ,f=t.e3,d=t.w,_=t.e5,c=t.fs,p=t.ft,m=t.e7,y=t.e8,v=t.d_,A=t.b9,w=t.b2,b=t.b$,S=t.cK,T=t.fS,x=t.c0,I=t.c5,C=t.ea,D=t.fr,N=t.t,O=t.ck,P=t.e9,E=t.eb,G=t.ep},function(t){z=t.v,L=t.f},function(t){R=t.q},function(){},function(t){F=t.N},function(){},function(){},function(){},function(t){M=t.T},function(t){X=t.P},function(){},function(){},function(t){U=t.S},function(t){j=t.c,H=t.a},function(t){B=t.M,k=t.R,Y=t.U},function(){},function(t){V=t.c,Z=t._}],execute:function(){var K,q,W,J,$,Q,tt;!function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(K||(K={})),e(K),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(q||(q={})),e(q),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(W||(W={})),e(W),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(J||(J={})),e(J),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}($||($={})),e($),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(Q||(Q={})),e(Q),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(tt||(tt={})),e(tt);var et=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new n(0,0),this.tileOffset=new i(0,0),this._tileSize=new n(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new s(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;r&=W.FLIPPED_MASK,r-=this.firstGid;var n=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return i.x=Math.round(r%n*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/n)*(this._tileSize.height+this.spacing)+this.margin),i},t}(),it=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new r(255,255,255,255),this.offset=new i(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),rt=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new i(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();rt.ATTRIB_NONE=1,rt.ATTRIB_BASE64=2,rt.ATTRIB_GZIP=4,rt.ATTRIB_ZLIB=8;var nt=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new i(0,0),this.opacity=0,this.trans=new r(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function st(t){var e=j.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function ot(t){var e=j.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function at(t){if(!t)return new r(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,s=parseInt(t.substr(6,2),16)||0;return new r(i,n,s,e)}var o=parseInt(t.substr(0,2),16)||0,a=parseInt(t.substr(2,2),16)||0,h=parseInt(t.substr(4,2),16)||0;return new r(o,a,h,255)}function ht(t,e){for(var i=[],r=t.getElementsByTagName("properties"),n=0;n<r.length;++n)for(var s=r[n].getElementsByTagName("property"),o=0;o<s.length;++o)i.push(s[o]);e=e||{};for(var a=0;a<i.length;a++){var h=i[a],l=h.getAttribute("name"),u=h.getAttribute("type")||"string",g=h.getAttribute("value");"int"===u?g=parseInt(g):"float"===u?g=parseFloat(g):"bool"===u?g="true"===g:"color"===u&&(g=at(g)),e[l]=g}return e}var lt,ut,gt,ft,dt,_t,ct,pt,mt,yt,vt,At,wt,bt,St,Tt=function(){function t(t,e,i,r,s){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=Q.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new n(0,0),this._tileSize=new n(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,s)}o(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}}]);var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new n(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new n(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,n){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=n,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=rt.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,i){var r,s=(new z).parse(e).documentElement,o=s.getAttribute("orientation"),l=s.getAttribute("staggeraxis"),u=s.getAttribute("staggerindex"),g=s.getAttribute("hexsidelength"),f=s.getAttribute("renderorder"),d=s.getAttribute("version")||"1.0.0";if("map"===s.nodeName){var _=d.split("."),c=this._supportVersion;for(r=0;r<c.length;r++){var p=parseInt(_[r])||0;if(c[r]<p){a(7216,d);break}}"orthogonal"===o?this.orientation=K.ORTHO:"isometric"===o?this.orientation=K.ISO:"hexagonal"===o?this.orientation=K.HEX:null!==o&&a(7217,o),this.renderOrder="right-up"===f?Q.RightUp:"left-up"===f?Q.LeftUp:"left-down"===f?Q.LeftDown:Q.RightDown,"x"===l?this.setStaggerAxis(J.STAGGERAXIS_X):"y"===l&&this.setStaggerAxis(J.STAGGERAXIS_Y),"odd"===u?this.setStaggerIndex($.STAGGERINDEX_ODD):"even"===u&&this.setStaggerIndex($.STAGGERINDEX_EVEN),g&&this.setHexSideLength(parseFloat(g));var m=new n(0,0);m.width=parseFloat(s.getAttribute("width")),m.height=parseFloat(s.getAttribute("height")),this.setMapSize(m),(m=new n(0,0)).width=parseFloat(s.getAttribute("tilewidth")),m.height=parseFloat(s.getAttribute("tileheight")),this.setTileSize(m),this.properties=ht(s)}var y=s.getElementsByTagName("tileset");for("map"!==s.nodeName&&(y=[]).push(s),r=0;r<y.length;r++){var v=y[r],A=v.getAttribute("source");if(A){var w=parseInt(v.getAttribute("firstgid")),b=this._tsxContentMap[A];b&&this.parseXMLString(b,w)}else{var S=v.getElementsByTagName("image"),T=S.length>1,x=S[0],I=x.getAttribute("source");I=I.replace(/\\/g,"/");var C=v.getElementsByTagName("tile"),D=C&&C.length||1,N=null,O=v.getAttribute("name")||"",P=parseInt(v.getAttribute("spacing"))||0,E=parseInt(v.getAttribute("margin"))||0,G=i||parseInt(v.getAttribute("firstgid"))||0,L=new n(0,0);L.width=parseFloat(v.getAttribute("tilewidth")),L.height=parseFloat(v.getAttribute("tileheight"));var R=v.getElementsByTagName("tileoffset")[0],F=0,M=0;R&&(F=parseFloat(R.getAttribute("x"))||0,M=parseFloat(R.getAttribute("y"))||0);for(var X=null,U=0;U<D;U++){if(!X||T){if((X=new et).name=O,X.firstGid=G&W.FLIPPED_MASK,X.tileOffset.x=F,X.tileOffset.y=M,X.collection=T,!T&&(X.imageName=I,X.imageSize.width=parseFloat(x.getAttribute("width"))||0,X.imageSize.height=parseFloat(x.getAttribute("height"))||0,X.sourceImage=this._spriteFrameMap[I],!X.sourceImage)){var j=t.getShortName(I);X.imageName=j,X.sourceImage=this._spriteFrameMap[j],X.sourceImage||(console.error("[error]: "+j+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),h(7221,I),console.warn("Please try asset type of "+I+" to 'sprite-frame'"))}X.spacing=P,X.margin=E,X._tileSize.width=L.width,X._tileSize.height=L.height,this.setTilesets(X)}if(N=C&&C[U]){this.parentGID=G+(parseInt(N.getAttribute("id"))||0);var H=N.getElementsByTagName("image");if(H&&H.length>0){var B=H[0],k=B.getAttribute("source");if(k=k.replace(/\\/g,"/"),X.imageName=k,X.imageSize.width=parseFloat(B.getAttribute("width"))||0,X.imageSize.height=parseFloat(B.getAttribute("height"))||0,X._tileSize.width=X.imageSize.width,X._tileSize.height=X.imageSize.height,X.sourceImage=this._spriteFrameMap[k],!X.sourceImage){var Y=t.getShortName(k);X.imageName=Y,X.sourceImage=this._spriteFrameMap[Y],X.sourceImage||(h(7221,k),console.warn("Please try asset type of "+k+" to 'sprite-frame'"))}X.firstGid=this.parentGID&W.FLIPPED_MASK}var V=(W.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(V,ht(N));var Z=N.getElementsByTagName("animation");if(Z&&Z.length>0){var q=Z[0].getElementsByTagName("frame"),tt={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(V,tt);for(var it=tt.frames,rt=0;rt<q.length;rt++){var nt=q[rt],st=G+(parseInt(nt.getAttribute("tileid"))||0),ot=parseFloat(nt.getAttribute("duration"))||0;it.push({tileid:st,duration:ot/1e3,grid:null})}}}}}}var at=s.childNodes;for(r=0;r<at.length;r++){var lt=at[r];if(!this._shouldIgnoreNode(lt)){if("imagelayer"===lt.nodeName){var ut=this._parseImageLayer(lt);ut&&this.setImageLayers(ut)}if("layer"===lt.nodeName){var gt=this._parseLayer(lt);this.setLayers(gt)}if("objectgroup"===lt.nodeName){var ft=this._parseObjectGroup(lt);this.setObjectGroups(ft)}}}return s},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new nt;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var n=t.getAttribute("opacity");i.opacity=n?Math.round(255*parseFloat(n)):255;var s=t.getAttribute("tintcolor");i.tintColor=s?at(s):null;var o=e[0],a=o.getAttribute("source");return i.sourceImage=this._imageLayerSPF[a],i.width=parseInt(o.getAttribute("width"))||0,i.height=parseInt(o.getAttribute("height"))||0,i.trans=at(o.getAttribute("trans")),i.sourceImage?i:(h(7221,a),console.warn("Please try asset type of "+a+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],r=new rt;r.name=t.getAttribute("name");var s=new n(0,0);s.width=parseFloat(t.getAttribute("width")),s.height=parseFloat(t.getAttribute("height")),r.layerSize=s;var o=t.getAttribute("visible");r.visible=!("0"===o);var h=t.getAttribute("opacity");r.opacity=h?Math.round(255*parseFloat(h)):255,r.offset=new i(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var l=t.getAttribute("tintcolor");r.tintColor=l?at(l):null;for(var u="",g=0;g<e.childNodes.length;g++)u+=e.childNodes[g].nodeValue;u=u.trim();var f,d=e.getAttribute("compression"),_=e.getAttribute("encoding");if(d&&"gzip"!==d&&"zlib"!==d)return a(7218),null;switch(d){case"gzip":f=V.unzipBase64AsArray(u,4);break;case"zlib":f=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var n=4*r;i[r]=t[n]+256*t[n+1]+65536*t[n+2]+t[n+3]*(1<<24)}return i}(new Z.Inflate(V.Base64.decodeAsArray(u,1)).decompress());break;case null:case"":if("base64"===_)f=V.Base64.decodeAsArray(u,4);else if("csv"===_){f=[];for(var c=u.split(","),p=0;p<c.length;p++)f.push(parseInt(c[p]))}else{var m=e.getElementsByTagName("tile");f=[];for(var y=0;y<m.length;y++)f.push(parseInt(m[y].getAttribute("gid")))}break;default:this.layerAttrs===rt.ATTRIB_NONE&&a(7219)}return f&&(r.tiles=new Uint32Array(f)),r.properties=ht(t),r},e._parseObjectGroup=function(t){var e=new it;e.name=t.getAttribute("name")||"",e.offset=new i(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var r=t.getAttribute("opacity");e.opacity=r?Math.round(255*parseFloat(r)):255;var n=t.getAttribute("tintcolor");e.tintColor=n?at(n):null;var s=t.getAttribute("visible");s&&0===parseInt(s)&&(e.visible=!1);var o=t.getAttribute("color");o&&e.color.fromHEX(o);var a=t.getAttribute("draworder");a&&(e.draworder=a),e.setProperties(ht(t));var h=t.getElementsByTagName("object");if(h){for(var l=0;l<h.length;l++){var u=h[l],g={};g.id=u.getAttribute("id")||l,g.name=u.getAttribute("name")||"",g.width=parseFloat(u.getAttribute("width"))||0,g.height=parseFloat(u.getAttribute("height"))||0,g.x=parseFloat(u.getAttribute("x"))||0,g.y=parseFloat(u.getAttribute("y"))||0,g.rotation=parseFloat(u.getAttribute("rotation"))||0,ht(u,g);var f=u.getAttribute("visible");g.visible=!(f&&0===parseInt(f));var d=u.getElementsByTagName("text");if(d&&d.length>0){var _=d[0];g.type=tt.TEXT,g.wrap="1"===_.getAttribute("wrap"),g.color=at(_.getAttribute("color")),g.halign=st(_.getAttribute("halign")),g.valign=ot(_.getAttribute("valign")),g.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,g.text=_.childNodes[0].nodeValue}var c=u.getAttribute("gid");c&&(g.gid=parseInt(c),g.type=tt.IMAGE);var p=u.getElementsByTagName("ellipse");p&&p.length>0&&(g.type=tt.ELLIPSE);var m=u.getElementsByTagName("polygon");if(m&&m.length>0){g.type=tt.POLYGON;var y=m[0].getAttribute("points");y&&(g.points=this._parsePointsString(y))}var v=u.getElementsByTagName("polyline");if(v&&v.length>0){g.type=tt.POLYLINE;var A=v[0].getAttribute("points");A&&(g.polylinePoints=this._parsePointsString(A))}g.type||(g.type=tt.RECT),e.objects.push(g)}"index"!==a&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var n=i[r].split(",");e.push({x:parseFloat(n[0]),y:parseFloat(n[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},o(t,[{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),xt=t("TiledTile",(lt=l("cc.TiledTile"),ut=c(),gt=p(),ft=u(g),dt=u(g),_t=u(g),ct=u(g),pt=u(g),lt(mt=ut(mt=gt((wt=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,m(e,"_x",vt,y(e)),m(e,"_y",At,y(e)),e}f(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile()},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))d("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this)}}},o(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?d("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?d("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(v),vt=_((yt=wt).prototype,"_x",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),At=_(yt.prototype,"_y",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(yt.prototype,"x",[_t],Object.getOwnPropertyDescriptor(yt.prototype,"x"),yt.prototype),_(yt.prototype,"y",[ct],Object.getOwnPropertyDescriptor(yt.prototype,"y"),yt.prototype),_(yt.prototype,"grid",[pt],Object.getOwnPropertyDescriptor(yt.prototype,"grid"),yt.prototype),mt=yt))||mt)||mt)||mt));function It(t,e,i){var r=i||t.sourceImage,n=r.texture,o=t.collection;if(!t.imageSize.width||!t.imageSize.height){var a=t.sourceImage;t.imageSize.width=a.width,t.imageSize.height=a.height}var h=t.imageSize.width,l=t.imageSize.height,u=t._tileSize.width,g=t._tileSize.height,f=r.width,d=r.height,_=t.spacing,c=t.margin,p=1;if(!o){var m=Math.floor((h-2*c+_)/(u+_)),y=Math.floor((l-2*c+_)/(g+_));p=Math.max(1,y*m)}for(var v=t.firstGid,A=null,w=!!e.get(v),b=t.firstGid+p,S=v;S<b&&(w&&!e.get(S)&&(w=!1),w||!e.get(S));++S){if(A={tileset:t,x:0,y:0,width:u,height:g,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:S,spriteFrame:r,texture:n},t.rectForGID(S,A),!i||p>1)if(i){A._name=i.name;var T=i.unbiasUV[0],x=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];A.l=T+(A.x+.5)/f,A.t=x+(A.y+.5)/d,A.r=T+(A.x+A.width-.5)/f,A.b=x+(A.y+A.height-.5)/d,A._rect=new s(A.x,A.y,A.width,A.height)}else A.l=A.x/f,A.t=A.y/d,A.r=(A.x+A.width)/f,A.b=(A.y+A.height)/d,A._rect=new s(A.x,A.y,A.width,A.height);else i.rotated?(A._rotated=!0,A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[1],A.r=i.unbiasUV[4],A.b=i.unbiasUV[3]):(A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[5],A.r=i.unbiasUV[2],A.b=i.unbiasUV[1]);A.cx=(A.l+A.r)/2,A.cy=(A.t+A.b)/2,e.set(S,A)}}function Ct(t,e){var i=t.length;if(0!==i)for(var r=0,n=function(){++r>=i&&e()},s=0;s<i;s++){var o=t[s];o.loaded?n():o.once("load",(function(){n()}))}else e()}for(var Dt,Nt,Ot,Pt,Et,Gt,zt,Lt,Rt,Ft,Mt,Xt,Ut,jt,Ht,Bt,kt,Yt,Vt,Zt,Kt,qt,Wt,Jt,$t,Qt,te,ee,ie,re,ne,se,oe,ae,he,le,ue,ge,fe,de,_e=new A,ce=new i,pe=new w,me=new w,ye={row:0,col:0},ve=t("TiledUserNodeData",l("cc.TiledUserNodeData")(bt=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return f(e,t),e}(v))||bt),Ae=t("TiledLayer",l("cc.TiledLayer")(St=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}f(e,t),o(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}}]);var r=e.prototype;return r.hasTiledNode=function(){return this._hasTiledNodeGrid},r.hasAnimation=function(){return this._hasAniGrid},r.addUserNode=function(t){var e=t.getComponent(ve);return e?(d("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(ve),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),ce),this._positionToRowCol(ce.x,ce.y,ye),this._addUserNodeToGrid(e,ye),this._updateCullingOffsetByUserNode(t),t.on(R.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(R.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},r.removeUserNode=function(t){var e=t.getComponent(ve);return e?(t.off(R.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(R.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(d("CCTiledLayer:removeUserNode node is not exist"),!1)},r.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},r._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},r.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},r.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},r._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),ce),this._positionToRowCol(ce.x,ce.y,ye),this._addUserNodeToGrid(e,ye),this._updateCullingOffsetByUserNode(e.node)}},r._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},r._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},r._userNodePosChange=function(){var t=this.node,e=this._tiledLayer;e._nodeLocalPosToLayerPos(t.getPosition(),ce),e._positionToRowCol(ce.x,ce.y,ye),e._limitInLayer(ye),ye.row===this._row&&ye.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,ye))},r._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,n=this._userNodeGrid[e],s=n&&n[i];s&&(n.count--,s.count--,s.list[r]=null,s.count<=0&&(s.list.length=0,s.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},r._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},r._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,n=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},s=n[r]=n[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=s.list.length,n.count++,s.count++,s.list.push(t),this._userNodeDirty=!0},r.isUserNodeDirty=function(){return this._userNodeDirty},r.setUserNodeDirty=function(t){this._userNodeDirty=t},r.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(R.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(R.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(R.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(R.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(R.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},r.onDisable=function(){t.prototype.onDisable.call(this),this.node.parent.off(R.SIZE_CHANGED,this.updateCulling,this),this.node.parent.off(R.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(R.SIZE_CHANGED,this.updateCulling,this),this.node.off(R.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(R.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},r.onDestroy=function(){t.prototype.onDestroy.call(this)},r.getLayerName=function(){return this._layerName},r.setLayerName=function(t){this._layerName=t},r.getProperty=function(t){return this._properties[t]},r.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case K.ORTHO:return this._positionForOrthoAt(i,e);case K.ISO:return this._positionForIsoAt(i,e);case K.HEX:return this._positionForHexAt(i,e)}return null},r.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},r._positionForIsoAt=function(t,e){var r=0,n=0,s=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[s];if(o){var a=(o&W.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,n=h.y}return new i(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+r,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-n)},r._positionForOrthoAt=function(t,e){var r=0,n=0,s=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[s];if(o){var a=(o&W.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,n=h.y}return new i(t*this._mapTileSize.width+r,(this._layerSize.height-e-1)*this._mapTileSize.height-n)},r._positionForHexAt=function(t,e){var r,n=this._mapTileSize.width,s=this._mapTileSize.height,o=this._layerSize.height,a=Math.floor(t)+Math.floor(e)*this._layerSize.width,h=(this.tiles[a]&W.FLIPPED_MASK)>>>0;r=this.texGrids.get(h)?this.texGrids.get(h).tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===$.STAGGERINDEX_ODD?1:-1,u=0,g=0,f=0,d=0;switch(this._staggerAxis){case J.STAGGERAXIS_Y:f=0,e%2==1&&(f=n/2*l),u=t*n+f+r.x,g=(o-e-1)*(s-(s-this._hexSideLength)/2)-r.y;break;case J.STAGGERAXIS_X:d=0,t%2==1&&(d=s/2*-l),u=t*(n-(n-this._hexSideLength)/2)+r.x,g=(o-e-1)*s+d-r.y}return new i(u,g)},r.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var n=0,s=e+r,o=i;;o++)for(var a=e;a<s;a++){if(n>=t.length)return;this._updateTileForGID(t[n],a,o),n++}}},r.setTileGIDAt=function(t,e,i,r){var n=(t&W.FLIPPED_MASK)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==n&&n<this._tilesets[0].firstGid?a(7239,t):(r=r||0,this._updateTileForGID((n|r)>>>0,e,i)):a(7238)},r._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var n=(t&W.FLIPPED_MASK)>>>0;this.texGrids.get(n)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},r.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return a(7237),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&W.FLIPPED_MASK)>>>0},r.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return a(7240),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&W.FLIPPED_ALL)>>>0},r.setCullingDirty=function(t){this._cullingDirty=t},r.isCullingDirty=function(){return this._cullingDirty},r.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var n=1;this._layerOrientation===K.ISO&&(n=2);var s=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=s-this._leftOffset,h=o-this._downOffset,l=s+i+this._rightOffset,u=o+r+this._topOffset,g=this._cullingRect.leftDown,f=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,ye),ye.row-=n,ye.col-=n,ye.row=ye.row>0?ye.row:0,ye.col=ye.col>0?ye.col:0,ye.row===g.row&&ye.col===g.col||(g.row=ye.row,g.col=ye.col,this._cullingDirty=!0),l<0||u<0?(ye.row=-1,ye.col=-1):(this._positionToRowCol(l,u,ye),ye.row++,ye.col++),ye.row>this._rightTop.row&&(ye.row=this._rightTop.row),ye.col>this._rightTop.col&&(ye.col=this._rightTop.col),ye.row===f.row&&ye.col===f.col||(f.row=ye.row,f.col=ye.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},r._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,n=this._mapTileSize.height,s=.5*r,o=.5*n,a=0,h=0,l=0,u=0,g=this._staggerAxis;switch(this._layerOrientation){case K.ORTHO:h=Math.floor(t/r),a=Math.floor(e/n);break;case K.ISO:h=Math.floor(t/s),a=Math.floor(e/o);break;case K.HEX:g===J.STAGGERAXIS_Y?(l=(a=Math.floor(e/(n-this._diffY1)))%2==1?s*this._odd_even:0,h=Math.floor((t-l)/r)):(u=(h=Math.floor(t/(r-this._diffX1)))%2==1?o*-this._odd_even:0,a=Math.floor((e-u)/n))}return i.row=a,i.col=h,i},r.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),A.invert(_e,this.node.getWorldMatrix());var t=L.root.batcher2D.getFirstRenderCamera(this.node);t&&(pe.x=0,pe.y=0,pe.z=0,me.x=t.width,me.y=t.height,me.z=0,t.screenToWorld(pe,pe),t.screenToWorld(me,me),w.transformMat4(pe,pe,_e),w.transformMat4(me,me,_e),this.updateViewPort(pe.x,pe.y,me.x-pe.x,me.y-pe.y))}},r.getLayerOrientation=function(){return this._layerOrientation},r.getProperties=function(){return this._properties},r._updateVertex=function(t,e){var i=W.FLIPPED_MASK,r=this.vertices,n=this._layerOrientation,s=this.tiles;if(s){var o,a,h,l,u=this._rightTop,g=this._mapTileSize.width,f=this._mapTileSize.height,d=.5*g,_=.5*f,c=this._layerSize.height,p=this._layerSize.width,m=this.texGrids,y=0,v=0;n===K.HEX&&(o=this._staggerAxis,a=this._diffX1,h=this._diffY1,l=this._odd_even);var A,w,b,S=0,T=0,x=0,I=0,C=e*p+t;A=(s[C]&i)>>>0;var D=m.get(A);if(D){switch(this._animations.get(A)&&(this._hasAniGrid=this._hasAniGrid||!0),n){case K.ORTHO:y=(S=t)*g,v=(T=c-e-1)*f;break;case K.ISO:y=d*(S=c+t-e-1),v=_*(T=c+p-t-e-2);break;case K.HEX:y=t*(g-a)+(o===J.STAGGERAXIS_Y&&e%2==1?d*l:0),v=(c-e-1)*(f-h)+(o===J.STAGGERAXIS_X&&t%2==1?_*-l:0),S=t,T=c-e-1}var N=r[T]=r[T]||{minCol:0,maxCol:0},O=N[S]=N[S]||{};N.minCol>S&&(N.minCol=S),N.maxCol<S&&(N.maxCol=S),u.row<T&&(u.row=T),u.col<S&&(u.col=S);var P=D.tileset.tileOffset;y+=this._offset.x+P.x+D.offsetX,v+=this._offset.y-P.y-D.offsetY,x=(x=-P.y+D.tileset._tileSize.height-f)<0?0:x,w=P.y<0?0:P.y,b=-P.x<0?0:-P.x,I=(I=P.x+D.tileset._tileSize.width-g)<0?0:I,this._rightOffset<b&&(this._rightOffset=b),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<w&&(this._topOffset=w),this._downOffset<x&&(this._downOffset=x),O.left=y,O.bottom=v,O.index=C,this._cullingDirty=!0}}},r._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var n=0;n<i;++n)this._updateVertex(n,r);this._verticesDirty=!1}},r.getTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return a(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiledTiles[r];if(!n&&i){var s=new F;return(n=s.addComponent(xt))._x=t,n._y=e,n._layer=this,n.updateInfo(),s.parent=this.node,n}return n},r.setTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return a(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((function(t){return!!t})),i},r.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},r.getTextures=function(){return this._textures},r.setTexture=function(t){this.setTextures([t])},r.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},r.getLayerSize=function(){return this._layerSize},r.getMapTileSize=function(){return this._mapTileSize},r.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},r.getTileSets=function(){return this._tilesets},r.setTileSet=function(t){this.setTileSets([t])},r.setTileSets=function(t){var e=this;this._tilesets=t;var i=this._textures=[],r=this.texGrids;r.clear();for(var n=0;n<t.length;n++){var s=t[n];s&&(i[n]=s.sourceImage)}Ct(i,(function(){for(var i=0,n=t.length;i<n;++i){var s=t[i];s&&It(s,r,s.sourceImage)}e._prepareToRender()}))},r.init=function(t,e,r,n,s){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var o=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=o,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=r,this._textures=n,this.texGrids=s,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var a=this._mapTileSize.width,h=this._mapTileSize.height,l=this._layerSize.width,u=this._layerSize.height;if(this._layerOrientation===K.HEX){var g=0,f=0;this._odd_even=this._staggerIndex===$.STAGGERINDEX_ODD?1:-1,this._staggerAxis===J.STAGGERAXIS_X?(this._diffX1=(a-this._hexSideLength)/2,this._diffY1=0,f=h*(u+.5),g=(a+this._hexSideLength)*Math.floor(l/2)+a*(l%2)):(this._diffX1=0,this._diffY1=(h-this._hexSideLength)/2,g=a*(l+.5),f=(h+this._hexSideLength)*Math.floor(u/2)+h*(u%2)),this.node._uiProps.uiTransformComp.setContentSize(g,f)}else if(this._layerOrientation===K.ISO){var d=l+u;this.node._uiProps.uiTransformComp.setContentSize(.5*a*d,.5*h*d)}else this.node._uiProps.uiTransformComp.setContentSize(l*a,u*h);this._offset=new i(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},r._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},r.requestMeshRenderData=function(){var t=this;this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var e=this._meshRenderDataArray;e.length>0&&e[e.length-1].subNodes&&0===e[e.length-1].subNodes.length;)e.pop();if(e.length>0){var i=e[e.length-1];if(i.renderData&&0===i.renderData.byteCount)return i}var r=new B,n={renderData:r,texture:null};return Object.defineProperty(r,"material",{get:function(){return t.getRenderMaterial(0)}}),this._meshRenderDataArray.push(n),n},r.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].renderData&&0===t[t.length-1].renderData.byteCount;)t.pop();if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},r.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){t.renderData&&t.renderData.reset()})),this._meshRenderDataArray.length=0)},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},r._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var i=this._meshRenderDataArray[e];i.subNodes?i.subNodes.forEach((function(e){e&&t.walk(e.node)})):i.texture&&t.commitComp(this,i.texture,this._assembler,null)}this.node._static=!0}},o(e,[{key:"enableCulling",set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())},get:function(){return this._enableCulling}}]),e}(k))||St),we=t("TiledObjectGroup",(Dt=l("cc.TiledObjectGroup"),Nt=c(),Ot=T(Y),Pt=u(b),Dt(Et=Nt(Et=Ot((zt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}f(e,t);var n=e.prototype;return n.getPositionOffset=function(){return this._positionOffset},n.getProperties=function(){return this._properties},n.getGroupName=function(){return this._groupName},n.getProperty=function(t){return this._properties[t.toString()]},n.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},n.getObjects=function(){return this._objects},n._init=function(t,e,n){var s=W.FLIPPED_MASK,o=W.HORIZONTAL,a=W.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new i(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=n,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var h=e.mapSize,l=e.tileSize,u=0,g=0,f=new r,d=K.ISO===e.orientation;if(e.orientation===K.HEX)e.getStaggerAxis()===J.STAGGERAXIS_X?(g=l.height*(h.height+.5),u=(l.width+e.getHexSideLength())*Math.floor(h.width/2)+l.width*(h.width%2)):(u=l.width*(h.width+.5),g=(l.height+e.getHexSideLength())*Math.floor(h.height/2)+l.height*(h.height%2));else if(d){var _=h.width+h.height;u=.5*l.width*_,g=.5*l.height*_}else u=h.width*l.width,g=h.height*l.height;var c=this.node._uiProps.uiTransformComp;c.setContentSize(u,g);for(var p=u*c.anchorX,m=g*(1-c.anchorY),y=t.objects,v={},A=0,w=y.length;A<w;A++){var b=y[A],T=b.type;b.offset=new i(b.x,b.y);var x=b.points||b.polylinePoints;if(x)for(var I=0;I<x.length;I++)x[I].y*=-1;if(d){var C=b.x/l.height,D=b.y/l.height;b.x=.5*l.width*(h.height+C-D),b.y=.5*l.height*(h.width+h.height-C-D)}else b.y=g-b.y;if(T===tt.TEXT){var N="text"+b.id;v[N]=!0;var O=this.node.getChildByName(N);O||(O=new F),O.setRotationFromEuler(0,0,-b.rotation),O.setPosition(b.x-p,b.y-m),O.name=N,O.parent=this.node,O.setSiblingIndex(A);var P=O.getComponent(j);P||(P=O.addComponent(j));var E=O._uiProps.uiTransformComp;O.active=b.visible,E.anchorX=0,E.anchorY=1,this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,P.color.set(f)):P.color.a*=this._opacity/255,P.overflow=j.Overflow.SHRINK,P.lineHeight=b.height,P.string=b.text,P.horizontalAlign=b.halign,P.verticalAlign=b.valign,P.fontSize=b.pixelsize,E.setContentSize(b.width,b.height)}else if(T===tt.IMAGE){var G=b.gid,z=(G&s)>>>0,L=n.get(z);if(!L)continue;var R=L.tileset,M="img"+b.id;v[M]=!0;var B=this.node.getChildByName(M);b.width=b.width||L.width,b.height=b.height||L.height,B instanceof X&&(B.removeFromParent(),B.destroy(),B=null),B||(B=new F),this._animations.get(z)&&(this.aniObjects.push({object:b,imgNode:B,gridGID:z}),this._hasAniObj=!0);var k=R.tileOffset.x,Y=R.tileOffset.y;B.active=b.visible,B.setRotationFromEuler(0,0,-b.rotation),B.setPosition(b.x-p,b.y-m),B.name=M,B.parent=this.node,B.setSiblingIndex(A);var V=B.getComponent(H);V||(V=B.addComponent(H));var Z=B._uiProps.uiTransformComp;d?(Z.anchorX=.5+k/b.width,Z.anchorY=Y/b.height):(Z.anchorX=k/b.width,Z.anchorY=Y/b.height),this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,V.color.set(f)):V.color.a*=this._opacity/255,V.sizeMode=H.SizeMode.CUSTOM,V.srcBlendFactor=this._premultiplyAlpha?S.ONE:S.SRC_ALPHA,V.dstBlendFactor=S.ONE_MINUS_SRC_ALPHA,V._updateBlendFunc();var q=L.spriteFrame;q=q?q.clone():new U,(G&o)>>>0&&(q.flipUVX=!q.flipUVX),(G&a)>>>0&&(q.flipUVY=!q.flipUVY),q.rotated=L._rotated,q.rect=L._rect,V.spriteFrame=q,Z.setContentSize(b.width,b.height),V.markForUpdateRenderData()}}this._objects=y;for(var $=this.node.children,Q=/^(?:img|text)\d+$/,et=0,it=$.length;et<it;et++){var rt=$[et],nt=rt.name;Q.test(nt)&&!v[nt]&&rt.destroy()}},n.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=K.ISO===this._mapInfo.orientation,r=0,n=t.length;r<n;r++){var s=t[r],o=s.gridGID,a=e.get(o);if(a){var h=a.tileset,l=s.object,u=s.imgNode,g=h.tileOffset.x,f=h.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+g/l.width,d.anchorY=f/l.height):(d.anchorX=g/l.width,d.anchorY=f/l.height);var _=u.getComponent(H),c=_.spriteFrame;c.rotated=a._rotated,c.rect=a._rect,_.spriteFrame=c,_.markForUpdateRenderData()}}},o(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(v),_((Gt=zt).prototype,"premultiplyAlpha",[Pt],Object.getOwnPropertyDescriptor(Gt.prototype,"premultiplyAlpha"),Gt.prototype),Et=Gt))||Et)||Et)||Et)),be=t("TiledMapAsset",(Lt=l("cc.TiledMapAsset"),Rt=u([M]),Ft=u([x]),Mt=u([U]),Xt=u([U]),Ut=u([x]),jt=u([x]),Ht=u([n]),Lt((te=Qt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,m(e,"tmxXmlStr",Yt,y(e)),m(e,"tsxFiles",Vt,y(e)),m(e,"tsxFileNames",Zt,y(e)),m(e,"spriteFrames",Kt,y(e)),m(e,"imageLayerSpriteFrame",qt,y(e)),m(e,"imageLayerSpriteFrameNames",Wt,y(e)),m(e,"spriteFrameNames",Jt,y(e)),m(e,"spriteFrameSizes",$t,y(e)),e}return f(e,t),e}(I),Qt.preventDeferredLoadDependents=!0,Yt=_((kt=te).prototype,"tmxXmlStr",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vt=_(kt.prototype,"tsxFiles",[C,Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zt=_(kt.prototype,"tsxFileNames",[C,Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kt=_(kt.prototype,"spriteFrames",[C,Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qt=_(kt.prototype,"imageLayerSpriteFrame",[C,Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wt=_(kt.prototype,"imageLayerSpriteFrameNames",[C,Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jt=_(kt.prototype,"spriteFrameNames",[C,jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$t=_(kt.prototype,"spriteFrameSizes",[C,Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bt=kt))||Bt)),Se=(t("TiledMap",(ee=l("cc.TiledMap"),ie=c(),re=p(),ne=T(Y),se=u(be),oe=E(),ee(ae=ie(ae=re(ae=ne(ae=D((de=fe=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new n(0,0),e._tileSize=new n(0,0),e._preloaded=!1,e._mapOrientation=K.ORTHO,m(e,"_tmxFile",le,y(e)),m(e,"_enableCulling",ue,y(e)),m(e,"cleanupImageCache",ge,y(e)),e}f(e,t);var r=e.prototype;return r.getMapSize=function(){return this._mapSize},r.getTileSize=function(){return this._tileSize},r.getMapOrientation=function(){return this._mapOrientation},r.getObjectGroups=function(){return this._groups},r.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getGroupName()===t)return n}return null},r.getProperties=function(){return this._properties},r.getLayers=function(){return this._layers},r.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getLayerName()===t)return n}return null},r._changeLayer=function(t,e){for(var i=this._layers,r=0,n=i.length;r<n;r++){var s=i[r];if(s&&s.getLayerName()===t)return void(i[r]=e)}},r.getProperty=function(t){return this._properties[t.toString()]},r.getPropertiesForGID=function(t){return this._tileProperties.get(t)},r.__preload=function(){this._preloaded=!0,this._tmxFile&&this._applyFile()},r.onEnable=function(){this.node.on(R.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r.onDisable=function(){this.node.off(R.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._applyFile=function(){var t=[],e={},i=this._tmxFile;if(i){for(var r=i.spriteFrameNames,n=i.spriteFrameSizes,s=i.spriteFrames,o={},h={},l=0;l<r.length;++l){var u=r[l];h[u]=n[l],t[l]=s[l];var g=t[l];g&&(e[g.name]=g,o[u]=g)}var f={},d=i.imageLayerSpriteFrame;r=i.imageLayerSpriteFrameNames;for(var _=0;_<d.length;++_)f[r[_]]=d[_];for(var c=i.tsxFileNames,p=i.tsxFiles,m={},y=0;y<c.length;++y)c[y].length>0&&(m[c[y]]=p[y].text);var v=new Tt(i.tmxXmlStr,m,o,h,f),A=v.getTilesets();A&&0!==A.length||a(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},r._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(),t[e].node.destroy();t.length=0;for(var r=this._groups,n=0,s=r.length;n<s;n++)r[n].node.removeFromParent(),r[n].node.destroy();r.length=0;for(var o=this._images,a=0,h=o.length;a<h;a++)o[a].removeFromParent(),o[a].destroy();o.length=0},r._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,n=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var s=this._groups[t],o=s.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var a=s.offset.x-r+o.width*o.anchorX,h=s.offset.y+n-o.height*o.anchorY;s.node.setPosition(a,h)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-r+l.width*l.anchorX,g=this._images[t]._offset.y+n-l.height*l.anchorY;this._images[t].setPosition(u,g)}},r._fillAniGrids=function(t,e){for(var i,r=N(e.keys());!(i=r()).done;){var n=i.value,s=e.get(n);if(s)for(var o=s.frames,a=0;a<o.length;a++){var h=o[a];h.grid=t.get(h.tileid)}}},r._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,r=this._animations;e.clear();for(var n=0,s=t.length;n<s;++n){var o=t[n];o&&(o.sourceImage?It(o,e,o.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+n))}this._fillAniGrids(e,r);for(var a=this._layers,h=this._groups,l=this._images,u={},g=0,f=a.length;g<f;g++)u[a[g].node.name]=!0;for(var d=0,_=h.length;d<_;d++)u[h[d].node.name]=!0;for(var c=0,p=l.length;c<p;c++)u[l[c].name]=!0;a=this._layers=[],h=this._groups=[],l=this._images=[];var m=this._mapInfo,y=this.node,v=m.getAllChildren(),A=this._textures,w=0,b=0;if(v&&v.length>0)for(var S=0,T=v.length;S<T;S++){var x=v[S],I=x.name,C=this.node.getChildByName(I);if(u[I]=!1,C||((C=new F).name=I,y.addChild(C)),C.setSiblingIndex(S),C.active=x.visible,x instanceof rt){var D=C.getComponent(Ae);D||(D=C.addComponent(Ae)),D.init(x,m,t,A,e),D.enableCulling=this._enableCulling,x.ownTiles=!1,a.push(D)}else if(x instanceof it){var N=C.getComponent(we);N||(N=C.addComponent(we)),N._init(x,m,e),h.push(N)}else if(x instanceof nt){var O=x.sourceImage;C.layerInfo=x,C._offset=new i(x.offset.x,-x.offset.y);var P=C.getComponent(H);P||(P=C.addComponent(H)),P.color.a*=x.opacity,P.spriteFrame=O,C._uiProps.uiTransformComp.setContentSize(O.width,O.height),l.push(C)}w=Math.max(w,C._uiProps.uiTransformComp.width),b=Math.max(b,C._uiProps.uiTransformComp.height)}for(var E=y.children,G=0,z=E.length;G<z;G++){var L=E[G];u[L.name]&&L.destroy()}this.node._uiProps.uiTransformComp.setContentSize(w,b),this._syncAnchorPoint()},r._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var i=this._tilesets;this._textures.length=0;for(var r=[],n=0,s=i.length;n<s;++n){var o=i[n];o&&o.sourceImage&&(this._textures[n]=o.sourceImage,r.push(o.sourceImage))}for(var a=0;a<this._imageLayers.length;a++){var h=this._imageLayers[a];h&&h.sourceImage&&r.push(h.sourceImage)}Ct(r,(function(){e._buildLayerAndGroup(),e.cleanupImageCache&&e._textures.forEach((function(t){e.doCleanupImageCache(t)}))}))},r.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":O.capabilities.imageBitmap&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},r.update=function(t){for(var e,i=this._animations,r=this._texGrids,n=N(i.keys());!(e=n()).done;){var s=e.value,o=i.get(s),a=o.frames,h=a[o.frameIdx];o.dt+=t,h.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=a.length&&(o.frameIdx=0),h=a[o.frameIdx]),r.set(s,h.grid)}},o(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||G)&&(this._tmxFile=t,(this._preloaded||G)&&this._applyFile())}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(v),fe.Orientation=K,fe.Property=q,fe.TileFlag=W,fe.StaggerAxis=J,fe.StaggerIndex=$,fe.TMXObjectType=tt,fe.RenderOrder=Q,le=_((he=de).prototype,"_tmxFile",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(he.prototype,"tmxAsset",[se,oe],Object.getOwnPropertyDescriptor(he.prototype,"tmxAsset"),he.prototype),ue=_(he.prototype,"_enableCulling",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_(he.prototype,"enableCulling",[P],Object.getOwnPropertyDescriptor(he.prototype,"enableCulling"),he.prototype),ge=_(he.prototype,"cleanupImageCache",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ae=he))||ae)||ae)||ae)||ae)||ae)),Math.ceil(10922.5)),Te=[],xe=0;xe<4;xe++)Te.push(new w);var Ie,Ce,De=new A,Ne=new w,Oe={row:0,col:0},Pe={x:0,y:0},Ee={x:0,y:0},Ge={x:0,y:0},ze={x:0,y:0},Le=0,Re=0,Fe=0,Me=0,Xe={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(Fe=t.leftDownToCenterX,Me=t.leftDownToCenterY,Ie=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()){var i,r;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var n=t.cullingRect;i=n.leftDown,r=n.rightTop}else i=Oe,r=t.rightTop;switch(t.renderOrder){case Q.RightDown:He(i,r,-1,1,t);break;case Q.LeftDown:He(i,r,-1,-1,t);break;case Q.RightUp:He(i,r,1,1,t);break;case Q.LeftUp:default:He(i,r,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}Ie=null},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[0]=e.a/255;var r=t.meshRenderDataArray;if(r)for(var n,s=N(r);!(n=s()).done;){var o=n.value;if(o.renderData)for(var a=o.renderData,h=a.vData,l=a.vertexStart,u=a.vertexCount;l<u;l++)h.set(i,9*l+5)}},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){var i=t.meshRenderDataArray,r=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,o=n.indicesOffset,a=n.vertexOffset,h=i[t._meshRenderDataArrayIdx].renderData;n.request(h.vertexCount,h.indicesCount)||(n=e.currBufferBatch,s=0,o=0,a=0);var l=n.vData,u=n.iData,g=r.worldMatrix,f=h.vData,d=h.vertexStart;l.set(f.slice(d,d+9*h.vertexCount),s);for(var _=0;_<h.vertexCount;_++){var c=s+9*_;Ne.set(l[c],l[c+1],l[c+2]),Ne.transformMat4(g),l[c]=Ne.x,l[c+1]=Ne.y,l[c+2]=Ne.z}for(var p=h.vertexCount/4,m=0;m<p;m+=1)u[o]=a,u[o+1]=a+1,u[o+2]=a+2,u[o+3]=a+2,u[o+4]=a+1,u[o+5]=a+3,o+=6,a+=4}}};function Ue(t,e){var i;t._rotated?(Pe.x=t.r,Pe.y=t.t,Ee.x=t.l,Ee.y=t.t,Ge.x=t.r,Ge.y=t.b,ze.x=t.l,ze.y=t.b):(Pe.x=t.l,Pe.y=t.t,Ee.x=t.l,Ee.y=t.b,Ge.x=t.r,Ge.y=t.t,ze.x=t.r,ze.y=t.b),(e&W.DIAGONAL)>>>0&&(i=Ee,Ee=Ge,Ge=i),(e&W.HORIZONTAL)>>>0&&(i=Pe,Pe=Ge,Ge=i,i=Ee,Ee=ze,ze=i),(e&W.VERTICAL)>>>0&&(i=Pe,Pe=Ee,Ee=i,i=Ge,Ge=ze,ze=i)}function je(t,e,i){t||(t=e.texture),Ie.texture||(Ie.texture=t),(Ie=i.requestMeshRenderData()).texture=e.texture}function He(t,e,i,r,n){if(!(!Ie||e.row<0||e.col<0)){Ie.renderData||(Ie=n.requestMeshRenderData());var s=Ie.renderData.vData;Le=0,Re=0;var o,a,h,l,u,g,f,d,_,c=n.tiledTiles,p=n.texGrids,m=n.tiles,y=n.vertices,v=0,A=0,w=0,b=0,S=0,T=null,x=0,I=!0;Ce=Ue;var C=new Float32Array(4);for(C[0]=n.color.r/255,C[1]=n.color.g/255,C[2]=n.color.b/255,C[3]=n.color.a/255,-1===i?(l=e.row,u=t.row):(l=t.row,u=e.row);(u-l)*i>=0;l+=i)for(o=y[l],x=n.getNodesCountByRow(l),I=o&&0===x,1===r?(a=I&&t.col<o.minCol?o.minCol:t.col,h=I&&e.col>o.maxCol?o.maxCol:e.col):(a=I&&e.col>o.maxCol?o.maxCol:e.col,h=I&&t.col<o.minCol?o.minCol:t.col);(h-a)*r>=0;a+=r){if(g=o&&o[a],x>0){var D=n.requestSubNodesData(),N=n.getNodesByRowCol(l,a);N&&N.count>0&&(D.subNodes=n.getNodesByRowCol(l,a).list,T=null,Ie=n.requestMeshRenderData())}g&&(v=m[g.index],(d=p.get((v&W.FLIPPED_MASK)>>>0))&&(T!==d.texture&&(je(T,d,n),T=d.texture),f=d.tileset._tileSize,A=g.left-Fe,w=g.bottom-Me,b=A+f.width,S=w+f.height,_=c[g.index],Ie.renderData.reserve(4,0),Re=9*Ie.renderData.vertexCount,s=Ie.renderData.vData,_?_.node.active&&Be(_.node,C,s,A,b,S,w,!1):(s[Re]=A,s[Re+1]=S,s[Re+9]=A,s[Re+9+1]=w,s[Re+18]=b,s[Re+18+1]=S,s[Re+27]=b,s[Re+27+1]=w,s.set(C,Re+5),s.set(C,Re+9+5),s.set(C,Re+18+5),s.set(C,Re+27+5)),Ce(d,v),s[Re+3]=Pe.x,s[Re+4]=Pe.y,s[Re+9+3]=Ee.x,s[Re+9+4]=Ee.y,s[Re+18+3]=Ge.x,s[Re+18+4]=Ge.y,s[Re+27+3]=ze.x,s[Re+27+4]=ze.y,Le++,Ie.renderData.advance(4,6),Le>=Se&&(je(T,d,n),T=d.texture)))}}}function Be(t,e,i,r,n,s,o,a){t.updateWorldTransform(),A.copy(De,t.matrix),w.set(Ne,-(r+Fe),-(o+Me),0),A.transform(De,De,Ne);var h=De,l=h.m12,u=h.m13,g=h.m00,f=h.m01,d=h.m04,_=h.m05,c=1===g&&0===f&&0===d&&1===_;if(a){var p=(r+n)/2,m=(s+o)/2;c?(i[Re]=p+l,i[Re+1]=s+u,i[Re+9]=r+l,i[Re+9+1]=m+u,i[Re+18]=n+l,i[Re+18+1]=m+u,i[Re+27]=p+l,i[Re+27+1]=o+u):(i[Re]=p*g+s*d+l,i[Re+1]=p*f+s*_+u,i[Re+9]=r*g+m*d+l,i[Re+9+1]=r*f+m*_+u,i[Re+18]=n*g+m*d+l,i[Re+18+1]=n*f+m*_+u,i[Re+27]=p*g+o*d+l,i[Re+27+1]=p*f+o*_+u)}else c?(i[Re]=r+l,i[Re+1]=s+u,i[Re+9]=r+l,i[Re+9+1]=o+u,i[Re+18]=n+l,i[Re+18+1]=s+u,i[Re+27]=n+l,i[Re+27+1]=o+u):(i[Re]=r*g+s*d+l,i[Re+1]=r*f+s*_+u,i[Re+9]=r*g+o*d+l,i[Re+9+1]=r*f+o*_+u,i[Re+18]=n*g+s*d+l,i[Re+18+1]=n*f+s*_+u,i[Re+27]=n*g+o*d+l,i[Re+27+1]=n*f+o*_+u);i.set(e,Re+5),i.set(e,Re+9+5),i.set(e,Re+18+5),i.set(e,Re+27+5)}var ke=t("tiledLayerAssembler",{getAssembler:function(){return Xe}});Ae.Assembler=ke}}}));
