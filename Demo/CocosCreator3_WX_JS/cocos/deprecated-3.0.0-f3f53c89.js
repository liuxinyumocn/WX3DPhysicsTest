System.register(["./coordinates-converts-utils-bf8713a9.js"],(function(e){"use strict";var t,n,r,i,a,s,o,c,u,h,l,f,d,m,v,y,p,x,b,E,A,w,_,S,P;return{setters:[function(e){t=e.b2,n=e.e4,r=e.a1,i=e.aN,a=e.aM,s=e.b9,o=e.b8,c=e.cD,u=e.bi,h=e.bL,l=e.bM,f=e.l,d=e.b4,m=e.b6,v=e.bA,y=e.aA,p=e.aB,x=e.bE,b=e.bD,E=e.bT,A=e.bl,w=e.by,_=e.bx,S=e.bz,P=e.e3}],execute:function(){e({E:void 0,W:void 0,h:function(e){return"function"==typeof e.lerp},k:void 0,r:function(e,t){if(t&&e!==r){for(var n=t.vertices,i=y.VERTICES,a=0;a<8;++a)p.setVec3(e,i,n[a]),i+=3;for(var s=t.planes,o=y.PLANES,c=0;c<6;c++,o+=4)p.setVec4(e,o,s[c])}}});var g=new t,z=new t,M=new t,H=new t,C=new t,B=new t,N=new Array(3),R=new Array(3);function T(e,n){return t.dot(n.n,e)-n.d}function F(e,n,r){return t.copy(e,n),t.subtract(C,r.center,r.halfExtents),t.add(B,r.center,r.halfExtents),e.x=e.x<C.x?C.x:e.x,e.y=e.y<C.y?C.y:e.y,e.z=e.z<C.z?C.z:e.z,e.x=e.x>B.x?B.x:e.x,e.y=e.y>B.y?B.y:e.y,e.z=e.z>B.z?B.z:e.z,e}function L(e,n,r){t.set(g,r.orientation.m00,r.orientation.m01,r.orientation.m02),t.set(z,r.orientation.m03,r.orientation.m04,r.orientation.m05),t.set(M,r.orientation.m06,r.orientation.m07,r.orientation.m08),N[0]=g,N[1]=z,N[2]=M,R[0]=r.halfExtents.x,R[1]=r.halfExtents.y,R[2]=r.halfExtents.z,t.subtract(H,n,r.center),t.set(e,r.center.x,r.center.y,r.center.z);for(var i=0;i<3;i++){var a=t.dot(H,N[i]);a>R[i]&&(a=R[i]),a<-R[i]&&(a=-R[i]),e.x+=a*N[i].x,e.y+=a*N[i].y,e.z+=a*N[i].z}return e}e("d",Object.freeze({__proto__:null,point_plane:T,pt_point_plane:function(e,n,r){var i=T(n,r);return t.subtract(e,n,t.multiplyScalar(e,r.n,i))},pt_point_aabb:F,pt_point_obb:L,pt_point_line:function(e,n,r,i){t.subtract(g,r,i);var a=g,s=t.lengthSqr(a);if(0==s)t.copy(e,r);else{t.subtract(g,n,r);var o=t.dot(g,a)/s;o<0?t.copy(e,r):o>1?t.copy(e,i):t.scaleAndAdd(e,r,a,o)}}}));var k=e("e",{SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512}),I=e("L",function(){function e(e,n,r,i,a,s){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=k.SHAPE_LINE,this.s=new t(e,n,r),this.e=new t(i,a,s)}return e.create=function(t,n,r,i,a,s){return new e(t,n,r,i,a,s)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,n){return t.copy(e.s,n.s),t.copy(e.e,n.e),e},e.fromPoints=function(e,n,r){return t.copy(e.s,n),t.copy(e.e,r),e},e.set=function(e,t,n,r,i,a,s){return e.s.x=t,e.s.y=n,e.s.z=r,e.e.x=i,e.e.y=a,e.e.z=s,e},e.len=function(e){return t.distance(e.s,e.e)},n(e,[{key:"type",get:function(){return this._type}}]),e.prototype.length=function(){return t.distance(this.s,this.e)},e}()),U=e("R",function(){function e(e,n,r,i,a,s){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=k.SHAPE_RAY,this.o=new t(e,n,r),this.d=new t(i,a,s)}return e.create=function(t,n,r,i,a,s){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=1),new e(t,n,r,i,a,s)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,n){return t.copy(e.o,n.o),t.copy(e.d,n.d),e},e.fromPoints=function(e,n,r){return t.copy(e.o,n),t.normalize(e.d,t.subtract(e.d,r,n)),e},e.set=function(e,t,n,r,i,a,s){return e.o.x=t,e.o.y=n,e.o.z=r,e.d.x=i,e.d.y=a,e.d.z=s,e},n(e,[{key:"type",get:function(){return this._type}}]),e.prototype.computeHit=function(e,n){t.normalize(e,this.d),t.scaleAndAdd(e,this.o,e,n)},e}()),O=new t,D=new t,q=new t,W=new t;function Y(e){return Math.max(Math.max(e.x,e.y),e.z)}var K,G=e("S",function(){function e(e,n,s,o){void 0===e&&(e=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=1),this._center=new t(0,0,0),this._poolHandle=r,this._type=void 0,this._type=k.SHAPE_SPHERE,this._center=new t(e,n,s),this._poolHandle=i.alloc(),i.setVec3(this._poolHandle,a.CENTER,this._center),i.set(this._poolHandle,a.RADIUS,o)}e.create=function(t,n,r,i){return new e(t,n,r,i)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,n){return t.copy(e.center,n.center),e.radius=n.radius,e},e.fromPoints=function(e,n,r){return t.multiplyScalar(e.center,t.add(O,n,r),.5),e.radius=.5*t.subtract(O,r,n).length(),e},e.set=function(e,t,n,r,i){return e.center.x=t,e.center.y=n,e.center.z=r,e.radius=i,e},e.mergePoint=function(e,n,r){if(n.radius<0)return e.center.set(r),e.radius=0,e;t.subtract(D,r,n.center);var i=D.length();if(i>n.radius){var a=.5*(i-n.radius);e.radius+=a,t.multiplyScalar(D,D,a/i),t.add(e.center,e.center,D)}return e},e.mergeAABB=function(t,n,r){return r.getBoundary(q,W),e.mergePoint(t,n,q),e.mergePoint(t,n,W),t},n(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,i.setVec3(this._poolHandle,a.CENTER,this._center)}},{key:"radius",get:function(){return i.get(this._poolHandle,a.RADIUS)},set:function(e){i.set(this._poolHandle,a.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var s=e.prototype;return s.destroy=function(){this._poolHandle&&(i.free(this._poolHandle),this._poolHandle=r)},s.clone=function(){return e.clone(this)},s.copy=function(t){return e.copy(this,t)},s.getBoundary=function(e,n){t.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),t.set(n,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},s.transform=function(e,n,r,i,a){t.transformMat4(a.center,this.center,e),a.radius=this.radius*Y(i)},s.translateAndRotate=function(e,n,r){t.transformMat4(r.center,this.center,e)},s.setScale=function(e,t){t.radius=this.radius*Y(e)},e}()),V=e("T",function(){function e(e,n,r,i,a,s,o,c,u){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===c&&(c=1),void 0===u&&(u=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=k.SHAPE_TRIANGLE,this.a=new t(e,n,r),this.b=new t(i,a,s),this.c=new t(o,c,u)}return e.create=function(t,n,r,i,a,s,o,c,u){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===u&&(u=1),new e(t,n,r,i,a,s,o,c,u)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,n){return t.copy(e.a,n.a),t.copy(e.b,n.b),t.copy(e.c,n.c),e},e.fromPoints=function(e,n,r,i){return t.copy(e.a,n),t.copy(e.b,r),t.copy(e.c,i),e},e.set=function(e,t,n,r,i,a,s,o,c,u){return e.a.x=t,e.a.y=n,e.a.z=r,e.b.x=i,e.b.y=a,e.b.z=s,e.c.x=o,e.c.y=c,e.c.z=u,e},n(e,[{key:"type",get:function(){return this._type}}]),e}());!function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(K||(K=e("E",{})));var Q,j,Z,J,X,$,ee=(Q=new t(0,0,0),function(e,n){var r=t.dot(e.d,n.n);if(Math.abs(r)<Number.EPSILON)return 0;t.multiplyScalar(Q,n.n,n.d);var i=t.dot(t.subtract(Q,Q,e.o),n.n)/r;return i<0?0:i}),te=(j=new t(0,0,0),Z=new t(0,0,0),J=new t(0,0,0),X=new t(0,0,0),$=new t(0,0,0),function(e,n,r){t.subtract(j,n.b,n.a),t.subtract(Z,n.c,n.a),t.cross(J,e.d,Z);var i=t.dot(j,J);if(i<Number.EPSILON&&(!r||i>-Number.EPSILON))return 0;var a=1/i;t.subtract(X,e.o,n.a);var s=t.dot(X,J)*a;if(s<0||s>1)return 0;t.cross($,X,j);var o=t.dot(e.d,$)*a;if(o<0||s+o>1)return 0;var c=t.dot(Z,$)*a;return c<0?0:c}),ne=function(){var e=new t(0,0,0);return function(n,r){var i=r.radius,a=r.center,s=n.o,o=n.d,c=i*i;t.subtract(e,a,s);var u=e.lengthSqr(),h=t.dot(e,o),l=c-(u-h*h);if(l<0)return 0;var f=Math.sqrt(l),d=u<c?h+f:h-f;return d<0?0:d}}(),re=function(){var e=new t,n=new t;return function(r,i){return t.subtract(e,i.center,i.halfExtents),t.add(n,i.center,i.halfExtents),ie(r,e,n)}}();function ie(e,t,n){var r=e.o,i=e.d,a=1/i.x,s=1/i.y,o=1/i.z,c=(t.x-r.x)*a,u=(n.x-r.x)*a,h=(t.y-r.y)*s,l=(n.y-r.y)*s,f=(t.z-r.z)*o,d=(n.z-r.z)*o,m=Math.max(Math.max(Math.min(c,u),Math.min(h,l)),Math.min(f,d)),v=Math.min(Math.min(Math.max(c,u),Math.max(h,l)),Math.max(f,d));return v<0||m>v?0:m>0?m:v}var ae,se,oe,ce,ue,he,le,fe,de,me,ve,ye,pe=function(){var e=new t,n=new t,r=new t,i=new t,a=new t,s=new t,o=new t,c=new Array(3),u=new Array(3),h=new Array(3),l=new Array(6);return function(f,d){c[0]=d.halfExtents.x,c[1]=d.halfExtents.y,c[2]=d.halfExtents.z,e=d.center,n=f.o,r=f.d,t.set(i,d.orientation.m00,d.orientation.m01,d.orientation.m02),t.set(a,d.orientation.m03,d.orientation.m04,d.orientation.m05),t.set(s,d.orientation.m06,d.orientation.m07,d.orientation.m08),t.subtract(o,e,n),u[0]=t.dot(i,r),u[1]=t.dot(a,r),u[2]=t.dot(s,r),h[0]=t.dot(i,o),h[1]=t.dot(a,o),h[2]=t.dot(s,o);for(var m=0;m<3;++m){if(0===u[m]){if(-h[m]-c[m]>0||-h[m]+c[m]<0)return 0;u[m]=1e-7}l[2*m+0]=(h[m]+c[m])/u[m],l[2*m+1]=(h[m]-c[m])/u[m]}var v=Math.max(Math.max(Math.min(l[0],l[1]),Math.min(l[2],l[3])),Math.min(l[4],l[5])),y=Math.min(Math.min(Math.max(l[0],l[1]),Math.max(l[2],l[3])),Math.max(l[4],l[5]));return y<0||v>y?0:v>0?v:y}}(),xe=(ae=new t,se=new t,oe=new t,ce=new t,ue=new t,he=new t,le=new t,fe=new G,function(e,n){var r=n.radius*n.radius,i=t.normalize(ae,e.d),a=n.ellipseCenter0,s=n.ellipseCenter1,o=t.subtract(se,s,a);if(o.equals(t.ZERO))return fe.radius=n.radius,fe.center.set(n.ellipseCenter0),nt.raySphere(e,fe);var c=e.o,u=t.subtract(oe,c,a),h=t.cross(ce,i,o),l=h.lengthSqr();if(0===l){fe.radius=n.radius;var f=t.subtract(ue,s,c);return u.lengthSqr()<f.lengthSqr()?fe.center.set(n.ellipseCenter0):fe.center.set(n.ellipseCenter1),nt.raySphere(e,fe)}var d=t.cross(ue,u,o),m=o.lengthSqr(),v=2*t.dot(h,d),y=v*v-4*l*(d.lengthSqr()-r*m);if(y<0)return 0;var p=(-v-Math.sqrt(y))/(2*l);if(p<0){fe.radius=n.radius;var x=t.subtract(he,s,c);return u.lengthSqr()<x.lengthSqr()?fe.center.set(n.ellipseCenter0):fe.center.set(n.ellipseCenter1),nt.raySphere(e,fe)}var b=t.scaleAndAdd(he,e.o,i,p),E=t.subtract(le,b,a),A=t.dot(E,o)/m;return A>=0&&A<=1?p:A<0?(fe.radius=n.radius,fe.center.set(n.ellipseCenter0),nt.raySphere(e,fe)):A>1?(fe.radius=n.radius,fe.center.set(n.ellipseCenter1),nt.raySphere(e,fe)):0}),be=(de=V.create(),me={distance:1/0,doubleSided:!1,mode:K.ANY},ve=0,ye=function(e,t,n,r,i,a){e===K.CLOSEST?(ve>t||0===ve)&&(ve=t,a&&(0===a.length?a.push({distance:t,vertexIndex0:n/3,vertexIndex1:r/3,vertexIndex2:i/3}):(a[0].distance=t,a[0].vertexIndex0=n/3,a[0].vertexIndex1=r/3,a[0].vertexIndex2=i/3))):(ve=t,a&&a.push({distance:t,vertexIndex0:n/3,vertexIndex1:r/3,vertexIndex2:i/3}))},function(e,n,r){if(ve=0,0===n.geometricInfo.positions.length)return ve;var i=void 0===r?me:r;if(ie(e,n.geometricInfo.boundingBox.min,n.geometricInfo.boundingBox.max)){var a=n.primitiveMode,s=n.geometricInfo;!function(e,n,r,i,a){if(r===c.TRIANGLE_LIST)for(var s=n.length,o=0;o<s;o+=3){var u=3*n[o],h=3*n[o+1],l=3*n[o+2];t.set(de.a,e[u],e[u+1],e[u+2]),t.set(de.b,e[h],e[h+1],e[h+2]),t.set(de.c,e[l],e[l+1],e[l+2]);var f=nt.rayTriangle(i,de,a.doubleSided);if(!(0===f||f>a.distance)&&(ye(a.mode,f,u,h,l,a.result),a.mode===K.ANY))return f}else if(r===c.TRIANGLE_STRIP)for(var d=n.length-2,m=0,v=0;v<d;v+=1){var y=3*n[v-m],p=3*n[v+m+1],x=3*n[v+2];t.set(de.a,e[y],e[y+1],e[y+2]),t.set(de.b,e[p],e[p+1],e[p+2]),t.set(de.c,e[x],e[x+1],e[x+2]),m=~m;var b=nt.rayTriangle(i,de,a.doubleSided);if(!(0===b||b>a.distance)&&(ye(a.mode,b,y,p,x,a.result),a.mode===K.ANY))return b}else if(r===c.TRIANGLE_FAN){var E=n.length-1,A=3*n[0];t.set(de.a,e[A],e[A+1],e[A+2]);for(var w=1;w<E;w+=1){var _=3*n[w],S=3*n[w+1];t.set(de.b,e[_],e[_+1],e[_+2]),t.set(de.c,e[S],e[S+1],e[S+2]);var P=nt.rayTriangle(i,de,a.doubleSided);if(!(0===P||P>a.distance)&&(ye(a.mode,P,A,_,S,a.result),a.mode===K.ANY))return P}}}(s.positions,s.indices,a,e,i)}return ve}),Ee=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:K.ANY};return function(n,r,i){e=0;var a=void 0===i?t:i,s=r.renderingSubMeshes.length,o=r.struct.minPosition,c=r.struct.maxPosition;if(o&&c&&!ie(n,o,c))return e;for(var u=0;u<s;u++){var h=r.renderingSubMeshes[u],l=be(n,h,a);if(l)if(a.mode===K.CLOSEST)(0===e||e>l)&&(e=l,a.subIndices&&(a.subIndices[0]=u));else if(e=l,a.subIndices&&a.subIndices.push(u),a.mode===K.ANY)return l}return e&&a.mode===K.CLOSEST&&(a.result&&(a.result[0].distance=e,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),e}}(),Ae=function(){var e=0,n={distance:1/0,doubleSided:!1,mode:K.ANY},r=new U,i=new s;return function(a,o,c){e=0;var u=void 0===c?n:c,h=o.worldBounds;if(h&&!re(a,h))return e;U.copy(r,a),o.node&&(s.invert(i,o.node.getWorldMatrix(i)),t.transformMat4(r.o,a.o,i),t.transformMat4Normal(r.d,a.d,i));for(var l=o.subModels,f=0;f<l.length;f++){var d=l[f].subMesh,m=be(r,d,u);if(m)if(u.mode===K.CLOSEST)(0===e||e>m)&&(e=m,u.subIndices&&(u.subIndices[0]=f));else if(e=m,u.subIndices&&u.subIndices.push(f),u.mode===K.ANY)return m}return e&&u.mode===K.CLOSEST&&(u.result&&(u.result[0].distance=e,u.result.length=1),u.subIndices&&(u.subIndices.length=1)),e}}(),we=function(){var e=new t(0,0,0);return function(n,r){t.subtract(e,n.e,n.s);var i=(r.d-t.dot(n.s,r.n))/t.dot(e,r.n);return i<0||i>1?0:i}}(),_e=function(){var e=new t(0,0,0),n=new t(0,0,0),r=new t(0,0,0),i=new t(0,0,0),a=new t(0,0,0),s=new t(0,0,0);return function(o,c,u){t.subtract(e,c.b,c.a),t.subtract(n,c.c,c.a),t.subtract(r,o.s,o.e),t.cross(a,e,n);var h=t.dot(r,a);if(h<=0)return 0;t.subtract(i,o.s,c.a);var l=t.dot(i,a);if(l<0||l>h)return 0;t.cross(s,r,i);var f=t.dot(n,s);if(f<0||f>h)return 0;var d=-t.dot(e,s);if(d<0||f+d>h)return 0;if(u){var m=1/h,v=1-(f*=m)-(d*=m);t.set(u,c.a.x*v+c.b.x*f+c.c.x*d,c.a.y*v+c.b.y*f+c.c.y*d,c.a.z*v+c.b.z*f+c.c.z*d)}return 1}}(),Se=new U;function Pe(e,n){Se.o.set(e.s),t.subtract(Se.d,e.e,e.s),Se.d.normalize();var r=re(Se,n);return r<=e.length()?r:0}function ge(e,n){Se.o.set(e.s),t.subtract(Se.d,e.e,e.s),Se.d.normalize();var r=pe(Se,n);return r<=e.length()?r:0}function ze(e,n){Se.o.set(e.s),t.subtract(Se.d,e.e,e.s),Se.d.normalize();var r=ne(Se,n);return r<=e.length()?r:0}var Me,He,Ce,Be,Ne=(Me=new t,He=new t,Ce=new t,Be=new t,function(e,n){return t.subtract(Me,e.center,e.halfExtents),t.add(He,e.center,e.halfExtents),t.subtract(Ce,n.center,n.halfExtents),t.add(Be,n.center,n.halfExtents),Me.x<=Be.x&&He.x>=Ce.x&&Me.y<=Be.y&&He.y>=Ce.y&&Me.z<=Be.z&&He.z>=Ce.z});function Re(e,n,r,i,a,s){t.set(s[0],e.x+r.x*n.x+i.x*n.y+a.x*n.z,e.y+r.y*n.x+i.y*n.y+a.y*n.z,e.z+r.z*n.x+i.z*n.y+a.z*n.z),t.set(s[1],e.x-r.x*n.x+i.x*n.y+a.x*n.z,e.y-r.y*n.x+i.y*n.y+a.y*n.z,e.z-r.z*n.x+i.z*n.y+a.z*n.z),t.set(s[2],e.x+r.x*n.x-i.x*n.y+a.x*n.z,e.y+r.y*n.x-i.y*n.y+a.y*n.z,e.z+r.z*n.x-i.z*n.y+a.z*n.z),t.set(s[3],e.x+r.x*n.x+i.x*n.y-a.x*n.z,e.y+r.y*n.x+i.y*n.y-a.y*n.z,e.z+r.z*n.x+i.z*n.y-a.z*n.z),t.set(s[4],e.x-r.x*n.x-i.x*n.y-a.x*n.z,e.y-r.y*n.x-i.y*n.y-a.y*n.z,e.z-r.z*n.x-i.z*n.y-a.z*n.z),t.set(s[5],e.x+r.x*n.x-i.x*n.y-a.x*n.z,e.y+r.y*n.x-i.y*n.y-a.y*n.z,e.z+r.z*n.x-i.z*n.y-a.z*n.z),t.set(s[6],e.x-r.x*n.x+i.x*n.y-a.x*n.z,e.y-r.y*n.x+i.y*n.y-a.y*n.z,e.z-r.z*n.x+i.z*n.y-a.z*n.z),t.set(s[7],e.x-r.x*n.x-i.x*n.y+a.x*n.z,e.y-r.y*n.x-i.y*n.y+a.y*n.z,e.z-r.z*n.x-i.z*n.y+a.z*n.z)}function Te(e,n){for(var r=t.dot(n,e[0]),i=r,a=1;a<8;++a){var s=t.dot(n,e[a]);r=s<r?s:r,i=s>i?s:i}return[r,i]}var Fe,Le,ke,Ie=function(){for(var e=new Array(15),n=0;n<15;n++)e[n]=new t(0,0,0);for(var r=new Array(8),i=new Array(8),a=0;a<8;a++)r[a]=new t(0,0,0),i[a]=new t(0,0,0);var s=new t,o=new t;return function(n,a){t.set(e[0],1,0,0),t.set(e[1],0,1,0),t.set(e[2],0,0,1),t.set(e[3],a.orientation.m00,a.orientation.m01,a.orientation.m02),t.set(e[4],a.orientation.m03,a.orientation.m04,a.orientation.m05),t.set(e[5],a.orientation.m06,a.orientation.m07,a.orientation.m08);for(var c=0;c<3;++c)t.cross(e[6+3*c],e[c],e[0]),t.cross(e[7+3*c],e[c],e[1]),t.cross(e[7+3*c],e[c],e[2]);t.subtract(s,n.center,n.halfExtents),t.add(o,n.center,n.halfExtents),function(e,n,r){t.set(r[0],e.x,n.y,n.z),t.set(r[1],e.x,n.y,e.z),t.set(r[2],e.x,e.y,n.z),t.set(r[3],e.x,e.y,e.z),t.set(r[4],n.x,n.y,n.z),t.set(r[5],n.x,n.y,e.z),t.set(r[6],n.x,e.y,n.z),t.set(r[7],n.x,e.y,e.z)}(s,o,r),Re(a.center,a.halfExtents,e[3],e[4],e[5],i);for(var u=0;u<15;++u){var h=Te(r,e[u]),l=Te(i,e[u]);if(l[0]>h[1]||h[0]>l[1])return 0}return 1}}(),Ue=function(e,n){var r=e.halfExtents.x*Math.abs(n.n.x)+e.halfExtents.y*Math.abs(n.n.y)+e.halfExtents.z*Math.abs(n.n.z),i=t.dot(n.n,e.center);return i+r<n.d?-1:i-r>n.d?0:1},Oe=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Ue(e,t.planes[n]))return 0;return 1},De=function(){for(var e=new Array(8),n=0,r=0,i=0;i<e.length;i++)e[i]=new t(0,0,0);return function(i,a){for(var s=0,o=!1,c=0;c<a.planes.length;c++){if(-1===(s=Ue(i,a.planes[c])))return 0;1===s&&(o=!0)}if(!o)return 1;for(var u=0;u<a.vertices.length;u++)t.subtract(e[u],a.vertices[u],i.center);n=0,r=0;for(var h=0;h<a.vertices.length;h++)e[h].x>i.halfExtents.x?n++:e[h].x<-i.halfExtents.x&&r++;if(n===a.vertices.length||r===a.vertices.length)return 0;n=0,r=0;for(var l=0;l<a.vertices.length;l++)e[l].y>i.halfExtents.y?n++:e[l].y<-i.halfExtents.y&&r++;if(n===a.vertices.length||r===a.vertices.length)return 0;n=0,r=0;for(var f=0;f<a.vertices.length;f++)e[f].z>i.halfExtents.z?n++:e[f].z<-i.halfExtents.z&&r++;return n===a.vertices.length||r===a.vertices.length?0:1}}(),qe=(Fe=new t(0,0,0),Le=new o,function(e,n){return t.subtract(Fe,n,e.center),t.transformMat3(Fe,Fe,o.transpose(Le,e.orientation)),r=Fe,i=e.halfExtents,Math.abs(r.x)<i.x&&Math.abs(r.y)<i.y&&Math.abs(r.z)<i.z;var r,i}),We=(ke=function(e,t,n,r){return Math.abs(e.x*t+e.y*n+e.z*r)},function(e,n){var r=e.halfExtents.x*ke(n.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*ke(n.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*ke(n.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=t.dot(n.n,e.center);return i+r<n.d?-1:i-r>n.d?0:1}),Ye=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===We(e,t.planes[n]))return 0;return 1},Ke=function(){for(var e=new Array(8),n=0,r=0,i=0,a=0;a<e.length;a++)e[a]=new t(0,0,0);var s=function(e,t,n,r){return e.x*t+e.y*n+e.z*r};return function(a,o){for(var c=0,u=!1,h=0;h<o.planes.length;h++){if(-1===(c=We(a,o.planes[h])))return 0;1===c&&(u=!0)}if(!u)return 1;for(var l=0;l<o.vertices.length;l++)t.subtract(e[l],o.vertices[l],a.center);r=0,i=0;for(var f=0;f<o.vertices.length;f++)(n=s(e[f],a.orientation.m00,a.orientation.m01,a.orientation.m02))>a.halfExtents.x?r++:n<-a.halfExtents.x&&i++;if(r===o.vertices.length||i===o.vertices.length)return 0;r=0,i=0;for(var d=0;d<o.vertices.length;d++)(n=s(e[d],a.orientation.m03,a.orientation.m04,a.orientation.m05))>a.halfExtents.y?r++:n<-a.halfExtents.y&&i++;if(r===o.vertices.length||i===o.vertices.length)return 0;r=0,i=0;for(var m=0;m<o.vertices.length;m++)(n=s(e[m],a.orientation.m06,a.orientation.m07,a.orientation.m08))>a.halfExtents.z?r++:n<-a.halfExtents.z&&i++;return r===o.vertices.length||i===o.vertices.length?0:1}}(),Ge=function(){for(var e=new Array(15),n=0;n<15;n++)e[n]=new t(0,0,0);for(var r=new Array(8),i=new Array(8),a=0;a<8;a++)r[a]=new t(0,0,0),i[a]=new t(0,0,0);return function(n,a){t.set(e[0],n.orientation.m00,n.orientation.m01,n.orientation.m02),t.set(e[1],n.orientation.m03,n.orientation.m04,n.orientation.m05),t.set(e[2],n.orientation.m06,n.orientation.m07,n.orientation.m08),t.set(e[3],a.orientation.m00,a.orientation.m01,a.orientation.m02),t.set(e[4],a.orientation.m03,a.orientation.m04,a.orientation.m05),t.set(e[5],a.orientation.m06,a.orientation.m07,a.orientation.m08);for(var s=0;s<3;++s)t.cross(e[6+3*s],e[s],e[0]),t.cross(e[7+3*s],e[s],e[1]),t.cross(e[7+3*s],e[s],e[2]);Re(n.center,n.halfExtents,e[0],e[1],e[2],r),Re(a.center,a.halfExtents,e[3],e[4],e[5],i);for(var o=0;o<15;++o){var c=Te(r,e[o]),u=Te(i,e[o]);if(u[0]>c[1]||c[0]>u[1])return 0}return 1}}(),Ve=function(){for(var e=new G,n=new t,r=new t,i=new t,a=new Array(8),s=0;s<8;s++)a[s]=new t;for(var o=new Array(8),c=0;c<8;c++)o[c]=new t;return function(s,c){if(0===t.squaredDistance(c.ellipseCenter0,c.ellipseCenter1))return e.radius=c.radius,e.center.set(c.ellipseCenter0),nt.sphereOBB(e,s);n.x=s.orientation.m00,n.y=s.orientation.m01,n.z=s.orientation.m02,r.x=s.orientation.m03,r.y=s.orientation.m04,r.z=s.orientation.m05,i.x=s.orientation.m06,i.y=s.orientation.m07,i.z=s.orientation.m08,Re(s.center,s.halfExtents,n,r,i,a);var u=o,h=t.copy(u[0],n),l=t.copy(u[1],r),f=t.copy(u[2],i);t.subtract(u[3],c.center,s.center).normalize();var d=t.subtract(u[4],c.ellipseCenter0,c.ellipseCenter1);d.normalize(),t.cross(u[5],h,d),t.cross(u[6],l,d),t.cross(u[7],f,d);for(var m=0;m<8;++m){var v=Te(a,u[m]),y=t.dot(u[m],c.ellipseCenter0),p=t.dot(u[m],c.ellipseCenter1),x=Math.max(y,p),b=Math.min(y,p)-c.radius,E=x+c.radius;if(b>v[1]||v[0]>E)return 0}return 1}}(),Qe=function(e,n){var r=t.dot(n.n,e.center),i=e.radius*n.n.length();return r+i<n.d?-1:r-i>n.d?0:1},je=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Qe(e,t.planes[n]))return 0;return 1},Ze=function(){var e=new t(0,0,0),n=[1,-1,1,-1,1,-1];return function(r,i){for(var a=0;a<6;a++){var s=i.planes[a],o=r.radius,c=r.center,u=s.n,h=s.d,l=t.dot(u,c);if(l+o<h)return 0;if(!(l-o>h)){t.add(e,c,t.multiplyScalar(e,u,o));for(var f=0;f<6;f++)if(f!==a&&f!==a+n[a]){var d=i.planes[f];if(t.dot(d.n,e)<d.d)return 0}}}return 1}}(),Je=function(e,n){var r=e.radius+n.radius;return t.squaredDistance(e.center,n.center)<r*r},Xe=function(){var e=new t;return function(n,r){return F(e,n.center,r),t.squaredDistance(n.center,e)<n.radius*n.radius}}(),$e=function(){var e=new t;return function(n,r){return L(e,n.center,r),t.squaredDistance(n.center,e)<n.radius*n.radius}}(),et=function(){var e=new t,n=new t;return function(r,i){var a=r.radius+i.radius,s=a*a,o=t.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===o)return t.squaredDistance(r.center,i.center)<s;t.subtract(e,r.center,i.ellipseCenter0),t.subtract(n,i.ellipseCenter1,i.ellipseCenter0);var c=t.dot(e,n)/o;return c<0?t.squaredDistance(r.center,i.ellipseCenter0)<s:c>1?t.squaredDistance(r.center,i.ellipseCenter1)<s:(t.scaleAndAdd(e,i.ellipseCenter0,n,c),t.squaredDistance(r.center,e)<s)}}(),tt=function(){var e=new t,n=new t,r=new t,i=new t,a=new t,s=new t;return function(o,c){var h,l,f,d,m=t.subtract(e,o.ellipseCenter1,o.ellipseCenter0),v=t.subtract(n,c.ellipseCenter1,c.ellipseCenter0),y=t.subtract(r,o.ellipseCenter0,c.ellipseCenter0),p=t.dot(m,m),x=t.dot(m,v),b=t.dot(v,v),E=t.dot(m,y),A=t.dot(v,y),w=p*b-x*x,_=w,S=w;w<u?(l=0,_=1,d=A,S=b):(d=p*A-x*E,(l=x*A-b*E)<0?(l=0,d=A,S=b):l>_&&(l=_,d=A+x,S=b)),d<0?(d=0,-E<0?l=0:-E>p?l=_:(l=-E,_=p)):d>S&&(d=S,-E+x<0?l=0:-E+x>p?l=_:(l=-E+x,_=p)),h=Math.abs(l)<u?0:l/_,f=Math.abs(d)<u?0:d/S;var P=i;P.set(y),P.add(t.multiplyScalar(a,m,h)),P.subtract(t.multiplyScalar(s,v,f));var g=o.radius+c.radius;return P.lengthSqr()<g*g}}(),nt=e("i",{raySphere:ne,rayAABB:re,rayOBB:pe,rayPlane:ee,rayTriangle:te,rayCapsule:xe,raySubMesh:be,rayMesh:Ee,rayModel:Ae,lineSphere:ze,lineAABB:Pe,lineOBB:ge,linePlane:we,lineTriangle:_e,sphereWithSphere:Je,sphereAABB:Xe,sphereOBB:$e,spherePlane:Qe,sphereFrustum:je,sphereFrustumAccurate:Ze,sphereCapsule:et,aabbWithAABB:Ne,aabbWithOBB:Ie,aabbPlane:Ue,aabbFrustum:Oe,aabbFrustumAccurate:De,obbWithOBB:Ge,obbPlane:We,obbFrustum:Ye,obbFrustumAccurate:Ke,obbPoint:qe,obbCapsule:Ve,capsuleWithCapsule:tt,resolve:function(e,t,n){void 0===n&&(n=null);var r=e._type,i=t._type,a=this[r|i];return r<i?a(e,t,n):a(t,e,n)}});nt[k.SHAPE_RAY|k.SHAPE_SPHERE]=ne,nt[k.SHAPE_RAY|k.SHAPE_AABB]=re,nt[k.SHAPE_RAY|k.SHAPE_OBB]=pe,nt[k.SHAPE_RAY|k.SHAPE_PLANE]=ee,nt[k.SHAPE_RAY|k.SHAPE_TRIANGLE]=te,nt[k.SHAPE_RAY|k.SHAPE_CAPSULE]=xe,nt[k.SHAPE_LINE|k.SHAPE_SPHERE]=ze,nt[k.SHAPE_LINE|k.SHAPE_AABB]=Pe,nt[k.SHAPE_LINE|k.SHAPE_OBB]=ge,nt[k.SHAPE_LINE|k.SHAPE_PLANE]=we,nt[k.SHAPE_LINE|k.SHAPE_TRIANGLE]=_e,nt[k.SHAPE_SPHERE]=Je,nt[k.SHAPE_SPHERE|k.SHAPE_AABB]=Xe,nt[k.SHAPE_SPHERE|k.SHAPE_OBB]=$e,nt[k.SHAPE_SPHERE|k.SHAPE_PLANE]=Qe,nt[k.SHAPE_SPHERE|k.SHAPE_FRUSTUM]=je,nt[k.SHAPE_SPHERE|k.SHAPE_FRUSTUM_ACCURATE]=Ze,nt[k.SHAPE_SPHERE|k.SHAPE_CAPSULE]=et,nt[k.SHAPE_AABB]=Ne,nt[k.SHAPE_AABB|k.SHAPE_OBB]=Ie,nt[k.SHAPE_AABB|k.SHAPE_PLANE]=Ue,nt[k.SHAPE_AABB|k.SHAPE_FRUSTUM]=Oe,nt[k.SHAPE_AABB|k.SHAPE_FRUSTUM_ACCURATE]=De,nt[k.SHAPE_OBB]=Ge,nt[k.SHAPE_OBB|k.SHAPE_PLANE]=We,nt[k.SHAPE_OBB|k.SHAPE_FRUSTUM]=Ye,nt[k.SHAPE_OBB|k.SHAPE_FRUSTUM_ACCURATE]=Ke,nt[k.SHAPE_OBB|k.SHAPE_CAPSULE]=Ve,nt[k.SHAPE_CAPSULE]=tt,h(I.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),l(nt,"intersect",[{name:"line_quad"}]);var rt=new t(0,0,0),it=new t(0,0,0),at=f.mat4(),st=f.v4(),ot=e("P",function(){function e(e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=k.SHAPE_PLANE,this.n=new t(e,n,r),this.d=i}return e.create=function(t,n,r,i){return new e(t,n,r,i)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,n){return t.copy(e.n,n.n),e.d=n.d,e},e.fromPoints=function(e,n,r,i){return t.subtract(rt,r,n),t.subtract(it,i,n),t.normalize(e.n,t.cross(e.n,rt,it)),e.d=t.dot(e.n,n),e},e.set=function(e,t,n,r,i){return e.n.x=t,e.n.y=n,e.n.z=r,e.d=i,e},e.fromNormalAndPoint=function(e,n,r){return t.copy(e.n,n),e.d=t.dot(n,r),e},e.normalize=function(e,n){var r=n.n.length();return t.normalize(e.n,n.n),r>0&&(e.d=n.d/r),e},n(e,[{key:"type",get:function(){return this._type}},{key:"x",set:function(e){this.n.x=e},get:function(){return this.n.x}},{key:"y",set:function(e){this.n.y=e},get:function(){return this.n.y}},{key:"z",set:function(e){this.n.z=e},get:function(){return this.n.z}},{key:"w",set:function(e){this.d=e},get:function(){return this.d}}]),e.prototype.transform=function(e){s.invert(at,e),s.transpose(at,at),d.set(st,this.n.x,this.n.y,this.n.z,this.d),d.transformMat4(st,st,at),t.set(this.n,st.x,st.y,st.z),this.d=st.w},e}()),ct=new t,ut=new t,ht=new t,lt=new t,ft=new o,dt=function(e,n,r){ft.m00=Math.abs(r.m00),ft.m01=Math.abs(r.m01),ft.m02=Math.abs(r.m02),ft.m03=Math.abs(r.m04),ft.m04=Math.abs(r.m05),ft.m05=Math.abs(r.m06),ft.m06=Math.abs(r.m08),ft.m07=Math.abs(r.m09),ft.m08=Math.abs(r.m10),t.transformMat3(e,n,ft)},mt=e("A",function(){function e(e,n,r,i,a,s){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===a&&(a=1),void 0===s&&(s=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=k.SHAPE_AABB,this.center=new t(e,n,r),this.halfExtents=new t(i,a,s)}e.create=function(t,n,r,i,a,s){return new e(t,n,r,i,a,s)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,n){return t.copy(e.center,n.center),t.copy(e.halfExtents,n.halfExtents),e},e.fromPoints=function(e,n,r){return t.add(ct,r,n),t.subtract(ut,r,n),t.multiplyScalar(e.center,ct,.5),t.multiplyScalar(e.halfExtents,ut,.5),e},e.set=function(e,n,r,i,a,s,o){return t.set(e.center,n,r,i),t.set(e.halfExtents,a,s,o),e},e.merge=function(n,r,i){return t.subtract(ct,r.center,r.halfExtents),t.subtract(ut,i.center,i.halfExtents),t.add(ht,r.center,r.halfExtents),t.add(lt,i.center,i.halfExtents),t.max(lt,ht,lt),t.min(ht,ct,ut),e.fromPoints(n,ht,lt)},e.toBoundingSphere=function(e,n){n.getBoundary(ct,ut),e.center.set(ct),e.radius=0,t.subtract(ht,ut,e.center);var r=ht.length(),i=.5*r;return e.radius+=i,t.multiplyScalar(ht,ht,i/r),t.add(e.center,e.center,ht),e},e.transform=function(e,n,r){return t.transformMat4(e.center,n.center,r),dt(e.halfExtents,n.halfExtents,r),e},n(e,[{key:"type",get:function(){return this._type}}]);var r=e.prototype;return r.getBoundary=function(e,n){t.subtract(e,this.center,this.halfExtents),t.add(n,this.center,this.halfExtents)},r.transform=function(e,n,r,i,a){t.transformMat4(a.center,this.center,e),dt(a.halfExtents,this.halfExtents,e)},r.clone=function(){return e.clone(this)},r.copy=function(t){return e.copy(this,t)},e}()),vt=new t,yt=new t,pt=new o,xt=e("O",function(){function e(e,n,r,i,a,s,c,u,h,l,f,d,m,v,y){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=1),void 0===u&&(u=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===f&&(f=1),void 0===d&&(d=0),void 0===m&&(m=0),void 0===v&&(v=0),void 0===y&&(y=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=k.SHAPE_OBB,this.center=new t(e,n,r),this.halfExtents=new t(i,a,s),this.orientation=new o(c,u,h,l,f,d,m,v,y)}e.create=function(t,n,r,i,a,s,o,c,u,h,l,f,d,m,v){return new e(t,n,r,i,a,s,o,c,u,h,l,f,d,m,v)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,n){return t.copy(e.center,n.center),t.copy(e.halfExtents,n.halfExtents),o.copy(e.orientation,n.orientation),e},e.fromPoints=function(e,n,r){return t.multiplyScalar(e.center,t.add(vt,n,r),.5),t.multiplyScalar(e.halfExtents,t.subtract(yt,r,n),.5),o.identity(e.orientation),e},e.set=function(e,n,r,i,a,s,c,u,h,l,f,d,m,v,y,p){return t.set(e.center,n,r,i),t.set(e.halfExtents,a,s,c),o.set(e.orientation,u,h,l,f,d,m,v,y,p),e},n(e,[{key:"type",get:function(){return this._type}}]);var r=e.prototype;return r.getBoundary=function(e,n){!function(e,n,r){pt.m00=Math.abs(r.m00),pt.m01=Math.abs(r.m01),pt.m02=Math.abs(r.m02),pt.m03=Math.abs(r.m03),pt.m04=Math.abs(r.m04),pt.m05=Math.abs(r.m05),pt.m06=Math.abs(r.m06),pt.m07=Math.abs(r.m07),pt.m08=Math.abs(r.m08),t.transformMat3(e,n,pt)}(vt,this.halfExtents,this.orientation),t.subtract(e,this.center,vt),t.add(n,this.center,vt)},r.transform=function(e,n,r,i,a){t.transformMat4(a.center,this.center,e),o.fromQuat(a.orientation,r),t.multiply(a.halfExtents,this.halfExtents,i)},r.translateAndRotate=function(e,n,r){t.transformMat4(r.center,this.center,e),o.fromQuat(r.orientation,n)},r.setScale=function(e,n){t.multiply(n.halfExtents,this.halfExtents,e)},e}()),bt=e("C",function(){function e(e,n,r){void 0===e&&(e=.5),void 0===n&&(n=.5),void 0===r&&(r=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=k.SHAPE_CAPSULE,this.radius=e,this.halfHeight=n,this.axis=r,this.center=new t,this.rotation=new m,this.ellipseCenter0=new t(0,n,0),this.ellipseCenter1=new t(0,-n,0),this.updateCache()}n(e,[{key:"type",get:function(){return this._type}}]);var r=e.prototype;return r.transform=function(e,n,r,i,a){var s=i,o=v(s);a.radius=this.radius*Math.abs(o);var c=(this.halfHeight+this.radius)*Math.abs(s.y)-a.radius;c<0&&(c=0),a.halfHeight=c,t.transformMat4(a.center,this.center,e),m.multiply(a.rotation,this.rotation,r),a.updateCache()},r.updateCache=function(){this.updateLocalCenter(),t.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),t.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},r.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},e}()),Et=new Array(8);Et[0]=new t(1,1,1),Et[1]=new t(-1,1,1),Et[2]=new t(-1,-1,1),Et[3]=new t(1,-1,1),Et[4]=new t(1,1,-1),Et[5]=new t(-1,1,-1),Et[6]=new t(-1,-1,-1),Et[7]=new t(1,-1,-1);var At,wt,_t,St=e("F",function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=k.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=ot.create(0,0,0,0);this.vertices=new Array(8);for(var n=0;n<8;++n)this.vertices[n]=new t}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,n){e._type=n._type;for(var r=0;r<6;++r)ot.copy(e.planes[r],n.planes[r]);for(var i=0;i<8;++i)t.copy(e.vertices[i],n.vertices[i]);return e},n(e,[{key:"accurate",set:function(e){this._type=e?k.SHAPE_FRUSTUM_ACCURATE:k.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var r=e.prototype;return r.update=function(e,n){if(t.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),t.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),t.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),t.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),t.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),t.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===k.SHAPE_FRUSTUM_ACCURATE){for(var r=0;r<6;r++){var i=this.planes[r],a=1/i.n.length();t.multiplyScalar(i.n,i.n,a),i.d*=a}for(var s=0;s<8;s++)t.transformMat4(this.vertices[s],Et[s],n)}},r.transform=function(e){if(this._type===k.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<8;n++)t.transformMat4(this.vertices[n],this.vertices[n],e);ot.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),ot.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),ot.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),ot.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),ot.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),ot.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},e}());St.createOrtho=(At=new t,function(e,n,r,i,a,s){var o=n/2,c=r/2;t.set(At,o,c,i),t.transformMat4(e.vertices[0],At,s),t.set(At,-o,c,i),t.transformMat4(e.vertices[1],At,s),t.set(At,-o,-c,i),t.transformMat4(e.vertices[2],At,s),t.set(At,o,-c,i),t.transformMat4(e.vertices[3],At,s),t.set(At,o,c,a),t.transformMat4(e.vertices[4],At,s),t.set(At,-o,c,a),t.transformMat4(e.vertices[5],At,s),t.set(At,-o,-c,a),t.transformMat4(e.vertices[6],At,s),t.set(At,o,-c,a),t.transformMat4(e.vertices[7],At,s),ot.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),ot.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),ot.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),ot.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),ot.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),ot.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(wt||(wt=e("k",{}))),function(e){e[e.Default=wt.Default]="Default",e[e.Normal=wt.Normal]="Normal",e[e.Reverse=wt.Reverse]="Reverse",e[e.Loop=wt.Loop]="Loop",e[e.LoopReverse=wt.Loop|wt.Reverse]="LoopReverse",e[e.PingPong=wt.PingPong]="PingPong",e[e.PingPongReverse=wt.PingPong|wt.Reverse]="PingPongReverse"}(_t||(_t=e("W",{}))),x(_t),e("j",function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}());var Pt=b({Default:wt.Default,Normal:wt.Normal,Clamp:wt.Clamp,Loop:wt.Loop,PingPong:wt.PingPong}),gt=e("K",(function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0}));E.fastDefine("cc.Keyframe",gt,{time:0,value:0,inTangent:0,outTangent:0});var zt=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),Mt=e("a",function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=Pt.Loop,this.postWrapMode=Pt.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new zt}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,r=this.keyFrames[0].time,i=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Pt.Loop:t=_(e-r,i-r)+r;break;case Pt.PingPong:t=w(e-r,i-r)+r;break;case Pt.Default:case Pt.Normal:case Pt.Clamp:default:t=A(e,r,i)}var a=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)a=this.keyFrames.length-2;else for(var s=0;s<this.keyFrames.length-1;s++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[s+1].time){a=s;break}var o=this.keyFrames[a],c=this.keyFrames[a+1],u=S(o.time,c.time,t),h=c.time-o.time,l=o.outTangent*h,f=c.inTangent*h,d=u*u,m=d*u,v=m-2*d+u,y=m-d,p=-2*m+3*d;return(2*m-3*d+1)*o.value+v*l+y*f+p*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,r=this.keyFrames[0].time,i=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Pt.Loop:t=_(e-r,i-r)+r;break;case Pt.PingPong:t=w(e-r,i-r)+r;break;case Pt.Default:case Pt.Normal:case Pt.Clamp:default:t=A(e,r,i)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var a=this.findIndex(this.cachedKey,t),s=Math.min(a+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,a,s),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var r=this.keyFrames[t],i=this.keyFrames[n];e.index=t,e.time=r.time,e.endTime=i.time;var a=i.time-r.time,s=i.value-r.value,o=1/(a*a),c=r.outTangent*a,u=i.inTangent*a;e.coefficient[0]=(c+u-s-s)*o/a,e.coefficient[1]=(s+s+s-c-c-u)*o,e.coefficient[2]=r.outTangent,e.coefficient[3]=r.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var r=0;r<3;r++){var i=n+r;if(i+1<this.keyFrames.length&&this.keyFrames[i+1].time>t)return i}else for(var a=0;a<3;a++){var s=n-a;if(s>=0&&this.keyFrames[s-1].time<=t)return s-1}for(var o,c=0,u=this.keyFrames.length;u-c>1;)o=Math.floor((c+u)/2),this.keyFrames[o].time>=t?u=o:c=o;return c},e}());function Ht(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}Mt.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],E.fastDefine("cc.AnimationCurve",Mt,{preWrapMode:Pt.Default,postWrapMode:Pt.Default,keyFrames:[]}),h(nt,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]),e("l",function(e){function t(){var t;return t=e.call(this)||this,Ht("line","Line"),t}return P(t,e),t}(I)),e("p",function(e){function t(){var t;return t=e.call(this)||this,Ht("plane","Plane"),t}return P(t,e),t}(ot)),e("b",function(e){function t(){var t;return t=e.call(this)||this,Ht("ray","Ray"),t}return P(t,e),t}(U)),e("t",function(e){function t(){var t;return t=e.call(this)||this,Ht("triangle","Triangle"),t}return P(t,e),t}(V)),e("s",function(e){function t(){var t;return t=e.call(this)||this,Ht("sphere","Sphere"),t}return P(t,e),t}(G)),e("c",function(e){function t(){var t;return t=e.call(this)||this,Ht("aabb","AABB"),t}return P(t,e),t}(mt)),e("o",function(e){function t(){var t;return t=e.call(this)||this,Ht("obb","OBB"),t}return P(t,e),t}(xt)),e("f",function(e){function t(){var t;return t=e.call(this)||this,Ht("capsule","Capsule"),t}return P(t,e),t}(bt)),e("g",function(e){function t(){var t;return t=e.call(this)||this,Ht("frustum","Frustum"),t}return P(t,e),t}(St))}}}));
